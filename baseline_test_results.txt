============================= test session starts ==============================
platform linux -- Python 3.11.2, pytest-8.4.2, pluggy-1.6.0 -- /home/sverzijl/planning_latest/venv/bin/python
cachedir: .pytest_cache
rootdir: /home/sverzijl/planning_latest
plugins: cov-7.0.0, mock-3.15.1
collecting ... collected 961 items

tests/test_alias_backward_compatibility.py::TestExcelParserBackwardCompatibility::test_parse_forecast_without_resolver_parameter PASSED [  0%]
tests/test_alias_backward_compatibility.py::TestExcelParserBackwardCompatibility::test_parse_forecast_with_none_resolver PASSED [  0%]
tests/test_alias_backward_compatibility.py::TestExcelParserBackwardCompatibility::test_all_parser_methods_work_without_resolver PASSED [  0%]
tests/test_alias_backward_compatibility.py::TestMultiFileParserBackwardCompatibility::test_parse_without_network_file PASSED [  0%]
tests/test_alias_backward_compatibility.py::TestMultiFileParserBackwardCompatibility::test_parse_without_alias_sheet PASSED [  0%]
tests/test_alias_backward_compatibility.py::TestMultiFileParserBackwardCompatibility::test_parse_only_network_file PASSED [  0%]
tests/test_alias_backward_compatibility.py::TestMultiFileParserBackwardCompatibility::test_validate_consistency_still_works PASSED [  0%]
tests/test_alias_backward_compatibility.py::TestSapIbpParserBackwardCompatibility::test_parse_sap_ibp_without_resolver PASSED [  0%]
tests/test_alias_backward_compatibility.py::TestSapIbpParserBackwardCompatibility::test_detect_sap_ibp_format_still_works PASSED [  0%]
tests/test_alias_backward_compatibility.py::TestExistingTestFixturesStillWork::test_simple_forecast_parsing_unchanged PASSED [  1%]
tests/test_alias_backward_compatibility.py::TestExistingTestFixturesStillWork::test_parser_initialization_validation_unchanged PASSED [  1%]
tests/test_alias_backward_compatibility.py::TestExistingTestFixturesStillWork::test_multi_file_parser_initialization_validation_unchanged PASSED [  1%]
tests/test_alias_backward_compatibility.py::TestNoRegressionInExistingFunctionality::test_forecast_entry_attributes_preserved PASSED [  1%]
tests/test_alias_backward_compatibility.py::TestNoRegressionInExistingFunctionality::test_location_parsing_unchanged PASSED [  1%]
tests/test_alias_backward_compatibility.py::TestNoRegressionInExistingFunctionality::test_route_parsing_unchanged PASSED [  1%]
tests/test_alias_backward_compatibility.py::TestNoRegressionInExistingFunctionality::test_labor_calendar_parsing_unchanged PASSED [  1%]
tests/test_alias_backward_compatibility.py::TestNoRegressionInExistingFunctionality::test_truck_schedules_parsing_unchanged PASSED [  1%]
tests/test_alias_backward_compatibility.py::TestNoRegressionInExistingFunctionality::test_cost_structure_parsing_unchanged PASSED [  1%]
tests/test_alias_e2e.py::TestEndToEndWorkflow::test_full_data_loading_workflow PASSED [  1%]
tests/test_alias_e2e.py::TestEndToEndWorkflow::test_forecast_inventory_product_alignment FAILED [  2%]
tests/test_alias_e2e.py::TestEndToEndWorkflow::test_product_consistency_validation FAILED [  2%]
tests/test_alias_e2e.py::TestEndToEndWorkflow::test_location_consistency_validation PASSED [  2%]
tests/test_alias_e2e.py::TestEndToEndWorkflow::test_quantity_aggregation_with_aliases PASSED [  2%]
tests/test_alias_e2e.py::TestInventoryAliasResolution::test_inventory_parser_with_resolver FAILED [  2%]
tests/test_alias_e2e.py::TestInventoryAliasResolution::test_inventory_quantities_converted_and_resolved FAILED [  2%]
tests/test_alias_e2e.py::TestRealWorldScenarios::test_sap_export_with_mixed_codes FAILED [  2%]
tests/test_alias_e2e.py::TestRealWorldScenarios::test_migration_scenario_add_aliases_to_existing_system PASSED [  2%]
tests/test_appsi_highs_solver.py::test_appsi_highs_availability FAILED   [  2%]
tests/test_appsi_highs_solver.py::test_appsi_highs_basic_solve FAILED    [  3%]
tests/test_appsi_highs_solver.py::test_appsi_highs_with_warmstart FAILED [  3%]
tests/test_appsi_highs_solver.py::test_appsi_highs_performance_vs_legacy FAILED [  3%]
tests/test_appsi_highs_solver.py::test_appsi_highs_error_handling PASSED [  3%]
tests/test_baseline_1week.py::test_baseline_1week_no_initial_inventory FAILED [  3%]
tests/test_baseline_2week.py::test_baseline_2week_no_initial_inventory FAILED [  3%]
tests/test_baseline_4week.py::test_baseline_4week_no_initial_inventory FAILED [  3%]
tests/test_baseline_initial_inventory.py::test_baseline_with_initial_inventory FAILED [  3%]
tests/test_baseline_state_transitions.py::test_baseline_state_transitions FAILED [  3%]
tests/test_baseline_weekend_trucks.py::test_baseline_weekend_truck_constraints FAILED [  3%]
tests/test_batch_extraction_simple.py::test_production_batch_creation PASSED [  4%]
tests/test_batch_extraction_simple.py::test_batch_id_format PASSED       [  4%]
tests/test_batch_extraction_simple.py::test_solution_dict_structure PASSED [  4%]
tests/test_cost_breakdown_holding.py::TestHoldingCostBreakdown::test_holding_cost_breakdown_instantiation PASSED [  4%]
tests/test_cost_breakdown_holding.py::TestHoldingCostBreakdown::test_holding_cost_breakdown_defaults PASSED [  4%]
tests/test_cost_breakdown_holding.py::TestHoldingCostBreakdown::test_holding_cost_breakdown_string_representation FAILED [  4%]
tests/test_cost_breakdown_holding.py::TestTotalCostBreakdownWithHolding::test_total_cost_breakdown_includes_holding PASSED [  4%]
tests/test_cost_breakdown_holding.py::TestTotalCostBreakdownWithHolding::test_total_cost_breakdown_holding_default PASSED [  4%]
tests/test_cost_breakdown_holding.py::TestTotalCostBreakdownWithHolding::test_get_cost_proportions_includes_holding PASSED [  4%]
tests/test_cost_breakdown_holding.py::TestTotalCostBreakdownWithHolding::test_get_cost_proportions_with_zero_total PASSED [  4%]
tests/test_cost_breakdown_holding.py::TestTotalCostBreakdownWithHolding::test_total_cost_breakdown_string_includes_holding PASSED [  5%]
tests/test_cost_breakdown_holding.py::TestResultAdapterHoldingCost::test_holding_breakdown_created_in_adapter FAILED [  5%]
tests/test_cost_breakdown_holding.py::TestResultAdapterHoldingCost::test_holding_breakdown_with_zero_holding_cost FAILED [  5%]
tests/test_cost_breakdown_holding.py::TestResultAdapterHoldingCost::test_holding_breakdown_missing_from_solution FAILED [  5%]
tests/test_cost_breakdown_holding.py::TestResultAdapterHoldingCost::test_total_cost_includes_holding_component FAILED [  5%]
tests/test_cost_breakdown_holding.py::TestResultAdapterHoldingCost::test_holding_cost_flows_from_model_to_breakdown SKIPPED [  5%]
tests/test_cost_breakdown_holding.py::TestResultAdapterHoldingCost::test_holding_cost_breakdown_detailed_fields PASSED [  5%]
tests/test_daily_rolling_solver.py::TestSolutionExtraction::test_extract_solution_basic ERROR [  5%]
tests/test_daily_rolling_solver.py::TestSolutionExtraction::test_extract_includes_all_variable_types ERROR [  5%]
tests/test_daily_rolling_solver.py::TestDateShifting::test_shift_basic PASSED [  6%]
tests/test_daily_rolling_solver.py::TestDateShifting::test_shift_filters_out_of_range PASSED [  6%]
tests/test_daily_rolling_solver.py::TestDateShifting::test_shift_handles_multi_date_keys PASSED [  6%]
tests/test_daily_rolling_solver.py::TestDateShifting::test_shift_weekend_boundary PASSED [  6%]
tests/test_daily_rolling_solver.py::TestDateShifting::test_shift_month_boundary PASSED [  6%]
tests/test_daily_rolling_solver.py::TestWarmstartQuality::test_validate_good_quality PASSED [  6%]
tests/test_daily_rolling_solver.py::TestWarmstartQuality::test_validate_poor_quality PASSED [  6%]
tests/test_daily_rolling_solver.py::TestSpeedupEstimation::test_estimate_speedup_high_overlap PASSED [  6%]
tests/test_daily_rolling_solver.py::TestSpeedupEstimation::test_estimate_speedup_medium_overlap PASSED [  6%]
tests/test_daily_rolling_solver.py::TestDailyRollingSolver::test_solve_single_day ERROR [  6%]
tests/test_daily_rolling_solver.py::TestDailyRollingSolver::test_solve_two_day_sequence ERROR [  7%]
tests/test_daily_rolling_solver.py::TestDailyRollingSolver::test_solve_sequence ERROR [  7%]
tests/test_daily_rolling_solver.py::TestDailyRollingSolver::test_reset_clears_warmstart ERROR [  7%]
tests/test_daily_rolling_solver.py::TestForecastUpdates::test_forecast_updates_applied ERROR [  7%]
tests/test_daily_snapshot.py::test_daily_snapshot_generator_basic PASSED [  7%]
tests/test_daily_snapshot.py::test_single_snapshot_generation PASSED     [  7%]
tests/test_daily_snapshot.py::test_multiple_snapshots_generation PASSED  [  7%]
tests/test_daily_snapshot.py::test_empty_data_handling PASSED            [  7%]
tests/test_daily_snapshot.py::test_location_inventory_calculation PASSED [  7%]
tests/test_daily_snapshot.py::test_batch_tracking_at_manufacturing PASSED [  8%]
tests/test_daily_snapshot.py::test_batch_age_calculation PASSED          [  8%]
tests/test_daily_snapshot.py::test_multiple_products_at_location PASSED  [  8%]
tests/test_daily_snapshot.py::test_in_transit_identification PASSED      [  8%]
tests/test_daily_snapshot.py::test_in_transit_before_departure PASSED    [  8%]
tests/test_daily_snapshot.py::test_in_transit_after_arrival PASSED       [  8%]
tests/test_daily_snapshot.py::test_multi_leg_transit PASSED              [  8%]
tests/test_daily_snapshot.py::test_production_activity_tracking PASSED   [  8%]
tests/test_daily_snapshot.py::test_no_production_on_date PASSED          [  8%]
tests/test_daily_snapshot.py::test_multiple_batches_same_date PASSED     [  8%]
tests/test_daily_snapshot.py::test_inflow_calculation PASSED             [  9%]
tests/test_daily_snapshot.py::test_outflow_calculation PASSED            [  9%]
tests/test_daily_snapshot.py::test_flow_balance PASSED                   [  9%]
tests/test_daily_snapshot.py::test_production_inflow PASSED              [  9%]
tests/test_daily_snapshot.py::test_shipment_arrival_inflow PASSED        [  9%]
tests/test_daily_snapshot.py::test_shipment_departure_outflow PASSED     [  9%]
tests/test_daily_snapshot.py::test_demand_satisfaction_tracking PASSED   [  9%]
tests/test_daily_snapshot.py::test_demand_with_shortage PASSED           [  9%]
tests/test_daily_snapshot.py::test_demand_overfulfillment PASSED         [  9%]
tests/test_daily_snapshot.py::test_no_demand_on_date PASSED              [  9%]
tests/test_daily_snapshot.py::test_future_date_snapshot PASSED           [ 10%]
tests/test_daily_snapshot.py::test_past_date_before_start PASSED         [ 10%]
tests/test_daily_snapshot.py::test_invalid_date_range PASSED             [ 10%]
tests/test_daily_snapshot.py::test_multi_product_multi_location PASSED   [ 10%]
tests/test_daily_snapshot.py::test_full_week_scenario PASSED             [ 10%]
tests/test_daily_snapshot.py::test_hub_spoke_network PASSED              [ 10%]
tests/test_daily_snapshot.py::test_demand_record_fill_rate PASSED        [ 10%]
tests/test_daily_snapshot.py::test_location_inventory_add_batch PASSED   [ 10%]
tests/test_daily_snapshot.py::test_snapshot_string_representation PASSED [ 10%]
tests/test_daily_snapshot.py::test_demand_satisfied_from_prepositioned_inventory PASSED [ 11%]
tests/test_daily_snapshot.py::test_demand_partially_satisfied_from_inventory PASSED [ 11%]
tests/test_daily_snapshot.py::test_demand_satisfied_from_inventory_and_delivery PASSED [ 11%]
tests/test_daily_snapshot.py::test_all_locations_appear_regardless_of_inventory PASSED [ 11%]
tests/test_daily_snapshot.py::test_zero_inventory_locations_included PASSED [ 11%]
tests/test_daily_snapshot.py::test_all_nine_breadrooms_appear PASSED     [ 11%]
tests/test_daily_snapshot.py::test_hub_locations_always_appear PASSED    [ 11%]
tests/test_daily_snapshot.py::test_missing_locations_bug_regression PASSED [ 11%]
tests/test_daily_snapshot.py::test_in_transit_shipments_tracked PASSED   [ 11%]
tests/test_daily_snapshot.py::test_manufacturing_site_always_appears PASSED [ 11%]
tests/test_daily_snapshot.py::test_intermediate_storage_appears_when_used PASSED [ 12%]
tests/test_daily_snapshot.py::test_full_network_all_locations PASSED     [ 12%]
tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_dates_within_planning_horizon FAILED [ 12%]
tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_dates_beyond_schedule_end_excluded FAILED [ 12%]
tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_dates_before_schedule_start_excluded FAILED [ 12%]
tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_shipment_dates_outside_horizon_excluded FAILED [ 12%]
tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_graceful_handling_when_schedule_end_date_none FAILED [ 12%]
tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_mixed_dates_some_inside_some_outside_horizon FAILED [ 12%]
tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_empty_schedule_returns_none FAILED [ 12%]
tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_all_shipment_date_fields_respected FAILED [ 13%]
tests/test_daily_snapshot_ui_styling.py::test_remaining_column_exists_in_dataframe PASSED [ 13%]
tests/test_daily_snapshot_ui_styling.py::test_remaining_column_multiple_batches PASSED [ 13%]
tests/test_daily_snapshot_ui_styling.py::test_styling_function_no_key_error PASSED [ 13%]
tests/test_daily_snapshot_ui_styling.py::test_styling_applied_to_full_dataframe PASSED [ 13%]
tests/test_daily_snapshot_ui_styling.py::test_fresh_batch_green_color PASSED [ 13%]
tests/test_daily_snapshot_ui_styling.py::test_aging_batch_yellow_color PASSED [ 13%]
tests/test_daily_snapshot_ui_styling.py::test_near_expiry_batch_red_color PASSED [ 13%]
tests/test_daily_snapshot_ui_styling.py::test_expired_batch_dark_red_color PASSED [ 13%]
tests/test_daily_snapshot_ui_styling.py::test_boundary_10_days_remaining PASSED [ 13%]
tests/test_daily_snapshot_ui_styling.py::test_boundary_5_days_remaining PASSED [ 14%]
tests/test_daily_snapshot_ui_styling.py::test_boundary_0_days_remaining PASSED [ 14%]
tests/test_daily_snapshot_ui_styling.py::test_empty_batch_list PASSED    [ 14%]
tests/test_daily_snapshot_ui_styling.py::test_single_batch PASSED        [ 14%]
tests/test_daily_snapshot_ui_styling.py::test_very_fresh_batch PASSED    [ 14%]
tests/test_daily_snapshot_ui_styling.py::test_very_old_batch PASSED      [ 14%]
tests/test_daily_snapshot_ui_styling.py::test_color_consistency_across_batches PASSED [ 14%]
tests/test_daily_snapshot_ui_styling.py::test_different_colors_different_ages PASSED [ 14%]
tests/test_daily_snapshot_ui_styling.py::test_full_pipeline_no_key_error PASSED [ 14%]
tests/test_data_validator.py::TestCompletenessChecks::test_no_forecast_critical PASSED [ 14%]
tests/test_data_validator.py::TestCompletenessChecks::test_empty_forecast_critical PASSED [ 15%]
tests/test_data_validator.py::TestCompletenessChecks::test_no_locations_critical PASSED [ 15%]
tests/test_data_validator.py::TestCompletenessChecks::test_no_routes_critical PASSED [ 15%]
tests/test_data_validator.py::TestCompletenessChecks::test_no_labor_calendar_critical PASSED [ 15%]
tests/test_data_validator.py::TestCompletenessChecks::test_no_manufacturing_location_critical PASSED [ 15%]
tests/test_data_validator.py::TestCompletenessChecks::test_all_data_present_passes PASSED [ 15%]
tests/test_data_validator.py::TestConsistencyChecks::test_forecast_invalid_location PASSED [ 15%]
tests/test_data_validator.py::TestConsistencyChecks::test_route_invalid_origin PASSED [ 15%]
tests/test_data_validator.py::TestConsistencyChecks::test_route_invalid_destination PASSED [ 15%]
tests/test_data_validator.py::TestConsistencyChecks::test_truck_schedule_invalid_destination PASSED [ 16%]
tests/test_data_validator.py::TestProductionCapacityChecks::test_demand_exceeds_absolute_capacity PASSED [ 16%]
tests/test_data_validator.py::TestProductionCapacityChecks::test_demand_requires_weekend_work PASSED [ 16%]
tests/test_data_validator.py::TestProductionCapacityChecks::test_demand_requires_overtime PASSED [ 16%]
tests/test_data_validator.py::TestProductionCapacityChecks::test_capacity_sufficient_info PASSED [ 16%]
tests/test_data_validator.py::TestProductionCapacityChecks::test_daily_demand_exceeds_capacity PASSED [ 16%]
tests/test_data_validator.py::TestShelfLifeChecks::test_long_transit_route_warning PASSED [ 16%]
tests/test_data_validator.py::TestShelfLifeChecks::test_destination_needs_frozen_transport PASSED [ 16%]
tests/test_data_validator.py::TestDateRangeChecks::test_forecast_in_past_warning PASSED [ 16%]
tests/test_data_validator.py::TestDateRangeChecks::test_labor_calendar_gap_error PASSED [ 16%]
tests/test_data_validator.py::TestDateRangeChecks::test_short_planning_horizon_warning PASSED [ 17%]
tests/test_data_validator.py::TestDataQualityChecks::test_outlier_detection PASSED [ 17%]
tests/test_data_validator.py::TestDataQualityChecks::test_zero_quantity_warning PASSED [ 17%]
tests/test_data_validator.py::TestDataQualityChecks::test_non_case_quantity_info PASSED [ 17%]
tests/test_data_validator.py::TestBusinessRuleChecks::test_unreachable_destination_critical PASSED [ 17%]
tests/test_data_validator.py::TestValidatorMethods::test_get_summary_stats PASSED [ 17%]
tests/test_data_validator.py::TestValidatorMethods::test_has_critical_issues PASSED [ 17%]
tests/test_data_validator.py::TestValidatorMethods::test_has_no_critical_issues PASSED [ 17%]
tests/test_data_validator.py::TestValidatorMethods::test_is_planning_feasible PASSED [ 17%]
tests/test_data_validator.py::TestTransportCapacityChecks::test_no_truck_schedules_warning PASSED [ 18%]
tests/test_data_validator.py::TestTransportCapacityChecks::test_demand_exceeds_truck_capacity PASSED [ 18%]
tests/test_date_filter.py::TestGetQuickRangeDates::test_all_range_returns_min_max PASSED [ 18%]
tests/test_date_filter.py::TestGetQuickRangeDates::test_week_range_from_today PASSED [ 18%]
tests/test_date_filter.py::TestGetQuickRangeDates::test_two_weeks_range_from_today PASSED [ 18%]
tests/test_date_filter.py::TestGetQuickRangeDates::test_month_range_from_today PASSED [ 18%]
tests/test_date_filter.py::TestGetQuickRangeDates::test_range_capped_at_max_date PASSED [ 18%]
tests/test_date_filter.py::TestGetQuickRangeDates::test_reference_before_min_uses_min_date PASSED [ 18%]
tests/test_date_filter.py::TestGetQuickRangeDates::test_reference_after_max_uses_min_date PASSED [ 18%]
tests/test_date_filter.py::TestGetQuickRangeDates::test_no_reference_defaults_to_today PASSED [ 18%]
tests/test_date_filter.py::TestGetQuickRangeDates::test_handles_date_objects PASSED [ 19%]
tests/test_date_filter.py::TestGetQuickRangeDates::test_custom_range_returns_full_range PASSED [ 19%]
tests/test_date_filter.py::TestApplyDateFilter::test_filters_dataframe_by_date_range PASSED [ 19%]
tests/test_date_filter.py::TestApplyDateFilter::test_includes_boundary_dates PASSED [ 19%]
tests/test_date_filter.py::TestApplyDateFilter::test_empty_dataframe_returns_empty PASSED [ 19%]
tests/test_date_filter.py::TestApplyDateFilter::test_missing_date_column_returns_original PASSED [ 19%]
tests/test_date_filter.py::TestApplyDateFilter::test_handles_date_objects_as_parameters PASSED [ 19%]
tests/test_date_filter.py::TestApplyDateFilter::test_converts_non_datetime_column PASSED [ 19%]
tests/test_date_filter.py::TestApplyDateFilter::test_returns_copy_of_dataframe PASSED [ 19%]
tests/test_date_filter.py::TestApplyDateFilter::test_no_matching_dates_returns_empty PASSED [ 19%]
tests/test_date_filter.py::TestCalculateDateStats::test_calculates_basic_stats PASSED [ 20%]
tests/test_date_filter.py::TestCalculateDateStats::test_handles_no_quantity_column PASSED [ 20%]
tests/test_date_filter.py::TestCalculateDateStats::test_handles_empty_dataframe PASSED [ 20%]
tests/test_date_filter.py::TestCalculateDateStats::test_handles_missing_date_column PASSED [ 20%]
tests/test_date_filter.py::TestCalculateDateStats::test_handles_single_day_range PASSED [ 20%]
tests/test_date_filter.py::TestEdgeCases::test_min_date_equals_max_date PASSED [ 20%]
tests/test_date_filter.py::TestEdgeCases::test_very_large_date_range PASSED [ 20%]
tests/test_date_filter.py::TestEdgeCases::test_leap_year_handling PASSED [ 20%]
tests/test_date_filter.py::TestEdgeCases::test_year_boundary_crossing PASSED [ 20%]
tests/test_fefo_batch_allocator.py::TestBatchCreation::test_creates_batch_from_single_production_event PASSED [ 21%]
tests/test_fefo_batch_allocator.py::TestBatchCreation::test_creates_multiple_batches_for_multiple_products PASSED [ 21%]
tests/test_fefo_batch_allocator.py::TestBatchCreation::test_creates_batches_across_multiple_dates PASSED [ 21%]
tests/test_fefo_batch_allocator.py::TestFEFOShipmentAllocation::test_allocates_from_oldest_batch_first PASSED [ 21%]
tests/test_fefo_batch_allocator.py::TestFEFOShipmentAllocation::test_allocates_from_multiple_batches_when_oldest_insufficient PASSED [ 21%]
tests/test_fefo_batch_allocator.py::TestFEFOShipmentAllocation::test_updates_batch_location_after_shipment PASSED [ 21%]
tests/test_fefo_batch_allocator.py::TestStateTransitions::test_freeze_transition_updates_state_and_entry_date PASSED [ 21%]
tests/test_fefo_batch_allocator.py::TestStateTransitions::test_thaw_transition_updates_state_and_entry_date PASSED [ 21%]
tests/test_fefo_batch_allocator.py::TestStateTransitions::test_partial_freeze_splits_batch PASSED [ 21%]
tests/test_fefo_batch_allocator.py::TestIntegrationWithSlidingWindow::test_process_simple_solution_with_production_and_shipment PASSED [ 21%]
tests/test_force_overtime.py::test_monday_demand_forces_overtime FAILED  [ 22%]
tests/test_forecast_aggregator.py::TestAggregateForecastToBuckets::test_aggregate_daily_to_three_day PASSED [ 22%]
tests/test_forecast_aggregator.py::TestAggregateForecastToBuckets::test_aggregate_daily_to_weekly PASSED [ 22%]
tests/test_forecast_aggregator.py::TestAggregateForecastToBuckets::test_aggregate_preserves_destinations_and_products PASSED [ 22%]
tests/test_forecast_aggregator.py::TestAggregateForecastToBuckets::test_aggregate_to_daily_buckets_no_change PASSED [ 22%]
tests/test_forecast_aggregator.py::TestAggregateForecastToBuckets::test_date_not_in_buckets_raises_error PASSED [ 22%]
tests/test_forecast_aggregator.py::TestAggregateForecastToBuckets::test_empty_forecast_returns_empty PASSED [ 22%]
tests/test_forecast_aggregator.py::TestValidateAggregation::test_validation_passes_for_correct_aggregation PASSED [ 22%]
tests/test_forecast_aggregator.py::TestValidateAggregation::test_validation_detects_total_mismatch PASSED [ 22%]
tests/test_forecast_aggregator.py::TestValidateAggregation::test_validation_by_destination PASSED [ 22%]
tests/test_forecast_aggregator.py::TestDisaggregateToDaily::test_disaggregate_single_bucket_proportional PASSED [ 23%]
tests/test_forecast_aggregator.py::TestDisaggregateToDaily::test_disaggregate_even_distribution_when_no_demand PASSED [ 23%]
tests/test_forecast_aggregator.py::TestDisaggregateToDaily::test_disaggregate_multiple_buckets PASSED [ 23%]
tests/test_forecast_aggregator.py::TestDisaggregateToDaily::test_disaggregate_multiple_products PASSED [ 23%]
tests/test_forecast_editor.py::TestForecastConversion::test_forecast_to_dataframe_basic PASSED [ 23%]
tests/test_forecast_editor.py::TestForecastConversion::test_forecast_to_dataframe_empty PASSED [ 23%]
tests/test_forecast_editor.py::TestForecastConversion::test_dataframe_to_forecast_basic PASSED [ 23%]
tests/test_forecast_editor.py::TestForecastConversion::test_forecast_roundtrip PASSED [ 23%]
tests/test_forecast_editor.py::TestChangeIdentification::test_identify_changes_no_change PASSED [ 23%]
tests/test_forecast_editor.py::TestChangeIdentification::test_identify_changes_with_increase PASSED [ 24%]
tests/test_forecast_editor.py::TestChangeIdentification::test_identify_changes_with_decrease PASSED [ 24%]
tests/test_forecast_editor.py::TestChangeIdentification::test_get_change_summary_no_changes PASSED [ 24%]
tests/test_forecast_editor.py::TestChangeIdentification::test_get_change_summary_with_changes PASSED [ 24%]
tests/test_forecast_editor.py::TestValidation::test_validate_no_changes PASSED [ 24%]
tests/test_forecast_editor.py::TestValidation::test_validate_negative_quantities PASSED [ 24%]
tests/test_forecast_editor.py::TestValidation::test_validate_extreme_percentage_change PASSED [ 24%]
tests/test_forecast_editor.py::TestValidation::test_validate_extreme_absolute_change PASSED [ 24%]
tests/test_forecast_editor.py::TestValidation::test_validate_large_total_change PASSED [ 24%]
tests/test_forecast_editor.py::TestBulkAdjustment::test_bulk_percentage_adjustment_all PASSED [ 24%]
tests/test_forecast_editor.py::TestBulkAdjustment::test_bulk_absolute_adjustment_all PASSED [ 25%]
tests/test_forecast_editor.py::TestBulkAdjustment::test_bulk_adjustment_filtered_by_location PASSED [ 25%]
tests/test_forecast_editor.py::TestBulkAdjustment::test_bulk_adjustment_filtered_by_product PASSED [ 25%]
tests/test_forecast_editor.py::TestBulkAdjustment::test_bulk_adjustment_filtered_by_date PASSED [ 25%]
tests/test_forecast_editor.py::TestBulkAdjustment::test_bulk_adjustment_prevents_negative PASSED [ 25%]
tests/test_forecast_editor.py::TestBulkAdjustment::test_bulk_adjustment_combined_filters PASSED [ 25%]
tests/test_forecast_editor.py::TestImpactMetrics::test_calculate_impact_no_change PASSED [ 25%]
tests/test_forecast_editor.py::TestImpactMetrics::test_calculate_impact_with_increase PASSED [ 25%]
tests/test_forecast_editor.py::TestImpactMetrics::test_calculate_impact_with_decrease PASSED [ 25%]
tests/test_forecast_editor.py::TestImpactMetrics::test_calculate_impact_large_change PASSED [ 26%]
tests/test_forecast_editor.py::TestEndToEndWorkflow::test_complete_editing_workflow PASSED [ 26%]
tests/test_forecast_editor.py::TestEndToEndWorkflow::test_bulk_edit_workflow PASSED [ 26%]
tests/test_highs_solver_integration.py::test_highs_solver_available PASSED [ 26%]
tests/test_highs_solver_integration.py::test_highs_1_week_binary_variables FAILED [ 26%]
tests/test_highs_solver_integration.py::test_highs_2_week_binary_variables FAILED [ 26%]
tests/test_highs_solver_integration.py::test_highs_4_week_binary_variables FAILED [ 26%]
tests/test_highs_solver_integration.py::test_highs_vs_cbc_performance FAILED [ 26%]
tests/test_highs_solver_integration.py::test_highs_sku_reduction FAILED  [ 26%]
tests/test_highs_solver_integration.py::test_highs_warmstart_no_effect FAILED [ 26%]
tests/test_highs_solver_integration.py::test_highs_solution_quality FAILED [ 27%]
tests/test_holding_cost_integration.py::TestHoldingCostIntegration::test_full_optimization_with_holding_costs ERROR [ 27%]
tests/test_holding_cost_integration.py::TestHoldingCostIntegration::test_daily_snapshot_respects_planning_horizon ERROR [ 27%]
tests/test_holding_cost_integration.py::TestHoldingCostIntegration::test_holding_cost_breakdown_proportions ERROR [ 27%]
tests/test_holding_cost_integration.py::TestHoldingCostIntegration::test_zero_holding_costs_no_impact ERROR [ 27%]
tests/test_holding_cost_integration.py::TestHoldingCostIntegration::test_holding_cost_with_initial_inventory ERROR [ 27%]
tests/test_import_validation.py::test_core_optimization_imports PASSED   [ 27%]
tests/test_import_validation.py::test_validation_imports PASSED          [ 27%]
tests/test_import_validation.py::test_model_imports PASSED               [ 27%]
tests/test_import_validation.py::test_solver_config_completeness PASSED  [ 27%]
tests/test_import_validation.py::test_verified_model_importable PASSED   [ 28%]
tests/test_incremental_model_levels.py::test_level1_basic_production_demand PASSED [ 28%]
tests/test_incremental_model_levels.py::test_level2_add_material_balance PASSED [ 28%]
tests/test_incremental_model_levels.py::test_level3_add_initial_inventory PASSED [ 28%]
tests/test_incremental_model_levels.py::test_level4_add_sliding_window PASSED [ 28%]
tests/test_incremental_model_levels.py::test_level5_add_multinode_transport PASSED [ 28%]
tests/test_incremental_model_levels.py::test_level6_add_mix_based_production PASSED [ 28%]
tests/test_incremental_model_levels.py::test_level7_add_truck_capacity PASSED [ 28%]
tests/test_incremental_model_levels.py::test_level8_add_pallet_tracking PASSED [ 28%]
tests/test_incremental_model_levels.py::test_level9_add_multiple_products PASSED [ 29%]
tests/test_incremental_model_levels.py::test_level10_distributed_initial_inventory PASSED [ 29%]
tests/test_incremental_model_levels.py::test_level11_comprehensive_all_features PASSED [ 29%]
tests/test_incremental_model_levels.py::test_level12_sliding_window_all_nodes PASSED [ 29%]
tests/test_incremental_model_levels.py::test_level13_use_intransit_variables PASSED [ 29%]
tests/test_incremental_model_levels.py::test_level14_demand_consumed_in_sliding_window PASSED [ 29%]
tests/test_incremental_model_levels.py::test_level15_dynamic_arrivals_calculation PASSED [ 29%]
tests/test_incremental_model_levels.py::test_level16_sliding_window_with_dynamic_arrivals PASSED [ 29%]
tests/test_integration_ui_workflow.py::test_ui_workflow_4_weeks_with_initial_inventory FAILED [ 29%]
tests/test_integration_ui_workflow.py::test_ui_workflow_4_weeks_with_highs FAILED [ 29%]
tests/test_integration_ui_workflow.py::test_ui_workflow_without_initial_inventory FAILED [ 30%]
tests/test_integration_ui_workflow.py::test_ui_workflow_with_warmstart FAILED [ 30%]
tests/test_integration_ui_workflow.py::test_ui_workflow_4_weeks_sliding_window FAILED [ 30%]
tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_holding_cost_included_in_objective ERROR [ 30%]
tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_frozen_inventory_uses_frozen_storage_rate ERROR [ 30%]
tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_ambient_inventory_uses_ambient_storage_rate ERROR [ 30%]
tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_total_holding_cost_in_solution ERROR [ 30%]
tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_holding_cost_reduces_end_of_horizon_inventory SKIPPED [ 30%]
tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_zero_holding_cost_when_no_inventory ERROR [ 30%]
tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_holding_cost_calculation_from_cohort_inventory ERROR [ 31%]
tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_holding_cost_aggregated_mode_uses_ambient_rate ERROR [ 31%]
tests/test_inventory_unit_conversion.py::test_ea_unit_conversion_1_to_1 PASSED [ 31%]
tests/test_inventory_unit_conversion.py::test_cas_unit_conversion_10_to_1 PASSED [ 31%]
tests/test_inventory_unit_conversion.py::test_unit_conversion_factors[EA-1.0] PASSED [ 31%]
tests/test_inventory_unit_conversion.py::test_unit_conversion_factors[CAS-10.0] PASSED [ 31%]
tests/test_inventory_unit_conversion.py::test_cas_conversion_various_quantities[0.5] PASSED [ 31%]
tests/test_inventory_unit_conversion.py::test_cas_conversion_various_quantities[1.0] PASSED [ 31%]
tests/test_inventory_unit_conversion.py::test_cas_conversion_various_quantities[10.0] PASSED [ 31%]
tests/test_inventory_unit_conversion.py::test_cas_conversion_various_quantities[100.5] PASSED [ 31%]
tests/test_inventory_unit_conversion.py::test_cas_conversion_various_quantities[9999.99] PASSED [ 32%]
tests/test_inventory_unit_conversion.py::test_case_insensitive_unit_types[ea] PASSED [ 32%]
tests/test_inventory_unit_conversion.py::test_case_insensitive_unit_types[EA] PASSED [ 32%]
tests/test_inventory_unit_conversion.py::test_case_insensitive_unit_types[Ea] PASSED [ 32%]
tests/test_inventory_unit_conversion.py::test_case_insensitive_unit_types[eA] PASSED [ 32%]
tests/test_inventory_unit_conversion.py::test_case_insensitive_unit_types[cas] PASSED [ 32%]
tests/test_inventory_unit_conversion.py::test_case_insensitive_unit_types[CAS] PASSED [ 32%]
tests/test_inventory_unit_conversion.py::test_case_insensitive_unit_types[Cas] PASSED [ 32%]
tests/test_inventory_unit_conversion.py::test_case_insensitive_unit_types[cAs] PASSED [ 32%]
tests/test_inventory_unit_conversion.py::test_case_insensitive_unit_types[cAS] PASSED [ 32%]
tests/test_inventory_unit_conversion.py::test_unknown_unit_types_default_to_1_to_1[PALLET] PASSED [ 33%]
tests/test_inventory_unit_conversion.py::test_unknown_unit_types_default_to_1_to_1[BOX] PASSED [ 33%]
tests/test_inventory_unit_conversion.py::test_unknown_unit_types_default_to_1_to_1[KG] PASSED [ 33%]
tests/test_inventory_unit_conversion.py::test_unknown_unit_types_default_to_1_to_1[LBS] PASSED [ 33%]
tests/test_inventory_unit_conversion.py::test_unknown_unit_types_default_to_1_to_1[DOZEN] PASSED [ 33%]
tests/test_inventory_unit_conversion.py::test_unknown_unit_types_default_to_1_to_1[UNIT] PASSED [ 33%]
tests/test_inventory_unit_conversion.py::test_unknown_unit_types_default_to_1_to_1[PKG] PASSED [ 33%]
tests/test_inventory_unit_conversion.py::test_multiple_unknown_units_single_warning PASSED [ 33%]
tests/test_inventory_unit_conversion.py::test_storage_location_5000_excluded PASSED [ 33%]
tests/test_inventory_unit_conversion.py::test_all_entries_storage_5000_result_empty PASSED [ 34%]
tests/test_inventory_unit_conversion.py::test_negative_quantities_set_to_zero_with_warning PASSED [ 34%]
tests/test_inventory_unit_conversion.py::test_multiple_negative_quantities_aggregated_warning PASSED [ 34%]
tests/test_inventory_unit_conversion.py::test_zero_quantities_skipped PASSED [ 34%]
tests/test_inventory_unit_conversion.py::test_very_small_quantities_not_skipped PASSED [ 34%]
tests/test_inventory_unit_conversion.py::test_aggregation_by_material_plant_storage PASSED [ 34%]
tests/test_inventory_unit_conversion.py::test_aggregation_different_plants_separate PASSED [ 34%]
tests/test_inventory_unit_conversion.py::test_aggregation_different_materials_separate PASSED [ 34%]
tests/test_inventory_unit_conversion.py::test_aggregation_mixed_units_converted_before_aggregation PASSED [ 34%]
tests/test_inventory_unit_conversion.py::test_missing_material_column_raises_error PASSED [ 34%]
tests/test_inventory_unit_conversion.py::test_missing_plant_column_raises_error PASSED [ 35%]
tests/test_inventory_unit_conversion.py::test_missing_unrestricted_column_raises_error PASSED [ 35%]
tests/test_inventory_unit_conversion.py::test_missing_base_unit_column_raises_error PASSED [ 35%]
tests/test_inventory_unit_conversion.py::test_missing_storage_location_column_works PASSED [ 35%]
tests/test_inventory_unit_conversion.py::test_empty_file_returns_empty_snapshot PASSED [ 35%]
tests/test_inventory_unit_conversion.py::test_product_alias_resolution_applied PASSED [ 35%]
tests/test_inventory_unit_conversion.py::test_product_alias_aggregation PASSED [ 35%]
tests/test_inventory_unit_conversion.py::test_unmapped_product_warning PASSED [ 35%]
tests/test_inventory_unit_conversion.py::test_to_optimization_dict_structure FAILED [ 35%]
tests/test_inventory_unit_conversion.py::test_to_optimization_dict_aggregates_storage_locations FAILED [ 36%]
tests/test_inventory_unit_conversion.py::test_to_optimization_dict_keeps_plants_separate PASSED [ 36%]
tests/test_inventory_unit_conversion.py::test_get_total_quantity PASSED  [ 36%]
tests/test_inventory_unit_conversion.py::test_get_quantity_by_location PASSED [ 36%]
tests/test_inventory_unit_conversion.py::test_get_quantity_by_product PASSED [ 36%]
tests/test_inventory_unit_conversion.py::test_get_quantity_by_storage_location PASSED [ 36%]
tests/test_inventory_unit_conversion.py::test_real_file_integration PASSED [ 36%]
tests/test_inventory_unit_conversion.py::test_very_large_quantity_handled PASSED [ 36%]
tests/test_inventory_unit_conversion.py::test_null_plant_value_skipped PASSED [ 36%]
tests/test_inventory_unit_conversion.py::test_null_base_unit_treated_as_unknown PASSED [ 36%]
tests/test_inventory_unit_conversion.py::test_snapshot_date_set_correctly PASSED [ 37%]
tests/test_inventory_unit_conversion.py::test_default_snapshot_date_is_today PASSED [ 37%]
tests/test_inventory_unit_conversion.py::test_file_not_found_raises_error PASSED [ 37%]
tests/test_labor_capacity_enforcement.py::test_labor_capacity_enforcement FAILED [ 37%]
tests/test_labor_cost_baseline.py::test_labor_cost_baseline_fixed_day_no_overtime FAILED [ 37%]
tests/test_labor_cost_baseline.py::test_labor_cost_baseline_fixed_day_with_overtime FAILED [ 37%]
tests/test_labor_cost_baseline.py::test_labor_cost_baseline_non_fixed_day FAILED [ 37%]
tests/test_labor_cost_isolation.py::test_labor_cost_only_no_storage FAILED [ 37%]
tests/test_labor_cost_piecewise.py::test_piecewise_fixed_day_no_overtime FAILED [ 37%]
tests/test_labor_cost_piecewise.py::test_piecewise_fixed_day_with_overtime SKIPPED [ 37%]
tests/test_labor_cost_piecewise.py::test_piecewise_non_fixed_day_below_minimum FAILED [ 38%]
tests/test_labor_cost_piecewise.py::test_piecewise_overhead_included FAILED [ 38%]
tests/test_labor_overhead_holiday.py::test_public_holiday_overhead_included FAILED [ 38%]
tests/test_labor_overhead_holiday.py::test_public_holiday_overhead_below_minimum FAILED [ 38%]
tests/test_labor_overhead_multi_day.py::test_multi_day_overhead_consistency FAILED [ 38%]
tests/test_labor_overhead_multi_day.py::test_multi_day_overhead_with_storage FAILED [ 38%]
tests/test_legacy_conversion.py::test_convert_nodes PASSED               [ 38%]
tests/test_legacy_conversion.py::test_convert_routes FAILED              [ 38%]
tests/test_legacy_conversion.py::test_convert_truck_schedules PASSED     [ 38%]
tests/test_legacy_conversion.py::test_convert_all PASSED                 [ 39%]
tests/test_manufacturing_models.py::TestManufacturingSite::test_create_manufacturing_site PASSED [ 39%]
tests/test_manufacturing_models.py::TestManufacturingSite::test_calculate_labor_hours PASSED [ 39%]
tests/test_manufacturing_models.py::TestManufacturingSite::test_calculate_production_units PASSED [ 39%]
tests/test_manufacturing_models.py::TestManufacturingSite::test_can_produce_quantity PASSED [ 39%]
tests/test_manufacturing_models.py::TestTruckSchedule::test_create_morning_truck PASSED [ 39%]
tests/test_manufacturing_models.py::TestTruckSchedule::test_create_flexible_route_truck PASSED [ 39%]
tests/test_manufacturing_models.py::TestTruckSchedule::test_calculate_cost PASSED [ 39%]
tests/test_manufacturing_models.py::TestTruckSchedule::test_calculate_required_pallets PASSED [ 39%]
tests/test_manufacturing_models.py::TestTruckSchedule::test_calculate_required_pallets_exceeds_capacity PASSED [ 39%]
tests/test_manufacturing_models.py::TestTruckSchedule::test_calculate_pallet_efficiency PASSED [ 40%]
tests/test_manufacturing_models.py::TestTruckSchedule::test_validate_case_quantity PASSED [ 40%]
tests/test_manufacturing_models.py::TestTruckSchedule::test_round_to_case_quantity PASSED [ 40%]
tests/test_manufacturing_models.py::TestTruckSchedule::test_has_intermediate_stops PASSED [ 40%]
tests/test_manufacturing_models.py::TestTruckSchedule::test_is_day_specific PASSED [ 40%]
tests/test_manufacturing_models.py::TestLaborCalendar::test_create_fixed_labor_day PASSED [ 40%]
tests/test_manufacturing_models.py::TestLaborCalendar::test_calculate_cost_within_fixed_hours PASSED [ 40%]
tests/test_manufacturing_models.py::TestLaborCalendar::test_calculate_cost_with_overtime PASSED [ 40%]
tests/test_manufacturing_models.py::TestLaborCalendar::test_calculate_cost_non_fixed_day PASSED [ 40%]
tests/test_manufacturing_models.py::TestLaborCalendar::test_labor_calendar PASSED [ 40%]
tests/test_manufacturing_models.py::TestProductionBatch::test_create_production_batch PASSED [ 41%]
tests/test_manufacturing_models.py::TestProductionBatch::test_assign_batch_to_truck PASSED [ 41%]
tests/test_manufacturing_models.py::TestProductionBatch::test_is_same_day_production PASSED [ 41%]
tests/test_manufacturing_models.py::TestProductionBatch::test_is_previous_day_production PASSED [ 41%]
tests/test_manufacturing_models.py::TestCostStructure::test_create_cost_structure PASSED [ 41%]
tests/test_manufacturing_models.py::TestCostStructure::test_calculate_waste_cost PASSED [ 41%]
tests/test_manufacturing_models.py::TestCostStructure::test_calculate_storage_cost PASSED [ 41%]
tests/test_manufacturing_models.py::TestCostStructure::test_calculate_transport_cost PASSED [ 41%]
tests/test_manufacturing_models.py::TestCostStructure::test_calculate_shortage_cost PASSED [ 41%]
tests/test_minimal_reproduction.py::test_minimal_case_single_breadroom_single_day_demand FAILED [ 42%]
tests/test_minimal_reproduction.py::test_minimal_with_multi_day_demand FAILED [ 42%]
tests/test_model_compliance.py::TestSlidingWindowModelCompliance::test_inherits_from_base_model PASSED [ 42%]
tests/test_model_compliance.py::TestSlidingWindowModelCompliance::test_extract_solution_returns_optimization_solution PASSED [ 42%]
tests/test_model_compliance.py::TestUnifiedNodeModelCompliance::test_inherits_from_base_model PASSED [ 42%]
tests/test_model_compliance.py::TestUnifiedNodeModelCompliance::test_extract_solution_returns_optimization_solution PASSED [ 42%]
tests/test_model_compliance.py::TestModelInterfaceContract::test_both_models_have_required_methods PASSED [ 42%]
tests/test_model_compliance.py::TestModelInterfaceContract::test_both_models_return_optimization_solution PASSED [ 42%]
tests/test_models.py::TestLocation::test_create_location PASSED          [ 42%]
tests/test_models.py::TestLocation::test_can_store_mode_both PASSED      [ 42%]
tests/test_models.py::TestLocation::test_can_store_mode_specific PASSED  [ 43%]
tests/test_models.py::TestRoute::test_create_route PASSED                [ 43%]
tests/test_models.py::TestRoute::test_route_with_cost PASSED             [ 43%]
tests/test_models.py::TestProduct::test_create_product_with_defaults PASSED [ 43%]
tests/test_models.py::TestProduct::test_get_shelf_life PASSED            [ 43%]
tests/test_models.py::TestProduct::test_is_acceptable PASSED             [ 43%]
tests/test_models.py::TestProduct::test_units_per_mix_required PASSED    [ 43%]
tests/test_models.py::TestProduct::test_units_per_mix_positive_value PASSED [ 43%]
tests/test_models.py::TestProduct::test_units_per_mix_rejects_zero PASSED [ 43%]
tests/test_models.py::TestProduct::test_units_per_mix_rejects_negative PASSED [ 44%]
tests/test_models.py::TestForecast::test_create_forecast_entry PASSED    [ 44%]
tests/test_models.py::TestForecast::test_create_forecast PASSED          [ 44%]
tests/test_models.py::TestForecast::test_get_demand PASSED               [ 44%]
tests/test_models.py::TestCostStructureFixedPalletCosts::test_get_fixed_pallet_costs_state_specific PASSED [ 44%]
tests/test_models.py::TestCostStructureFixedPalletCosts::test_get_fixed_pallet_costs_legacy_only PASSED [ 44%]
tests/test_models.py::TestCostStructureFixedPalletCosts::test_get_fixed_pallet_costs_defaults PASSED [ 44%]
tests/test_models.py::TestCostStructureFixedPalletCosts::test_get_fixed_pallet_costs_mixed_frozen_only PASSED [ 44%]
tests/test_models.py::TestCostStructureFixedPalletCosts::test_get_fixed_pallet_costs_mixed_ambient_only PASSED [ 44%]
tests/test_models.py::TestCostStructureFixedPalletCosts::test_get_fixed_pallet_costs_state_specific_precedence PASSED [ 44%]
tests/test_models.py::TestCostStructureFixedPalletCosts::test_get_fixed_pallet_costs_zero_values PASSED [ 45%]
tests/test_models.py::TestCostStructureFixedPalletCosts::test_get_fixed_pallet_costs_mixed_with_zero PASSED [ 45%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_init_with_both_files PASSED [ 45%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_init_with_forecast_only PASSED [ 45%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_init_with_network_only PASSED [ 45%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_init_with_no_files PASSED [ 45%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_init_with_missing_file PASSED [ 45%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_parse_locations PASSED [ 45%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_parse_routes PASSED [ 45%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_parse_labor_calendar FAILED [ 45%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_parse_truck_schedules PASSED [ 46%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_parse_cost_structure FAILED [ 46%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_parse_forecast_without_file PASSED [ 46%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_parse_locations_without_file PASSED [ 46%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_parse_all_with_network_only PASSED [ 46%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_validate_consistency_perfect_match PASSED [ 46%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_validate_consistency_missing_locations PASSED [ 46%]
tests/test_multi_file_parser.py::TestMultiFileParser::test_validate_consistency_unused_locations PASSED [ 46%]
tests/test_no_data_limiting.py::test_all_products_used PASSED            [ 46%]
tests/test_no_data_limiting.py::test_all_demand_entries_processed PASSED [ 47%]
tests/test_no_data_limiting.py::test_no_product_slicing_in_code PASSED   [ 47%]
tests/test_overtime_mechanism_validation.py::test_overtime_forced_by_capacity FAILED [ 47%]
tests/test_overtime_mechanism_validation.py::test_overtime_forced_single_day FAILED [ 47%]
tests/test_overtime_minimal.py::test_minimal_overtime_preference FAILED  [ 47%]
tests/test_overtime_preference.py::test_overtime_preference_over_weekend FAILED [ 47%]
tests/test_overtime_preference.py::test_weekend_only_when_necessary FAILED [ 47%]
tests/test_overtime_preference_oct16.py::test_overtime_preference_oct16_4weeks FAILED [ 47%]
tests/test_pallet_based_holding_costs.py::TestPalletRounding::test_partial_pallet_rounds_up[1-1] PASSED [ 47%]
tests/test_pallet_based_holding_costs.py::TestPalletRounding::test_partial_pallet_rounds_up[50-1] PASSED [ 47%]
tests/test_pallet_based_holding_costs.py::TestPalletRounding::test_partial_pallet_rounds_up[160-1] PASSED [ 48%]
tests/test_pallet_based_holding_costs.py::TestPalletRounding::test_partial_pallet_rounds_up[319-1] PASSED [ 48%]
tests/test_pallet_based_holding_costs.py::TestPalletRounding::test_partial_pallet_rounds_up[320-1] PASSED [ 48%]
tests/test_pallet_based_holding_costs.py::TestPalletRounding::test_partial_pallet_rounds_up[321-2] PASSED [ 48%]
tests/test_pallet_based_holding_costs.py::TestPalletRounding::test_partial_pallet_rounds_up[640-2] PASSED [ 48%]
tests/test_pallet_based_holding_costs.py::TestPalletRounding::test_partial_pallet_rounds_up[641-3] PASSED [ 48%]
tests/test_pallet_based_holding_costs.py::TestPalletRounding::test_partial_pallet_rounds_up[1000-4] PASSED [ 48%]
tests/test_pallet_based_holding_costs.py::TestPalletRounding::test_partial_pallet_rounds_up[10000-32] PASSED [ 48%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostCalculation::test_unit_based_costs_work FAILED [ 48%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostCalculation::test_pallet_based_costs_take_precedence FAILED [ 49%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostCalculation::test_zero_holding_costs_skips_pallet_variables FAILED [ 49%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostCalculation::test_frozen_inventory_uses_frozen_rate FAILED [ 49%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostCalculation::test_ambient_inventory_uses_ambient_rate FAILED [ 49%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostIntegration::test_holding_cost_in_objective_function FAILED [ 49%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostIntegration::test_ceiling_constraints_created FAILED [ 49%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostIntegration::test_holding_cost_in_solution_dict SKIPPED [ 49%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostIntegration::test_total_cost_includes_holding_cost SKIPPED [ 49%]
tests/test_pallet_based_holding_costs.py::TestCostBreakdownExtraction::test_result_adapter_imports_holding_cost_breakdown PASSED [ 49%]
tests/test_pallet_based_holding_costs.py::TestCostBreakdownExtraction::test_holding_breakdown_structure PASSED [ 49%]
tests/test_pallet_based_holding_costs.py::TestCostBreakdownExtraction::test_total_cost_breakdown_includes_holding PASSED [ 50%]
tests/test_pallet_based_holding_costs.py::TestCostBreakdownExtraction::test_get_cost_proportions_includes_holding PASSED [ 50%]
tests/test_pallet_based_holding_costs.py::TestBackwardCompatibility::test_total_inventory_cost_alias_exists SKIPPED [ 50%]
tests/test_pallet_based_holding_costs.py::TestBackwardCompatibility::test_zero_costs_behave_as_before FAILED [ 50%]
tests/test_pallet_based_holding_costs.py::TestEdgeCases::test_empty_inventory_zero_holding_cost SKIPPED [ 50%]
tests/test_pallet_based_holding_costs.py::TestEdgeCases::test_very_large_inventory PASSED [ 50%]
tests/test_pallet_based_holding_costs.py::TestEdgeCases::test_negative_storage_rates_raise_error PASSED [ 50%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostOptimization::test_solution_includes_holding_cost_fields FAILED [ 50%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostOptimization::test_holding_cost_in_cost_breakdown FAILED [ 50%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostOptimization::test_holding_cost_proportion_reasonable FAILED [ 50%]
tests/test_pallet_based_holding_costs.py::TestHoldingCostOptimization::test_holding_cost_doesnt_break_feasibility FAILED [ 51%]
tests/test_pallet_based_holding_costs.py::TestPackagingConstants::test_units_per_pallet_constant_exists PASSED [ 51%]
tests/test_pallet_based_holding_costs.py::TestPackagingConstants::test_all_packaging_constants_defined PASSED [ 51%]
tests/test_pallet_based_holding_costs.py::TestPackagingConstants::test_packaging_constants_consistent PASSED [ 51%]
tests/test_pallet_entry_costs.py::TestPalletEntryTracking::test_pallet_entry_variable_exists PASSED [ 51%]
tests/test_pallet_entry_costs.py::TestPalletEntryTracking::test_pallet_entry_constraint_detects_increase PASSED [ 51%]
tests/test_pallet_entry_costs.py::TestPalletEntryTracking::test_fixed_cost_in_objective PASSED [ 51%]
tests/test_parameter_parsing.py::TestManufacturingOverheadParsing::test_parse_manufacturing_overhead_defaults PASSED [ 51%]
tests/test_parameter_parsing.py::TestManufacturingOverheadParsing::test_parse_manufacturing_overhead_custom_values PASSED [ 51%]
tests/test_parameter_parsing.py::TestManufacturingOverheadParsing::test_parse_manufacturing_overhead_missing_columns_legacy_compat PASSED [ 52%]
tests/test_parameter_parsing.py::TestManufacturingOverheadParsing::test_parse_manufacturing_overhead_partial_columns PASSED [ 52%]
tests/test_parameter_parsing.py::TestPalletStorageCostParsing::test_parse_pallet_storage_costs_present PASSED [ 52%]
tests/test_parameter_parsing.py::TestPalletStorageCostParsing::test_parse_pallet_storage_costs_missing_legacy_compat PASSED [ 52%]
tests/test_parameter_parsing.py::TestPalletStorageCostParsing::test_parse_pallet_storage_costs_precedence PASSED [ 52%]
tests/test_parameter_parsing.py::TestPalletStorageCostParsing::test_parse_pallet_storage_costs_partial PASSED [ 52%]
tests/test_parameter_parsing.py::TestUnifiedModelParserOverhead::test_unified_parser_overhead_parameters PASSED [ 52%]
tests/test_parameter_parsing.py::TestUnifiedModelParserOverhead::test_unified_parser_overhead_missing_columns PASSED [ 52%]
tests/test_parameter_parsing.py::TestUnifiedModelParserOverhead::test_unified_parser_overhead_only_for_manufacturing PASSED [ 52%]
tests/test_parameter_parsing.py::TestIntegrationWithOptimizationModel::test_node_capabilities_accessible_in_model PASSED [ 52%]
tests/test_parameter_parsing.py::TestIntegrationWithOptimizationModel::test_cost_structure_pallet_costs_accessible PASSED [ 53%]
tests/test_parameter_parsing.py::TestRealWorldDataFiles::test_parse_real_network_config_file FAILED [ 53%]
tests/test_parameter_parsing.py::TestRealWorldDataFiles::test_parse_real_cost_parameters PASSED [ 53%]
tests/test_parameter_parsing.py::TestErrorHandling::test_missing_production_rate_for_manufacturing PASSED [ 53%]
tests/test_parameter_parsing.py::TestErrorHandling::test_invalid_overhead_values_rejected PASSED [ 53%]
tests/test_parser_alias_integration.py::TestExcelParserWithResolver::test_parse_forecast_with_resolver_mapped_codes PASSED [ 53%]
tests/test_parser_alias_integration.py::TestExcelParserWithResolver::test_parse_forecast_with_resolver_unmapped_codes PASSED [ 53%]
tests/test_parser_alias_integration.py::TestExcelParserWithResolver::test_parse_forecast_without_resolver PASSED [ 53%]
tests/test_parser_alias_integration.py::TestExcelParserWithResolver::test_parse_forecast_quantities_preserved PASSED [ 53%]
tests/test_parser_alias_integration.py::TestSapIbpParserWithResolver::test_parse_sap_ibp_with_resolver PASSED [ 54%]
tests/test_parser_alias_integration.py::TestSapIbpParserWithResolver::test_parse_sap_ibp_without_resolver PASSED [ 54%]
tests/test_parser_alias_integration.py::TestSapIbpParserWithResolver::test_sap_ibp_auto_detect_with_resolver PASSED [ 54%]
tests/test_parser_alias_integration.py::TestMultiFileParserWithAliases::test_auto_load_alias_sheet PASSED [ 54%]
tests/test_parser_alias_integration.py::TestMultiFileParserWithAliases::test_parse_forecast_with_auto_resolution PASSED [ 54%]
tests/test_parser_alias_integration.py::TestMultiFileParserWithAliases::test_without_network_file_no_resolution PASSED [ 54%]
tests/test_parser_alias_integration.py::TestMultiFileParserWithAliases::test_with_network_file_no_alias_sheet PASSED [ 54%]
tests/test_parser_alias_integration.py::TestMultiFileParserWithAliases::test_parse_locations_unaffected PASSED [ 54%]
tests/test_parser_alias_integration.py::TestWarningBehavior::test_warning_for_unmapped_products PASSED [ 54%]
tests/test_parser_alias_integration.py::TestWarningBehavior::test_no_warning_for_all_mapped_products PASSED [ 54%]
tests/test_parser_alias_integration.py::TestWarningBehavior::test_warning_for_wrong_headers PASSED [ 55%]
tests/test_parsers.py::TestExcelParser::test_parser_initialization_with_nonexistent_file PASSED [ 55%]
tests/test_parsers.py::TestExcelParser::test_parser_initialization_with_wrong_extension PASSED [ 55%]
tests/test_parsers.py::TestExcelParserCostStructureStateSpecific::test_parse_cost_structure_with_state_specific_fixed_costs PASSED [ 55%]
tests/test_parsers.py::TestExcelParserCostStructureStateSpecific::test_parse_cost_structure_backward_compatibility PASSED [ 55%]
tests/test_parsers.py::TestExcelParserCostStructureStateSpecific::test_parse_cost_structure_mixed_state_specific_and_legacy PASSED [ 55%]
tests/test_parsers.py::TestExcelParserCostStructureStateSpecific::test_parse_cost_structure_partial_state_specific PASSED [ 55%]
tests/test_parsers.py::TestExcelParserCostStructureStateSpecific::test_parse_cost_structure_zero_state_specific_values PASSED [ 55%]
tests/test_parsers.py::TestExcelParserCostStructureStateSpecific::test_parse_cost_structure_missing_all_fixed_pallet_costs PASSED [ 55%]
tests/test_parsers.py::TestExcelParserCostStructureStateSpecific::test_parse_cost_structure_all_pallet_costs_together PASSED [ 55%]
tests/test_parsers.py::TestExcelParserRealFiles::test_parse_real_network_config_state_specific_costs PASSED [ 56%]
tests/test_parsers.py::TestExcelParserProducts::test_parse_products_with_all_columns PASSED [ 56%]
tests/test_parsers.py::TestExcelParserProducts::test_parse_products_with_minimal_columns PASSED [ 56%]
tests/test_parsers.py::TestExcelParserProducts::test_parse_products_missing_units_per_mix_column PASSED [ 56%]
tests/test_parsers.py::TestExcelParserProducts::test_parse_products_missing_products_sheet PASSED [ 56%]
tests/test_parsers.py::TestExcelParserProducts::test_parse_products_missing_required_column PASSED [ 56%]
tests/test_parsers.py::TestExcelParserProducts::test_parse_products_empty_units_per_mix PASSED [ 56%]
tests/test_parsers.py::TestExcelParserProducts::test_parse_products_from_real_network_config PASSED [ 56%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarAttributes::test_labor_calendar_has_days_attribute PASSED [ 56%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarAttributes::test_labor_calendar_days_is_list PASSED [ 57%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarAttributes::test_labor_calendar_days_contains_labor_day_objects PASSED [ 57%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarMaxDateCalculation::test_labor_calendar_max_date_calculation PASSED [ 57%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarMaxDateCalculation::test_labor_calendar_min_max_date_range PASSED [ 57%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarEmptyHandling::test_labor_calendar_empty_days_list PASSED [ 57%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarEmptyHandling::test_labor_calendar_empty_max_raises_value_error PASSED [ 57%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarNoneHandling::test_labor_calendar_none_handling PASSED [ 57%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarNoneHandling::test_labor_calendar_missing_key_handling PASSED [ 57%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarNoneHandling::test_labor_calendar_none_or_empty_days PASSED [ 57%]
tests/test_planning_ui_labor_calendar.py::TestPlanningHorizonCoverage::test_planning_horizon_within_coverage PASSED [ 57%]
tests/test_planning_ui_labor_calendar.py::TestPlanningHorizonCoverage::test_planning_horizon_exceeds_coverage PASSED [ 58%]
tests/test_planning_ui_labor_calendar.py::TestPlanningHorizonCoverage::test_planning_horizon_exact_coverage PASSED [ 58%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarIntegration::test_correct_attribute_usage_pattern PASSED [ 58%]
tests/test_planning_ui_labor_calendar.py::TestLaborCalendarIntegration::test_full_planning_horizon_check_pattern PASSED [ 58%]
tests/test_product_alias_resolver.py::TestProductAliasResolverInit::test_init_with_valid_file PASSED [ 58%]
tests/test_product_alias_resolver.py::TestProductAliasResolverInit::test_init_with_nonexistent_file PASSED [ 58%]
tests/test_product_alias_resolver.py::TestProductAliasResolverInit::test_init_with_custom_sheet_name PASSED [ 58%]
tests/test_product_alias_resolver.py::TestProductAliasResolverInit::test_init_with_empty_alias_sheet PASSED [ 58%]
tests/test_product_alias_resolver.py::TestProductAliasResolverInit::test_init_with_missing_alias_sheet PASSED [ 58%]
tests/test_product_alias_resolver.py::TestProductAliasResolverParsing::test_parse_with_headers PASSED [ 59%]
tests/test_product_alias_resolver.py::TestProductAliasResolverParsing::test_parse_without_headers PASSED [ 59%]
tests/test_product_alias_resolver.py::TestProductAliasResolverParsing::test_parse_with_wrong_headers PASSED [ 59%]
tests/test_product_alias_resolver.py::TestProductAliasResolverParsing::test_parse_sparse_data PASSED [ 59%]
tests/test_product_alias_resolver.py::TestProductAliasResolverResolution::test_resolve_product_id_mapped_code PASSED [ 59%]
tests/test_product_alias_resolver.py::TestProductAliasResolverResolution::test_resolve_product_id_canonical PASSED [ 59%]
tests/test_product_alias_resolver.py::TestProductAliasResolverResolution::test_resolve_product_id_unmapped_code PASSED [ 59%]
tests/test_product_alias_resolver.py::TestProductAliasResolverResolution::test_resolve_product_id_with_whitespace PASSED [ 59%]
tests/test_product_alias_resolver.py::TestProductAliasResolverResolution::test_resolve_product_id_numeric PASSED [ 59%]
tests/test_product_alias_resolver.py::TestProductAliasResolverQueries::test_is_mapped_for_mapped_code PASSED [ 59%]
tests/test_product_alias_resolver.py::TestProductAliasResolverQueries::test_is_mapped_for_unmapped_code PASSED [ 60%]
tests/test_product_alias_resolver.py::TestProductAliasResolverQueries::test_get_canonical_products PASSED [ 60%]
tests/test_product_alias_resolver.py::TestProductAliasResolverQueries::test_get_canonical_products_immutable PASSED [ 60%]
tests/test_product_alias_resolver.py::TestProductAliasResolverQueries::test_get_all_aliases PASSED [ 60%]
tests/test_product_alias_resolver.py::TestProductAliasResolverQueries::test_get_all_aliases_for_unmapped_product PASSED [ 60%]
tests/test_product_alias_resolver.py::TestProductAliasResolverQueries::test_get_mapping_count PASSED [ 60%]
tests/test_product_alias_resolver.py::TestProductAliasResolverQueries::test_get_mapping_count_empty PASSED [ 60%]
tests/test_product_alias_resolver.py::TestProductAliasResolverStringRepresentation::test_str_representation PASSED [ 60%]
tests/test_production_run_oct16_4weeks.py::test_exact_user_scenario_oct16_4weeks FAILED [ 60%]
tests/test_result_adapter_labor_hours.py::TestLaborHoursDictExtraction::test_labor_hours_dict_format_with_proportional_allocation FAILED [ 60%]
tests/test_result_adapter_labor_hours.py::TestLaborHoursDictExtraction::test_labor_hours_dict_missing_date FAILED [ 61%]
tests/test_result_adapter_labor_hours.py::TestLaborHoursDictExtraction::test_labor_hours_dict_with_zero_values FAILED [ 61%]
tests/test_result_adapter_labor_hours.py::TestLaborHoursDictExtraction::test_labor_hours_dict_missing_used_field FAILED [ 61%]
tests/test_result_adapter_labor_hours.py::TestBackwardCompatibilityNumericLabor::test_labor_hours_numeric_format_still_works FAILED [ 61%]
tests/test_result_adapter_labor_hours.py::TestBackwardCompatibilityNumericLabor::test_labor_hours_mixed_format_graceful_handling FAILED [ 61%]
tests/test_result_adapter_labor_hours.py::TestProductionScheduleDailyLaborHours::test_production_schedule_stores_dict_labor_hours FAILED [ 61%]
tests/test_result_adapter_labor_hours.py::TestProductionScheduleDailyLaborHours::test_production_schedule_total_labor_hours_calculation FAILED [ 61%]
tests/test_result_adapter_labor_hours.py::TestInitialInventoryWithLaborHours::test_initial_inventory_batches_zero_labor_hours FAILED [ 61%]
tests/test_result_adapter_labor_hours.py::TestEdgeCases::test_empty_labor_hours_dict FAILED [ 61%]
tests/test_result_adapter_labor_hours.py::TestEdgeCases::test_missing_labor_hours_by_date_key FAILED [ 62%]
tests/test_result_adapter_labor_hours.py::TestEdgeCases::test_none_labor_hours_value FAILED [ 62%]
tests/test_result_adapter_labor_hours.py::TestCostBreakdownLabor::test_cost_breakdown_handles_dict_labor_hours FAILED [ 62%]
tests/test_result_adapter_labor_hours.py::test_full_adapter_integration_with_dict_labor FAILED [ 62%]
tests/test_result_adapter_labor_hours.py::test_error_detection_dict_multiplication_regression FAILED [ 62%]
tests/test_result_adapter_labor_hours.py::test_error_detection_missing_used_field_regression FAILED [ 62%]
tests/test_result_quality_validation.py::test_holding_cost_not_zero_when_storage_configured SKIPPED [ 62%]
tests/test_result_quality_validation.py::test_fefo_incentive_exists SKIPPED [ 62%]
tests/test_result_quality_validation.py::test_lineage_storage_cost_applied SKIPPED [ 62%]
tests/test_result_quality_validation.py::test_cost_extraction_doesnt_fail_silently FAILED [ 62%]
tests/test_result_schema.py::TestProductionBatchResult::test_valid_batch PASSED [ 63%]
tests/test_result_schema.py::TestProductionBatchResult::test_negative_quantity_fails PASSED [ 63%]
tests/test_result_schema.py::TestProductionBatchResult::test_extra_fields_allowed PASSED [ 63%]
tests/test_result_schema.py::TestLaborHoursBreakdown::test_valid_labor_hours PASSED [ 63%]
tests/test_result_schema.py::TestLaborHoursBreakdown::test_paid_less_than_used_fails PASSED [ 63%]
tests/test_result_schema.py::TestLaborHoursBreakdown::test_defaults_to_zero PASSED [ 63%]
tests/test_result_schema.py::TestShipmentResult::test_valid_shipment PASSED [ 63%]
tests/test_result_schema.py::TestShipmentResult::test_zero_quantity_fails PASSED [ 63%]
tests/test_result_schema.py::TestShipmentResult::test_optional_fields PASSED [ 63%]
tests/test_result_schema.py::TestCostBreakdowns::test_valid_total_cost_breakdown PASSED [ 63%]
tests/test_result_schema.py::TestCostBreakdowns::test_cost_sum_mismatch_fails PASSED [ 64%]
tests/test_result_schema.py::TestOptimizationSolution::test_valid_sliding_window_solution PASSED [ 64%]
tests/test_result_schema.py::TestOptimizationSolution::test_valid_unified_node_solution PASSED [ 64%]
tests/test_result_schema.py::TestOptimizationSolution::test_missing_required_field_fails PASSED [ 64%]
tests/test_result_schema.py::TestOptimizationSolution::test_invalid_fill_rate_fails PASSED [ 64%]
tests/test_result_schema.py::TestOptimizationSolution::test_total_cost_mismatch_fails PASSED [ 64%]
tests/test_result_schema.py::TestOptimizationSolution::test_total_production_mismatch_fails PASSED [ 64%]
tests/test_result_schema.py::TestOptimizationSolution::test_extra_fields_preserved PASSED [ 64%]
tests/test_result_schema.py::TestOptimizationSolution::test_sliding_window_without_aggregate_flag_fails PASSED [ 64%]
tests/test_result_schema.py::TestOptimizationSolution::test_unified_node_without_batch_flag_fails PASSED [ 65%]
tests/test_result_schema.py::TestOptimizationSolution::test_get_inventory_format PASSED [ 65%]
tests/test_result_schema.py::TestOptimizationSolution::test_production_batches_sorted PASSED [ 65%]
tests/test_result_schema.py::TestOptimizationSolution::test_tuple_keys_preserved PASSED [ 65%]
tests/test_result_schema.py::TestStorageState::test_valid_states PASSED  [ 65%]
tests/test_result_schema.py::TestStorageState::test_invalid_state_fails PASSED [ 65%]
tests/test_results_comparison.py::test_format_currency PASSED            [ 65%]
tests/test_results_comparison.py::test_format_number PASSED              [ 65%]
tests/test_results_comparison.py::test_format_percentage PASSED          [ 65%]
tests/test_results_comparison.py::test_calculate_delta PASSED            [ 65%]
tests/test_results_comparison.py::test_color_delta PASSED                [ 66%]
tests/test_results_comparison.py::test_create_delta_display PASSED       [ 66%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_detect_sap_ibp_format_true PASSED [ 66%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_detect_sap_ibp_format_false PASSED [ 66%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_init_with_valid_file PASSED [ 66%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_init_with_missing_file PASSED [ 66%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_init_with_invalid_extension PASSED [ 66%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_find_data_sheet PASSED [ 66%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_read_sap_ibp_data PASSED [ 66%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_parse_date_column_dd_mm_yyyy PASSED [ 67%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_parse_date_column_iso_format PASSED [ 67%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_parse_date_column_invalid PASSED [ 67%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_convert_to_long_format FAILED [ 67%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_convert_full FAILED [ 67%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_convert_locations FAILED [ 67%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_convert_products PASSED [ 67%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_convert_date_range FAILED [ 67%]
tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_convert_and_save PASSED [ 67%]
tests/test_sap_ibp_parser.py::TestSapIbpDetection::test_detect_sap_ibp_format FAILED [ 67%]
tests/test_sap_ibp_parser.py::TestSapIbpDetection::test_detect_sap_ibp_format_standard_file PASSED [ 68%]
tests/test_sap_ibp_parser.py::TestSapIbpDetection::test_detect_sap_ibp_format_nonexistent_file PASSED [ 68%]
tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast FAILED [ 68%]
tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast_data_structure FAILED [ 68%]
tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast_date_range FAILED [ 68%]
tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast_locations FAILED [ 68%]
tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast_products FAILED [ 68%]
tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast_sample_values FAILED [ 68%]
tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast_invalid_sheet PASSED [ 68%]
tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_date_parsing FAILED [ 68%]
tests/test_sap_ibp_parser.py::TestIntegrationWithExcelParser::test_excel_parser_auto_detects_sap_ibp PASSED [ 69%]
tests/test_sap_ibp_parser.py::TestIntegrationWithExcelParser::test_excel_parser_with_standard_format PASSED [ 69%]
tests/test_sap_ibp_parser.py::TestSapIbpParserEdgeCases::test_parse_handles_nan_quantities FAILED [ 69%]
tests/test_sap_ibp_parser.py::TestSapIbpParserEdgeCases::test_parse_converts_ids_to_strings FAILED [ 69%]
tests/test_sap_ibp_parser.py::TestSapIbpParserEdgeCases::test_parse_forecast_entry_count_consistency FAILED [ 69%]
tests/test_sap_ibp_parser.py::TestSapIbpParserEdgeCases::test_parse_no_duplicate_entries FAILED [ 69%]
tests/test_scenario_manager.py::TestScenario::test_scenario_creation PASSED [ 69%]
tests/test_scenario_manager.py::TestScenario::test_scenario_with_metrics PASSED [ 69%]
tests/test_scenario_manager.py::TestScenario::test_scenario_to_dict PASSED [ 69%]
tests/test_scenario_manager.py::TestScenario::test_scenario_from_dict PASSED [ 70%]
tests/test_scenario_manager.py::TestScenarioManager::test_manager_initialization PASSED [ 70%]
tests/test_scenario_manager.py::TestScenarioManager::test_save_scenario PASSED [ 70%]
tests/test_scenario_manager.py::TestScenarioManager::test_save_scenario_generates_unique_ids PASSED [ 70%]
tests/test_scenario_manager.py::TestScenarioManager::test_load_scenario PASSED [ 70%]
tests/test_scenario_manager.py::TestScenarioManager::test_load_nonexistent_scenario PASSED [ 70%]
tests/test_scenario_manager.py::TestScenarioManager::test_list_scenarios_empty PASSED [ 70%]
tests/test_scenario_manager.py::TestScenarioManager::test_list_scenarios PASSED [ 70%]
tests/test_scenario_manager.py::TestScenarioManager::test_list_scenarios_filtered_by_tags PASSED [ 70%]
tests/test_scenario_manager.py::TestScenarioManager::test_list_scenarios_sorted PASSED [ 70%]
tests/test_scenario_manager.py::TestScenarioManager::test_delete_scenario PASSED [ 71%]
tests/test_scenario_manager.py::TestScenarioManager::test_delete_nonexistent_scenario PASSED [ 71%]
tests/test_scenario_manager.py::TestScenarioManager::test_update_scenario PASSED [ 71%]
tests/test_scenario_manager.py::TestScenarioManager::test_update_scenario_partial PASSED [ 71%]
tests/test_scenario_manager.py::TestScenarioManager::test_compare_scenarios PASSED [ 71%]
tests/test_scenario_manager.py::TestScenarioManager::test_export_scenario_pickle PASSED [ 71%]
tests/test_scenario_manager.py::TestScenarioManager::test_export_scenario_json PASSED [ 71%]
tests/test_scenario_manager.py::TestScenarioManager::test_export_scenario_excel PASSED [ 71%]
tests/test_scenario_manager.py::TestScenarioManager::test_export_scenario_invalid_format PASSED [ 71%]
tests/test_scenario_manager.py::TestScenarioManager::test_import_scenario_pickle PASSED [ 72%]
tests/test_scenario_manager.py::TestScenarioManager::test_import_scenario_json PASSED [ 72%]
tests/test_scenario_manager.py::TestScenarioManager::test_import_scenario_nonexistent_file PASSED [ 72%]
tests/test_scenario_manager.py::TestScenarioManager::test_get_storage_size PASSED [ 72%]
tests/test_scenario_manager.py::TestScenarioManager::test_cleanup_orphaned_files PASSED [ 72%]
tests/test_scenario_manager.py::TestScenarioManager::test_scenario_deepcopy_isolation PASSED [ 72%]
tests/test_scenario_manager.py::TestScenarioManager::test_index_persistence PASSED [ 72%]
tests/test_scenario_manager.py::TestScenarioManager::test_concurrent_managers PASSED [ 72%]
tests/test_shelf_life.py::TestProductState::test_shelf_life_days PASSED  [ 72%]
tests/test_shelf_life.py::TestProductState::test_string_representation PASSED [ 72%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_ambient_creation PASSED [ 73%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_thawed_creation_valid PASSED [ 73%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_thawed_creation_missing_thaw_date PASSED [ 73%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_frozen_creation_with_thaw_data PASSED [ 73%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_expiry_date_ambient PASSED [ 73%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_expiry_date_frozen PASSED [ 73%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_expiry_date_thawed PASSED [ 73%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_remaining_shelf_life_ambient PASSED [ 73%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_remaining_shelf_life_thawed PASSED [ 73%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_is_expired PASSED      [ 73%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_age_by_days PASSED     [ 74%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_age_by_days_thawed PASSED [ 74%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_transition_frozen_to_ambient PASSED [ 74%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_transition_frozen_to_thawed PASSED [ 74%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_transition_frozen_to_thawed_no_date PASSED [ 74%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_transition_ambient_invalid PASSED [ 74%]
tests/test_shelf_life.py::TestShelfLifeInfo::test_transition_thawed_invalid PASSED [ 74%]
tests/test_shelf_life.py::TestShelfLifeRules::test_validate_breadroom_acceptance_valid PASSED [ 74%]
tests/test_shelf_life.py::TestShelfLifeRules::test_validate_breadroom_acceptance_exactly_7_days PASSED [ 74%]
tests/test_shelf_life.py::TestShelfLifeRules::test_validate_breadroom_acceptance_insufficient PASSED [ 75%]
tests/test_shelf_life.py::TestShelfLifeRules::test_validate_breadroom_acceptance_expired PASSED [ 75%]
tests/test_shelf_life.py::TestShelfLifeRules::test_can_transition_frozen_to_ambient PASSED [ 75%]
tests/test_shelf_life.py::TestShelfLifeRules::test_can_transition_frozen_to_thawed PASSED [ 75%]
tests/test_shelf_life.py::TestShelfLifeRules::test_can_transition_ambient_invalid PASSED [ 75%]
tests/test_shelf_life.py::TestShelfLifeRules::test_can_transition_same_state PASSED [ 75%]
tests/test_shelf_life.py::TestShelfLifeRules::test_is_compatible_with_transport_mode PASSED [ 75%]
tests/test_shelf_life.py::TestShelfLifeRules::test_suggest_best_state_for_transit_short PASSED [ 75%]
tests/test_shelf_life.py::TestShelfLifeRules::test_suggest_best_state_for_transit_long PASSED [ 75%]
tests/test_shelf_life.py::TestShelfLifeRules::test_suggest_best_state_for_transit_marginal PASSED [ 75%]
tests/test_shelf_life.py::TestShelfLifeTracker::test_simple_ambient_route PASSED [ 76%]
tests/test_shelf_life.py::TestShelfLifeTracker::test_frozen_to_thawed_transition PASSED [ 76%]
tests/test_shelf_life.py::TestShelfLifeTracker::test_breadroom_rejection_insufficient_shelf_life PASSED [ 76%]
tests/test_shelf_life.py::TestShelfLifeTracker::test_validate_route_feasibility_valid PASSED [ 76%]
tests/test_shelf_life.py::TestShelfLifeTracker::test_validate_route_feasibility_too_long PASSED [ 76%]
tests/test_shelf_life.py::TestShelfLifeTracker::test_find_latest_production_date PASSED [ 76%]
tests/test_shelf_life.py::TestShelfLifeTracker::test_auto_transition_frozen_to_ambient PASSED [ 76%]
tests/test_shelf_life.py::TestRouteLeg::test_route_leg_creation PASSED   [ 76%]
tests/test_shelf_life.py::TestRouteLeg::test_route_leg_with_thaw PASSED  [ 76%]
tests/test_sku_reduction_incentive.py::test_zero_demand_skus_not_produced FAILED [ 77%]
tests/test_sku_reduction_incentive.py::test_sku_reduction_cost_benefit FAILED [ 77%]
tests/test_sku_reduction_incentive.py::test_overtime_triggers_sku_reduction FAILED [ 77%]
tests/test_sku_reduction_simple.py::test_model_produces_only_demanded_skus[cbc] FAILED [ 77%]
tests/test_sku_reduction_simple.py::test_model_produces_only_demanded_skus[highs] FAILED [ 77%]
tests/test_sliding_window_ui_integration.py::test_sliding_window_solution_has_shipments ERROR [ 77%]
tests/test_sliding_window_ui_integration.py::test_extract_shipments_uses_pydantic_solution ERROR [ 77%]
tests/test_sliding_window_ui_integration.py::test_init_batches_not_in_production_activity ERROR [ 77%]
tests/test_sliding_window_ui_integration.py::test_solution_validation_catches_missing_shipments ERROR [ 77%]
tests/test_sliding_window_ui_integration.py::test_daily_snapshot_shows_flows ERROR [ 77%]
tests/test_solution_integrity.py::test_4week_solution_integrity FAILED   [ 78%]
tests/test_solution_integrity.py::test_initial_inventory_production_dates FAILED [ 78%]
tests/test_solution_integrity.py::test_weekend_labor_minimum_payment FAILED [ 78%]
tests/test_solution_reasonableness.py::TestSolutionReasonableness::test_1week_production_meets_demand FAILED [ 78%]
tests/test_solution_reasonableness.py::TestSolutionReasonableness::test_4week_production_meets_demand FAILED [ 78%]
tests/test_solution_reasonableness.py::TestSolutionReasonableness::test_4week_conservation_of_flow PASSED [ 78%]
tests/test_solution_reasonableness.py::TestSolutionReasonableness::test_4week_minimal_end_state PASSED [ 78%]
tests/test_solution_reasonableness.py::TestSolutionReasonableness::test_4week_cost_components_reasonable FAILED [ 78%]
tests/test_solution_reasonableness.py::TestLaborLogic::test_4week_no_labor_without_production PASSED [ 78%]
tests/test_solution_reasonableness.py::TestLaborLogic::test_4week_weekend_minimum_hours PASSED [ 78%]
tests/test_solution_reasonableness.py::TestLaborLogic::test_4week_production_on_cheapest_days PASSED [ 79%]
tests/test_solution_reasonableness.py::TestHorizonScaling::test_production_scales_with_demand FAILED [ 79%]
tests/test_solver_config.py::TestSolverInfo::test_create_unavailable_solver_info PASSED [ 79%]
tests/test_solver_config.py::TestSolverInfo::test_create_available_solver_info PASSED [ 79%]
tests/test_solver_config.py::TestSolverInfo::test_solver_info_str_unavailable PASSED [ 79%]
tests/test_solver_config.py::TestSolverInfo::test_solver_info_str_available PASSED [ 79%]
tests/test_solver_config.py::TestSolverInfo::test_solver_info_str_tested PASSED [ 79%]
tests/test_solver_config.py::TestSolverConfig::test_init_detects_solvers PASSED [ 79%]
tests/test_solver_config.py::TestSolverConfig::test_get_available_solvers_none_available FAILED [ 79%]
tests/test_solver_config.py::TestSolverConfig::test_get_available_solvers_some_available PASSED [ 80%]
tests/test_solver_config.py::TestSolverConfig::test_get_solver_info_existing PASSED [ 80%]
tests/test_solver_config.py::TestSolverConfig::test_get_solver_info_non_existing PASSED [ 80%]
tests/test_solver_config.py::TestSolverConfig::test_get_best_available_solver_none_available FAILED [ 80%]
tests/test_solver_config.py::TestSolverConfig::test_get_best_available_solver_prefers_gurobi PASSED [ 80%]
tests/test_solver_config.py::TestSolverConfig::test_get_best_available_solver_falls_back_to_cbc FAILED [ 80%]
tests/test_solver_config.py::TestSolverConfig::test_create_solver_with_specific_name PASSED [ 80%]
tests/test_solver_config.py::TestSolverConfig::test_create_solver_with_options PASSED [ 80%]
tests/test_solver_config.py::TestSolverConfig::test_create_solver_unavailable_raises_error PASSED [ 80%]
tests/test_solver_config.py::TestSolverConfig::test_create_solver_unknown_raises_error PASSED [ 80%]
tests/test_solver_config.py::TestSolverConfig::test_get_platform_info PASSED [ 81%]
tests/test_solver_config.py::TestSolverConfig::test_print_solver_status_no_errors PASSED [ 81%]
tests/test_solver_config.py::TestSolverConfig::test_print_platform_info_no_errors PASSED [ 81%]
tests/test_solver_config.py::TestGlobalConfig::test_get_global_config_creates_singleton PASSED [ 81%]
tests/test_solver_config.py::TestGlobalConfig::test_get_solver_uses_global_config PASSED [ 81%]
tests/test_solver_config.py::TestSolverTesting::test_test_solver_marks_as_tested PASSED [ 81%]
tests/test_solver_config.py::TestSolverTesting::test_test_all_solvers_returns_results PASSED [ 81%]
tests/test_solver_config.py::TestSolverTesting::test_get_working_solvers_after_testing PASSED [ 81%]
tests/test_solver_config.py::TestSolverPreference::test_solver_preference_order FAILED [ 81%]
tests/test_solver_performance_comparison.py::test_solver_performance_1_week FAILED [ 81%]
tests/test_solver_performance_comparison.py::test_solver_performance_2_week FAILED [ 82%]
tests/test_solver_performance_comparison.py::test_solver_performance_4_week FAILED [ 82%]
tests/test_solver_performance_comparison.py::test_solver_performance_continuous_vs_binary SKIPPED [ 82%]
tests/test_solver_timeout_handling.py::test_solution_extraction_with_zero_holding_costs FAILED [ 82%]
tests/test_solver_timeout_handling.py::test_timeout_with_partial_solution PASSED [ 82%]
tests/test_solver_timeout_handling.py::test_objective_extraction_priority PASSED [ 82%]
tests/test_solver_timeout_handling.py::test_stale_variable_check PASSED  [ 82%]
tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_start_tracking_variables_exist ERROR [ 82%]
tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_old_variables_removed ERROR [ 82%]
tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_new_constraints_exist ERROR [ 83%]
tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_start_tracking_solve_1week ERROR [ 83%]
tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_changeover_statistics_extraction ERROR [ 83%]
tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_start_detection_logic ERROR [ 83%]
tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_cost_improvement_vs_baseline ERROR [ 83%]
tests/test_time_period.py::TestBucketGranularity::test_granularity_days PASSED [ 83%]
tests/test_time_period.py::TestTimeBucket::test_create_single_day_bucket PASSED [ 83%]
tests/test_time_period.py::TestTimeBucket::test_create_multi_day_bucket PASSED [ 83%]
tests/test_time_period.py::TestTimeBucket::test_contains_date PASSED     [ 83%]
tests/test_time_period.py::TestTimeBucket::test_end_before_start_raises_error PASSED [ 83%]
tests/test_time_period.py::TestTimeBucket::test_str_single_day PASSED    [ 84%]
tests/test_time_period.py::TestTimeBucket::test_str_multi_day PASSED     [ 84%]
tests/test_time_period.py::TestVariableGranularityConfig::test_create_default_config PASSED [ 84%]
tests/test_time_period.py::TestVariableGranularityConfig::test_create_custom_config PASSED [ 84%]
tests/test_time_period.py::TestCreateDailyBuckets::test_create_single_day PASSED [ 84%]
tests/test_time_period.py::TestCreateDailyBuckets::test_create_one_week PASSED [ 84%]
tests/test_time_period.py::TestCreateDailyBuckets::test_end_before_start_raises_error PASSED [ 84%]
tests/test_time_period.py::TestCreateUniformBuckets::test_create_three_day_buckets_exact_fit PASSED [ 84%]
tests/test_time_period.py::TestCreateUniformBuckets::test_create_three_day_buckets_partial PASSED [ 84%]
tests/test_time_period.py::TestCreateUniformBuckets::test_create_weekly_buckets PASSED [ 85%]
tests/test_time_period.py::TestCreateUniformBuckets::test_create_two_day_buckets PASSED [ 85%]
tests/test_time_period.py::TestCreateUniformBuckets::test_daily_granularity_delegates_to_create_daily PASSED [ 85%]
tests/test_time_period.py::TestCreateVariableGranularityBuckets::test_week1_daily_rest_two_day PASSED [ 85%]
tests/test_time_period.py::TestCreateVariableGranularityBuckets::test_all_near_term_if_horizon_short PASSED [ 85%]
tests/test_time_period.py::TestCreateVariableGranularityBuckets::test_month_daily_rest_weekly PASSED [ 85%]
tests/test_time_period.py::TestGetBucketForDate::test_find_bucket_in_daily_buckets PASSED [ 85%]
tests/test_time_period.py::TestGetBucketForDate::test_find_bucket_in_multi_day_buckets PASSED [ 85%]
tests/test_time_period.py::TestGetBucketForDate::test_date_not_in_buckets_returns_none PASSED [ 85%]
tests/test_time_period.py::TestCalculateBucketReduction::test_three_day_buckets_21_days PASSED [ 85%]
tests/test_time_period.py::TestCalculateBucketReduction::test_weekly_buckets_28_days PASSED [ 86%]
tests/test_time_period.py::TestCalculateBucketReduction::test_daily_buckets_no_reduction PASSED [ 86%]
tests/test_time_period.py::TestCalculateBucketReduction::test_partial_bucket_rounding PASSED [ 86%]
tests/test_truck_routing_fixes.py::test_intermediate_stop_expansion FAILED [ 86%]
tests/test_truck_routing_fixes.py::test_day_of_week_enforcement PASSED   [ 86%]
tests/test_truck_routing_fixes.py::test_lineage_receives_goods FAILED    [ 86%]
tests/test_ui_components_comprehensive.py::TestAllCostChartFunctions::test_render_cost_breakdown_chart PASSED [ 86%]
tests/test_ui_components_comprehensive.py::TestAllCostChartFunctions::test_render_cost_pie_chart PASSED [ 86%]
tests/test_ui_components_comprehensive.py::TestAllCostChartFunctions::test_render_cost_by_category_chart PASSED [ 86%]
tests/test_ui_components_comprehensive.py::TestAllCostChartFunctions::test_render_daily_cost_chart PASSED [ 86%]
tests/test_ui_components_comprehensive.py::TestAllCostChartFunctions::test_render_cost_waterfall_chart SKIPPED [ 87%]
tests/test_ui_components_comprehensive.py::TestAllCostChartFunctions::test_render_cost_waterfall_with_none_cost_per_unit PASSED [ 87%]
tests/test_ui_components_comprehensive.py::TestAllCostChartFunctions::test_render_daily_cost_chart_with_none_cost_by_date PASSED [ 87%]
tests/test_ui_components_comprehensive.py::TestAllDataTableFunctions::test_render_cost_summary_table PASSED [ 87%]
tests/test_ui_components_comprehensive.py::TestAllDataTableFunctions::test_render_cost_breakdown_table PASSED [ 87%]
tests/test_ui_components_comprehensive.py::TestAllDataTableFunctions::test_render_cost_summary_table_with_none_cost_per_unit PASSED [ 87%]
tests/test_ui_components_comprehensive.py::TestAllDataTableFunctions::test_render_labor_breakdown_table PASSED [ 87%]
tests/test_ui_components_comprehensive.py::TestSessionStateWithPydantic::test_create_optimization_summary SKIPPED [ 87%]
tests/test_ui_components_comprehensive.py::TestWorkflowsWithPydantic::test_workflow_validate_solution_accepts_pydantic PASSED [ 87%]
tests/test_ui_integration.py::TestResultAdapterWithPydantic::test_adapt_optimization_results_accepts_pydantic PASSED [ 88%]
tests/test_ui_integration.py::TestCostBreakdownHelpers::test_get_cost_proportions_exists PASSED [ 88%]
tests/test_ui_integration.py::TestCostBreakdownHelpers::test_get_cost_proportions_sums_to_one PASSED [ 88%]
tests/test_ui_integration.py::TestCostBreakdownHelpers::test_nested_costs_use_total_not_total_cost PASSED [ 88%]
tests/test_ui_integration.py::TestPydanticInterfaceNotDict::test_no_get_method PASSED [ 88%]
tests/test_ui_integration.py::TestPydanticInterfaceNotDict::test_no_keys_method PASSED [ 88%]
tests/test_ui_integration.py::TestPydanticInterfaceNotDict::test_no_dict_bracket_access PASSED [ 88%]
tests/test_ui_integration.py::TestPydanticInterfaceNotDict::test_use_attributes_instead PASSED [ 88%]
tests/test_ui_integration.py::TestPydanticInterfaceNotDict::test_use_getattr_for_optional_fields PASSED [ 88%]
tests/test_ui_integration.py::TestUIComponentsWithPydantic::test_cost_charts_accepts_total_cost_breakdown PASSED [ 88%]
tests/test_ui_integration.py::TestUIComponentsWithPydantic::test_production_labeling_accepts_optimization_solution PASSED [ 89%]
tests/test_ui_integration.py::TestAnalysisModulesWithPydantic::test_daily_snapshot_accepts_optimization_solution PASSED [ 89%]
tests/test_ui_integration.py::TestCommonUIPatterns::test_accessing_production_batches PASSED [ 89%]
tests/test_ui_integration.py::TestCommonUIPatterns::test_accessing_labor_hours PASSED [ 89%]
tests/test_ui_integration.py::TestCommonUIPatterns::test_accessing_cost_components PASSED [ 89%]
tests/test_ui_integration.py::TestCommonUIPatterns::test_cost_percentages_calculation PASSED [ 89%]
tests/test_ui_integration_complete.py::test_complete_ui_workflow_with_validation PASSED [ 89%]
tests/test_ui_requirements_validation.py::TestBug1_LabelingDestinations::test_catches_wrong_tuple_length PASSED [ 89%]
tests/test_ui_requirements_validation.py::TestBug1_LabelingDestinations::test_catches_wrong_element_types PASSED [ 89%]
tests/test_ui_requirements_validation.py::TestBug1_LabelingDestinations::test_valid_tuple_structure_passes PASSED [ 90%]
tests/test_ui_requirements_validation.py::TestBug2_TruckAssignments::test_catches_invalid_truck_id PASSED [ 90%]
tests/test_ui_requirements_validation.py::TestBug2_TruckAssignments::test_catches_integer_truck_id PASSED [ 90%]
tests/test_ui_requirements_validation.py::TestBug2_TruckAssignments::test_valid_truck_id_passes PASSED [ 90%]
tests/test_ui_requirements_validation.py::TestBug3_DailySnapshotConsumption::test_catches_missing_demand_consumed PASSED [ 90%]
tests/test_ui_requirements_validation.py::TestBug3_DailySnapshotConsumption::test_catches_empty_demand_consumed PASSED [ 90%]
tests/test_ui_requirements_validation.py::TestBug3_DailySnapshotConsumption::test_valid_demand_consumed_passes PASSED [ 90%]
tests/test_ui_requirements_validation.py::TestBug4_DailyCostsGraph::test_catches_missing_daily_breakdown PASSED [ 90%]
tests/test_ui_requirements_validation.py::TestBug4_DailyCostsGraph::test_catches_empty_daily_breakdown PASSED [ 90%]
tests/test_ui_requirements_validation.py::TestBug4_DailyCostsGraph::test_valid_daily_breakdown_passes PASSED [ 90%]
tests/test_ui_requirements_validation.py::TestComprehensiveValidation::test_validate_all_tabs_catches_multiple_issues PASSED [ 91%]
tests/test_ui_requirements_validation.py::TestComprehensiveValidation::test_validate_solution_for_ui_fail_fast PASSED [ 91%]
tests/test_ui_requirements_validation.py::TestComprehensiveValidation::test_validate_solution_for_ui_comprehensive PASSED [ 91%]
tests/test_ui_requirements_validation.py::test_all_validation_scenarios PASSED [ 91%]
tests/test_ui_tabs_rendering.py::test_production_tab_labor_hours PASSED  [ 91%]
tests/test_ui_tabs_rendering.py::test_labeling_tab_route_states PASSED   [ 91%]
tests/test_ui_tabs_rendering.py::test_distribution_tab_truck_assignments PASSED [ 91%]
tests/test_ui_tabs_rendering.py::test_daily_snapshot_has_flows PASSED    [ 91%]
tests/test_ui_tabs_rendering.py::test_costs_tab_validation PASSED        [ 91%]
tests/test_unified_1week_solve.py::test_unified_model_1week_solves FAILED [ 91%]
tests/test_unified_conditional_pallet_tracking.py::TestUnifiedNodeModelConditionalPalletTracking::test_pallet_tracking_both_states PASSED [ 92%]
tests/test_unified_conditional_pallet_tracking.py::TestUnifiedNodeModelConditionalPalletTracking::test_pallet_tracking_frozen_only PASSED [ 92%]
tests/test_unified_conditional_pallet_tracking.py::TestUnifiedNodeModelConditionalPalletTracking::test_pallet_tracking_ambient_only PASSED [ 92%]
tests/test_unified_conditional_pallet_tracking.py::TestUnifiedNodeModelConditionalPalletTracking::test_pallet_tracking_neither_state FAILED [ 92%]
tests/test_unified_conditional_pallet_tracking.py::TestUnifiedNodeModelConditionalPalletTracking::test_state_specific_fixed_costs_in_objective FAILED [ 92%]
tests/test_unified_core_constraints.py::test_unified_model_builds_with_constraints PASSED [ 92%]
tests/test_unified_model_skeleton.py::test_unified_model_builds PASSED   [ 92%]
tests/test_unified_models.py::test_unified_node_creation FAILED          [ 92%]
tests/test_unified_models.py::test_unified_route_creation PASSED         [ 92%]
tests/test_unified_models.py::test_unified_truck_schedule_creation PASSED [ 93%]
tests/test_unified_models.py::test_pallet_calculations PASSED            [ 93%]
tests/test_unified_produces.py::test_unified_model_produces_without_shortages FAILED [ 93%]
tests/test_unified_solution_extraction.py::test_unified_solution_extraction FAILED [ 93%]
tests/test_unified_state_transitions_full.py::test_freeze_transition_and_shelf_life_reset FAILED [ 93%]
tests/test_unified_state_transitions_full.py::test_thaw_shelf_life_reset_to_14_days PASSED [ 93%]
tests/test_unified_warmstart_integration.py::TestWarmstartGeneration::test_generate_warmstart_method ERROR [ 93%]
tests/test_unified_warmstart_integration.py::TestWarmstartGeneration::test_apply_warmstart_method ERROR [ 93%]
tests/test_unified_warmstart_integration.py::TestWarmstartSolveIntegration::test_solve_with_warmstart_parameter ERROR [ 93%]
tests/test_unified_warmstart_integration.py::TestWarmstartSolveIntegration::test_solve_without_warmstart_still_works ERROR [ 93%]
tests/test_unified_warmstart_integration.py::TestWarmstartSolveIntegration::test_warmstart_custom_hints ERROR [ 94%]
tests/test_unified_warmstart_integration.py::TestWarmstartSolveIntegration::test_warmstart_invalid_hints_graceful ERROR [ 94%]
tests/test_unified_warmstart_integration.py::TestWarmstartSolveIntegration::test_warmstart_partial_hints ERROR [ 94%]
tests/test_unified_warmstart_integration.py::TestWarmstartPerformance::test_warmstart_speedup_measurement FAILED [ 94%]
tests/test_unified_warmstart_integration.py::TestWarmstartPerformance::test_warmstart_generation_overhead PASSED [ 94%]
tests/test_unified_warmstart_integration.py::TestWarmstartPerformance::test_warmstart_application_overhead PASSED [ 94%]
tests/test_unified_weekend_enforcement.py::test_unified_model_weekend_truck_enforcement FAILED [ 94%]
tests/test_unified_zero_cost_scenarios.py::test_zero_transport_costs_solution_extraction FAILED [ 94%]
tests/test_unified_zero_cost_scenarios.py::test_zero_storage_costs_solution_extraction FAILED [ 94%]
tests/test_unified_zero_cost_scenarios.py::test_mixed_zero_nonzero_costs FAILED [ 95%]
tests/test_unified_zero_cost_scenarios.py::test_zero_production_cost FAILED [ 95%]
tests/test_user_data_direct.py::test_user_files_directly PASSED          [ 95%]
tests/test_user_data_infeasibility.py::test_user_data_infeasibility_diagnosis FAILED [ 95%]
tests/test_validation_integration.py::test_data_coordinator_loads_successfully PASSED [ 95%]
tests/test_validation_integration.py::test_sliding_window_with_validated_data PASSED [ 95%]
tests/test_validation_integration.py::test_validation_catches_product_id_mismatch PASSED [ 95%]
tests/test_validation_integration.py::test_validation_catches_invalid_node_reference PASSED [ 95%]
tests/test_validation_utils.py::TestValidateDictHasStringKeys::test_valid_string_keys PASSED [ 95%]
tests/test_validation_utils.py::TestValidateDictHasStringKeys::test_tuple_keys_rejected PASSED [ 95%]
tests/test_validation_utils.py::TestValidateDictHasStringKeys::test_date_keys_rejected PASSED [ 96%]
tests/test_validation_utils.py::TestValidateDictHasStringKeys::test_non_dict_rejected PASSED [ 96%]
tests/test_validation_utils.py::TestValidateFEFOReturnStructure::test_valid_fefo_structure PASSED [ 96%]
tests/test_validation_utils.py::TestValidateFEFOReturnStructure::test_missing_field_rejected PASSED [ 96%]
tests/test_validation_utils.py::TestValidateFEFOReturnStructure::test_tuple_keys_in_batch_inventory_rejected PASSED [ 96%]
tests/test_validation_utils.py::TestValidateFEFOReturnStructure::test_wrong_field_type_rejected PASSED [ 96%]
tests/test_validation_utils.py::TestValidateSolutionDictForPydantic::test_valid_solution_dict PASSED [ 96%]
tests/test_validation_utils.py::TestValidateSolutionDictForPydantic::test_missing_required_field PASSED [ 96%]
tests/test_validation_utils.py::TestValidateSolutionDictForPydantic::test_production_without_batches PASSED [ 96%]
tests/test_validation_utils.py::TestValidateSolutionDictForPydantic::test_production_without_shipments PASSED [ 96%]
tests/test_validation_utils.py::TestValidateOptimizationSolutionComplete::test_valid_complete_solution PASSED [ 97%]
tests/test_validation_utils.py::TestValidateOptimizationSolutionComplete::test_wrong_type_rejected PASSED [ 97%]
tests/test_validation_utils.py::TestValidateOptimizationSolutionComplete::test_batch_sum_mismatch PASSED [ 97%]
tests/test_warmstart_baseline.py::test_6week_warmstart_baseline FAILED   [ 97%]
tests/test_warmstart_enhancements.py::test_pallet_hints_extracted FAILED [ 97%]
tests/test_warmstart_enhancements.py::test_bound_tightening_applied FAILED [ 97%]
tests/test_warmstart_enhancements.py::test_performance_improvement_vs_baseline SKIPPED [ 97%]
tests/test_warmstart_enhancements.py::test_solution_quality_maintained SKIPPED [ 97%]
tests/test_warmstart_enhancements.py::test_enhancement_diagnostics FAILED [ 97%]
tests/test_warmstart_enhancements.py::test_6week_under_time_limit FAILED [ 98%]
tests/test_warmstart_generator_full.py::TestCampaignWarmstartBasic::test_generate_campaign_basic PASSED [ 98%]
tests/test_warmstart_generator_full.py::TestCampaignWarmstartBasic::test_demand_weighted_allocation PASSED [ 98%]
tests/test_warmstart_generator_full.py::TestCampaignWarmstartBasic::test_weekly_pattern_consistency PASSED [ 98%]
tests/test_warmstart_generator_full.py::TestWarmstartConstraints::test_max_skus_per_weekday_enforced PASSED [ 98%]
tests/test_warmstart_generator_full.py::TestWarmstartConstraints::test_weekend_minimization PASSED [ 98%]
tests/test_warmstart_generator_full.py::TestWarmstartConstraints::test_all_skus_produced_weekly PASSED [ 98%]
tests/test_warmstart_generator_full.py::TestWarmstartConstraints::test_load_balancing PASSED [ 98%]
tests/test_warmstart_generator_full.py::TestWarmstartEdgeCases::test_edge_case_zero_demand PASSED [ 98%]
tests/test_warmstart_generator_full.py::TestWarmstartEdgeCases::test_edge_case_single_product PASSED [ 98%]
tests/test_warmstart_generator_full.py::TestWarmstartEdgeCases::test_edge_case_uneven_demand PASSED [ 99%]
tests/test_warmstart_generator_full.py::TestWarmstartMultiWeek::test_multi_week_horizon PASSED [ 99%]
tests/test_warmstart_generator_full.py::TestValidationFunctions::test_validate_warmstart_hints PASSED [ 99%]
tests/test_warmstart_generator_full.py::TestValidationFunctions::test_validate_freshness_constraint PASSED [ 99%]
tests/test_warmstart_generator_full.py::TestValidationFunctions::test_validate_daily_sku_limit PASSED [ 99%]
tests/test_warmstart_generator_full.py::TestCreateDefaultWarmstart::test_create_default_warmstart PASSED [ 99%]
tests/test_warmstart_generator_full.py::TestWarmstartPerformance::test_generation_time_under_1_second PASSED [ 99%]
tests/test_warmstart_performance_comparison.py::test_warmstart_performance_improvement FAILED [ 99%]
tests/test_warmstart_performance_comparison.py::test_warmstart_campaign_pattern_validation FAILED [ 99%]
tests/test_weekly_pattern_warmstart.py::test_weekly_pattern_warmstart_6week FAILED [100%]

==================================== ERRORS ====================================
_____ ERROR at setup of TestSolutionExtraction.test_extract_solution_basic _____
tests/test_daily_rolling_solver.py:43: in parsed_data
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
_ ERROR at setup of TestSolutionExtraction.test_extract_includes_all_variable_types _
tests/test_daily_rolling_solver.py:43: in parsed_data
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
________ ERROR at setup of TestDailyRollingSolver.test_solve_single_day ________
tests/test_daily_rolling_solver.py:43: in parsed_data
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
_____ ERROR at setup of TestDailyRollingSolver.test_solve_two_day_sequence _____
tests/test_daily_rolling_solver.py:43: in parsed_data
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
_________ ERROR at setup of TestDailyRollingSolver.test_solve_sequence _________
tests/test_daily_rolling_solver.py:43: in parsed_data
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
_____ ERROR at setup of TestDailyRollingSolver.test_reset_clears_warmstart _____
tests/test_daily_rolling_solver.py:43: in parsed_data
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
_____ ERROR at setup of TestForecastUpdates.test_forecast_updates_applied ______
tests/test_daily_rolling_solver.py:43: in parsed_data
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
_ ERROR at setup of TestHoldingCostIntegration.test_full_optimization_with_holding_costs _
tests/test_holding_cost_integration.py:126: in test_labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestHoldingCostIntegration.test_daily_snapshot_respects_planning_horizon _
tests/test_holding_cost_integration.py:126: in test_labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestHoldingCostIntegration.test_holding_cost_breakdown_proportions _
tests/test_holding_cost_integration.py:126: in test_labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestHoldingCostIntegration.test_zero_holding_costs_no_impact _
tests/test_holding_cost_integration.py:126: in test_labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestHoldingCostIntegration.test_holding_cost_with_initial_inventory _
tests/test_holding_cost_integration.py:126: in test_labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestInventoryHoldingCosts.test_holding_cost_included_in_objective _
tests/test_inventory_holding_costs.py:97: in labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestInventoryHoldingCosts.test_frozen_inventory_uses_frozen_storage_rate _
tests/test_inventory_holding_costs.py:97: in labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestInventoryHoldingCosts.test_ambient_inventory_uses_ambient_storage_rate _
tests/test_inventory_holding_costs.py:97: in labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestInventoryHoldingCosts.test_total_holding_cost_in_solution _
tests/test_inventory_holding_costs.py:97: in labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestInventoryHoldingCosts.test_zero_holding_cost_when_no_inventory _
tests/test_inventory_holding_costs.py:97: in labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestInventoryHoldingCosts.test_holding_cost_calculation_from_cohort_inventory _
tests/test_inventory_holding_costs.py:97: in labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestInventoryHoldingCosts.test_holding_cost_aggregated_mode_uses_ambient_rate _
tests/test_inventory_holding_costs.py:97: in labor_calendar
    return LaborCalendar(labor_days=labor_days)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for LaborCalendar
E   name
E     Field required [type=missing, input_value={'labor_days': [LaborDay(....0, is_fixed_day=True)]}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_________ ERROR at setup of test_sliding_window_solution_has_shipments _________
tests/test_sliding_window_ui_integration.py:190: in sliding_window_model_4week
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
_______ ERROR at setup of test_extract_shipments_uses_pydantic_solution ________
tests/test_sliding_window_ui_integration.py:190: in sliding_window_model_4week
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
________ ERROR at setup of test_init_batches_not_in_production_activity ________
tests/test_sliding_window_ui_integration.py:190: in sliding_window_model_4week
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
_____ ERROR at setup of test_solution_validation_catches_missing_shipments _____
tests/test_sliding_window_ui_integration.py:190: in sliding_window_model_4week
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
______________ ERROR at setup of test_daily_snapshot_shows_flows _______________
tests/test_sliding_window_ui_integration.py:190: in sliding_window_model_4week
    parser = ExcelParser()
             ^^^^^^^^^^^^^
E   TypeError: ExcelParser.__init__() missing 1 required positional argument: 'file_path'
_ ERROR at setup of TestStartTrackingIntegration.test_start_tracking_variables_exist _
tests/test_start_tracking_integration.py:41: in test_data
    nodes = converter.convert_locations_to_nodes(locations)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'LegacyToUnifiedConverter' object has no attribute 'convert_locations_to_nodes'
__ ERROR at setup of TestStartTrackingIntegration.test_old_variables_removed ___
tests/test_start_tracking_integration.py:41: in test_data
    nodes = converter.convert_locations_to_nodes(locations)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'LegacyToUnifiedConverter' object has no attribute 'convert_locations_to_nodes'
__ ERROR at setup of TestStartTrackingIntegration.test_new_constraints_exist ___
tests/test_start_tracking_integration.py:41: in test_data
    nodes = converter.convert_locations_to_nodes(locations)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'LegacyToUnifiedConverter' object has no attribute 'convert_locations_to_nodes'
_ ERROR at setup of TestStartTrackingIntegration.test_start_tracking_solve_1week _
tests/test_start_tracking_integration.py:41: in test_data
    nodes = converter.convert_locations_to_nodes(locations)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'LegacyToUnifiedConverter' object has no attribute 'convert_locations_to_nodes'
_ ERROR at setup of TestStartTrackingIntegration.test_changeover_statistics_extraction _
tests/test_start_tracking_integration.py:41: in test_data
    nodes = converter.convert_locations_to_nodes(locations)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'LegacyToUnifiedConverter' object has no attribute 'convert_locations_to_nodes'
__ ERROR at setup of TestStartTrackingIntegration.test_start_detection_logic ___
tests/test_start_tracking_integration.py:41: in test_data
    nodes = converter.convert_locations_to_nodes(locations)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'LegacyToUnifiedConverter' object has no attribute 'convert_locations_to_nodes'
_ ERROR at setup of TestStartTrackingIntegration.test_cost_improvement_vs_baseline _
tests/test_start_tracking_integration.py:41: in test_data
    nodes = converter.convert_locations_to_nodes(locations)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'LegacyToUnifiedConverter' object has no attribute 'convert_locations_to_nodes'
___ ERROR at setup of TestWarmstartGeneration.test_generate_warmstart_method ___
tests/test_unified_warmstart_integration.py:79: in small_test_data
    route_1 = UnifiedRoute(
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for UnifiedRoute
E   id
E     Field required [type=missing, input_value={'origin_node_id': '6122'...1, 'cost_per_unit': 0.5}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
____ ERROR at setup of TestWarmstartGeneration.test_apply_warmstart_method _____
tests/test_unified_warmstart_integration.py:79: in small_test_data
    route_1 = UnifiedRoute(
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for UnifiedRoute
E   id
E     Field required [type=missing, input_value={'origin_node_id': '6122'...1, 'cost_per_unit': 0.5}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestWarmstartSolveIntegration.test_solve_with_warmstart_parameter _
tests/test_unified_warmstart_integration.py:79: in small_test_data
    route_1 = UnifiedRoute(
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for UnifiedRoute
E   id
E     Field required [type=missing, input_value={'origin_node_id': '6122'...1, 'cost_per_unit': 0.5}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestWarmstartSolveIntegration.test_solve_without_warmstart_still_works _
tests/test_unified_warmstart_integration.py:79: in small_test_data
    route_1 = UnifiedRoute(
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for UnifiedRoute
E   id
E     Field required [type=missing, input_value={'origin_node_id': '6122'...1, 'cost_per_unit': 0.5}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestWarmstartSolveIntegration.test_warmstart_custom_hints __
tests/test_unified_warmstart_integration.py:79: in small_test_data
    route_1 = UnifiedRoute(
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for UnifiedRoute
E   id
E     Field required [type=missing, input_value={'origin_node_id': '6122'...1, 'cost_per_unit': 0.5}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestWarmstartSolveIntegration.test_warmstart_invalid_hints_graceful _
tests/test_unified_warmstart_integration.py:79: in small_test_data
    route_1 = UnifiedRoute(
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for UnifiedRoute
E   id
E     Field required [type=missing, input_value={'origin_node_id': '6122'...1, 'cost_per_unit': 0.5}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
_ ERROR at setup of TestWarmstartSolveIntegration.test_warmstart_partial_hints _
tests/test_unified_warmstart_integration.py:79: in small_test_data
    route_1 = UnifiedRoute(
E   pydantic_core._pydantic_core.ValidationError: 1 validation error for UnifiedRoute
E   id
E     Field required [type=missing, input_value={'origin_node_id': '6122'...1, 'cost_per_unit': 0.5}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
=================================== FAILURES ===================================
________ TestEndToEndWorkflow.test_forecast_inventory_product_alignment ________
tests/test_alias_e2e.py:155: in test_forecast_inventory_product_alignment
    inventory = parser.parse_inventory()
                ^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/multi_file_parser.py:402: in parse_inventory
    return self._inventory_parser.parse(sheet_name=sheet_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/inventory_parser.py:88: in parse
    raise ValueError(f"Missing required columns: {missing}")
E   ValueError: Missing required columns: {'Base Unit of Measure'}
___________ TestEndToEndWorkflow.test_product_consistency_validation ___________
tests/test_alias_e2e.py:176: in test_product_consistency_validation
    inventory = parser.parse_inventory()
                ^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/multi_file_parser.py:402: in parse_inventory
    return self._inventory_parser.parse(sheet_name=sheet_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/inventory_parser.py:88: in parse
    raise ValueError(f"Missing required columns: {missing}")
E   ValueError: Missing required columns: {'Base Unit of Measure'}
_______ TestInventoryAliasResolution.test_inventory_parser_with_resolver _______
tests/test_alias_e2e.py:256: in test_inventory_parser_with_resolver
    inventory = inv_parser.parse()
                ^^^^^^^^^^^^^^^^^^
src/parsers/inventory_parser.py:88: in parse
    raise ValueError(f"Missing required columns: {missing}")
E   ValueError: Missing required columns: {'Base Unit of Measure'}
_ TestInventoryAliasResolution.test_inventory_quantities_converted_and_resolved _
tests/test_alias_e2e.py:282: in test_inventory_quantities_converted_and_resolved
    inventory = inv_parser.parse()
                ^^^^^^^^^^^^^^^^^^
src/parsers/inventory_parser.py:88: in parse
    raise ValueError(f"Missing required columns: {missing}")
E   ValueError: Missing required columns: {'Base Unit of Measure'}
___________ TestRealWorldScenarios.test_sap_export_with_mixed_codes ____________
tests/test_alias_e2e.py:364: in test_sap_export_with_mixed_codes
    inventory = parser.parse_inventory()
                ^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/multi_file_parser.py:402: in parse_inventory
    return self._inventory_parser.parse(sheet_name=sheet_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/inventory_parser.py:88: in parse
    raise ValueError(f"Missing required columns: {missing}")
E   ValueError: Missing required columns: {'Base Unit of Measure'}
________________________ test_appsi_highs_availability _________________________
tests/test_appsi_highs_solver.py:107: in test_appsi_highs_availability
    assert available is True
E   assert <Availability.FullLicense: 1> is True
----------------------------- Captured stdout call -----------------------------

 APPSI HiGHS available: FullLicense
_________________________ test_appsi_highs_basic_solve _________________________
tests/test_appsi_highs_solver.py:196: in test_appsi_highs_basic_solve
    assert result.is_optimal() or result.is_feasible(), \
E   AssertionError: Expected optimal/feasible, got optimal
E   assert (False or False)
E    +  where False = is_optimal()
E    +    where is_optimal = OptimizationResult(success=False, objective_value=888889.93723, solver_status=None, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=0.9027271270751953, solver_name='appsi_highs', gap=0.0, num_variables=18426, num_constraints=14116, num_integer_vars=884, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (888889.94) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (888889.94) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error", 'error_type': 'ValidationError'}).is_optimal
E    +  and   False = is_feasible()
E    +    where is_feasible = OptimizationResult(success=False, objective_value=888889.93723, solver_status=None, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=0.9027271270751953, solver_name='appsi_highs', gap=0.0, num_variables=18426, num_constraints=14116, num_integer_vars=884, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (888889.94) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (888889.94) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error", 'error_type': 'ValidationError'}).is_feasible
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: APPSI HiGHS Basic Solve
================================================================================
Planning horizon: 2025-10-07 to 2025-10-14 (7 days)

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-14 (8 days)
  Products: 5
  Demand entries: 320
 Model built in 0.01s
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 8 dates, 10 routes
  Production dates for cohorts: 8 in horizon + 0 from initial inventory
  Cohort indices: 12,600 cohorts
  Shipment cohorts by origin node:
    6104: 280
    6122: 525
    6125: 420
    Lineage: 5
  Shipment cohort indices: 1,230
  Demand cohort indices: 2,880
   Truck pallet tracking enabled: 480 integer pallet variables
  Changeover tracking: 8 production days, 40 product indicators (VARIABLE (binary decision))
  Start tracking: 40 start indicators (binary)
  Labor cost variables: 8 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (128 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (8 node-date pairs, 72 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 15 storage delay constraints
   Added truck pallet ceiling constraints: 480 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 180
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 180
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 12,600 total cohorts (4,200 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 2,880 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully

APPSI Solver Results:
  termination_condition: TerminationCondition.optimal
  best_feasible_objective: 888889.93723
  best_objective_bound: 888889.93723
  -> Solver reports OPTIMAL
  -> Solution loaded successfully

Mapping APPSI result to legacy format:
  APPSI termination: TerminationCondition.optimal
  -> Mapped to: optimal, success=True

 APPSI HiGHS SOLVE COMPLETE:
   Status: optimal
   Solve time: 1.8s
   Objective: $888,889.94
   MIP gap: N/A
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
ERROR    src.optimization.base_model:base_model.py:466 CRITICAL: Solution extraction/validation failed (ValidationError): 1 validation error for TotalCostBreakdown
  Value error, total_cost (0.00) does not match sum of components (888889.94) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
_______________________ test_appsi_highs_with_warmstart ________________________
tests/test_appsi_highs_solver.py:304: in test_appsi_highs_with_warmstart
    assert result.is_optimal() or result.is_feasible(), \
E   AssertionError: Expected optimal/feasible, got optimal
E   assert (False or False)
E    +  where False = is_optimal()
E    +    where is_optimal = OptimizationResult(success=False, objective_value=1675103.38552, solver_status=None, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=4.8632214069366455, solver_name='appsi_highs', gap=2.7798958042412686e-16, num_variables=87935, num_constraints=74513, num_integer_vars=1920, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error", 'error_type': 'ValidationError'}).is_optimal
E    +  and   False = is_feasible()
E    +    where is_feasible = OptimizationResult(success=False, objective_value=1675103.38552, solver_status=None, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=4.8632214069366455, solver_name='appsi_highs', gap=2.7798958042412686e-16, num_variables=87935, num_constraints=74513, num_integer_vars=1920, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error", 'error_type': 'ValidationError'}).is_feasible
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: APPSI HiGHS with Warmstart
================================================================================
Planning horizon: 2025-10-07 to 2025-10-21 (14 days)

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-21 (15 days)
  Products: 5
  Demand entries: 600
 Model built

 Warmstart Hints Generated (Campaign Pattern):
  Products: 5
  Weekdays: 11
  Hints: 22 (binary production flags)
  Pattern: 2 SKUs/weekday, 4 weekend days

  Demand Distribution:
    HELGAS GFREE WHOLEM 500G: 24.7% demand  3 weekday slots
    HELGAS GFREE TRAD WHITE 470G: 21.8% demand  2 weekday slots
    HELGAS GFREE MIXED GRAIN 500G: 21.6% demand  2 weekday slots
    WONDER GFREE WHITE 470G: 18.6% demand  2 weekday slots
    WONDER GFREE WHOLEM 500G: 13.4% demand  1 weekday slots
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 15 dates, 10 routes
  Production dates for cohorts: 15 in horizon + 0 from initial inventory
  Cohort indices: 71,400 cohorts
  Shipment cohorts by origin node:
    6104: 770
    6122: 1610
    6125: 1295
    Lineage: 180
  Shipment cohort indices: 3,855
  Demand cohort indices: 9,200
   Truck pallet tracking enabled: 900 integer pallet variables
  Changeover tracking: 15 production days, 75 product indicators (VARIABLE (binary decision))
  Start tracking: 75 start indicators (binary)
  Labor cost variables: 15 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (240 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (15 node-date pairs, 135 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 36 storage delay constraints
   Added truck pallet ceiling constraints: 900 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 600
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 600
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 71,400 total cohorts (23,800 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 9,200 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve

Applying comprehensive warmstart hints...
  Warmstart applied to 22 variables:
    product_produced: 22
  Writing model to workflow_model_debug.lp...
  Model written successfully

APPSI Solver Results:
  termination_condition: TerminationCondition.optimal
  best_feasible_objective: 1675103.38552
  best_objective_bound: 1675103.3855199995
  -> Solver reports OPTIMAL
  -> Solution loaded successfully

Mapping APPSI result to legacy format:
  APPSI termination: TerminationCondition.optimal
  -> Mapped to: optimal, success=True

 APPSI HiGHS WARMSTART SOLVE COMPLETE:
   Status: optimal
   Solve time: 11.3s
   Objective: $1,675,103.39
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
ERROR    src.optimization.base_model:base_model.py:466 CRITICAL: Solution extraction/validation failed (ValidationError): 1 validation error for TotalCostBreakdown
  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
____________________ test_appsi_highs_performance_vs_legacy ____________________
tests/test_appsi_highs_solver.py:363: in test_appsi_highs_performance_vs_legacy
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: APPSI HiGHS vs Legacy Interface Performance
================================================================================

Testing LEGACY HiGHS interface...
___________________ test_baseline_1week_no_initial_inventory ___________________
tests/test_baseline_1week.py:73: in test_baseline_1week_no_initial_inventory
    result = model.solve(time_limit_seconds=90, mip_gap=0.02)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/optimization/unified_node_model.py:1609: in solve
    return super().solve(
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-13 (7 days)
  Products: 5
  Demand entries: 280
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 7 dates, 10 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 8,820 cohorts
  Shipment cohorts by origin node:
    6104: 210
    6122: 390
    6125: 315
  Shipment cohort indices: 915
  Demand cohort indices: 2,240
   Truck pallet tracking enabled: 420 integer pallet variables
  Changeover tracking: 7 production days, 35 product indicators (VARIABLE (binary decision))
  Start tracking: 35 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (112 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 12 storage delay constraints
   Added truck pallet ceiling constraints: 420 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 140
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 140
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 8,820 total cohorts (2,940 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 2,240 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
___________________ test_baseline_2week_no_initial_inventory ___________________
tests/test_baseline_2week.py:64: in test_baseline_2week_no_initial_inventory
    result = model.solve(time_limit_seconds=120, mip_gap=0.02)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/optimization/unified_node_model.py:1609: in solve
    return super().solve(
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-20 (14 days)
  Products: 5
  Demand entries: 560
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 14 dates, 10 routes
  Production dates for cohorts: 14 in horizon + 0 from initial inventory
  Cohort indices: 58,800 cohorts
  Shipment cohorts by origin node:
    6104: 700
    6122: 1440
    6125: 1155
    Lineage: 140
  Shipment cohort indices: 3,435
  Demand cohort indices: 8,160
   Truck pallet tracking enabled: 840 integer pallet variables
  Changeover tracking: 14 production days, 70 product indicators (VARIABLE (binary decision))
  Start tracking: 70 start indicators (binary)
  Labor cost variables: 14 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (224 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (14 node-date pairs, 126 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 33 storage delay constraints
   Added truck pallet ceiling constraints: 840 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 525
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 525
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 58,800 total cohorts (19,600 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 8,160 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
___________________ test_baseline_4week_no_initial_inventory ___________________
tests/test_baseline_4week.py:64: in test_baseline_4week_no_initial_inventory
    result = model.solve(time_limit_seconds=180, mip_gap=0.01)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/optimization/unified_node_model.py:1609: in solve
    return super().solve(
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-11-03 (28 days)
  Products: 5
  Demand entries: 840
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 28 dates, 10 routes
  Production dates for cohorts: 28 in horizon + 0 from initial inventory
  Cohort indices: 392,550 cohorts
  Shipment cohorts by origin node:
    6104: 1680
    6122: 4275
    6125: 3570
    Lineage: 1155
  Shipment cohort indices: 10,680
  Demand cohort indices: 16,560
   Truck pallet tracking enabled: 1,680 integer pallet variables
  Changeover tracking: 28 production days, 140 product indicators (VARIABLE (binary decision))
  Start tracking: 140 start indicators (binary)
  Labor cost variables: 28 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (448 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (28 node-date pairs, 252 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 75 storage delay constraints
   Added truck pallet ceiling constraints: 1,680 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 2,030
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 2,030
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 392,550 total cohorts (130,850 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 16,560 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
_____________________ test_baseline_with_initial_inventory _____________________
tests/test_baseline_initial_inventory.py:73: in test_baseline_with_initial_inventory
    result = model.solve(time_limit_seconds=180, mip_gap=0.01)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/optimization/unified_node_model.py:1609: in solve
    return super().solve(
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

 Preprocessed initial inventory: 23 items, prod_date=2025-11-08, state_entry_date=2025-11-08

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-11-03 (28 days)
  Products: 5
  Demand entries: 840
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 28 dates, 10 routes
  Production dates for cohorts: 28 in horizon + 1 from initial inventory
  Cohort indices: 392,550 cohorts
  Shipment cohorts by origin node:
    6104: 1680
    6122: 4275
    6125: 3570
    Lineage: 1155
  Shipment cohort indices: 10,680
  Demand cohort indices: 16,560
   Truck pallet tracking enabled: 1,680 integer pallet variables
  Changeover tracking: 28 production days, 140 product indicators (VARIABLE (binary decision))
  Start tracking: 140 start indicators (binary)
  Labor cost variables: 28 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (448 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (28 node-date pairs, 252 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 75 storage delay constraints
   Added truck pallet ceiling constraints: 1,680 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 2,030
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 2,030
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 392,550 total cohorts (130,850 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 16,560 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
_______________________ test_baseline_state_transitions ________________________
tests/test_baseline_state_transitions.py:64: in test_baseline_state_transitions
    result = model.solve(time_limit_seconds=120, mip_gap=0.02)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/optimization/unified_node_model.py:1609: in solve
    return super().solve(
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-20 (14 days)
  Products: 5
  Demand entries: 560
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 14 dates, 10 routes
  Production dates for cohorts: 14 in horizon + 0 from initial inventory
  Cohort indices: 58,800 cohorts
  Shipment cohorts by origin node:
    6104: 700
    6122: 1440
    6125: 1155
    Lineage: 140
  Shipment cohort indices: 3,435
  Demand cohort indices: 8,160
   Truck pallet tracking enabled: 840 integer pallet variables
  Changeover tracking: 14 production days, 70 product indicators (VARIABLE (binary decision))
  Start tracking: 70 start indicators (binary)
  Labor cost variables: 14 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (224 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (14 node-date pairs, 126 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 33 storage delay constraints
   Added truck pallet ceiling constraints: 840 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 525
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 525
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 58,800 total cohorts (19,600 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 8,160 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
___________________ test_baseline_weekend_truck_constraints ____________________
tests/test_baseline_weekend_trucks.py:66: in test_baseline_weekend_truck_constraints
    result = model.solve(time_limit_seconds=120, mip_gap=0.02)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/optimization/unified_node_model.py:1609: in solve
    return super().solve(
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-20 (14 days)
  Products: 5
  Demand entries: 560
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 14 dates, 10 routes
  Production dates for cohorts: 14 in horizon + 0 from initial inventory
  Cohort indices: 58,800 cohorts
  Shipment cohorts by origin node:
    6104: 700
    6122: 1440
    6125: 1155
    Lineage: 140
  Shipment cohort indices: 3,435
  Demand cohort indices: 8,160
   Truck pallet tracking enabled: 840 integer pallet variables
  Changeover tracking: 14 production days, 70 product indicators (VARIABLE (binary decision))
  Start tracking: 70 start indicators (binary)
  Labor cost variables: 14 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (224 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (14 node-date pairs, 126 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 33 storage delay constraints
   Added truck pallet ceiling constraints: 840 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 525
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 525
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 58,800 total cohorts (19,600 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 8,160 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
__ TestHoldingCostBreakdown.test_holding_cost_breakdown_string_representation __
tests/test_cost_breakdown_holding.py:62: in test_holding_cost_breakdown_string_representation
    assert 'frozen' in str_repr
E   AssertionError: assert 'frozen' in 'Holding Cost: $150.00 (Frozen: $100.00, Ambient: $50.00)'
____ TestResultAdapterHoldingCost.test_holding_breakdown_created_in_adapter ____
tests/test_cost_breakdown_holding.py:171: in test_holding_breakdown_created_in_adapter
    cost_breakdown = _create_cost_breakdown(mock_model, mock_solution)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:393: in _create_cost_breakdown
    return _create_cost_breakdown_legacy(model, solution)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:518: in _create_cost_breakdown_legacy
    frozen_cost=frozen_holding_cost,
                ^^^^^^^^^^^^^^^^^^^
E   NameError: name 'frozen_holding_cost' is not defined
__ TestResultAdapterHoldingCost.test_holding_breakdown_with_zero_holding_cost __
tests/test_cost_breakdown_holding.py:195: in test_holding_breakdown_with_zero_holding_cost
    cost_breakdown = _create_cost_breakdown(MockModel(), mock_solution)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:393: in _create_cost_breakdown
    return _create_cost_breakdown_legacy(model, solution)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:518: in _create_cost_breakdown_legacy
    frozen_cost=frozen_holding_cost,
                ^^^^^^^^^^^^^^^^^^^
E   NameError: name 'frozen_holding_cost' is not defined
__ TestResultAdapterHoldingCost.test_holding_breakdown_missing_from_solution ___
tests/test_cost_breakdown_holding.py:217: in test_holding_breakdown_missing_from_solution
    cost_breakdown = _create_cost_breakdown(MockModel(), mock_solution)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:393: in _create_cost_breakdown
    return _create_cost_breakdown_legacy(model, solution)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:518: in _create_cost_breakdown_legacy
    frozen_cost=frozen_holding_cost,
                ^^^^^^^^^^^^^^^^^^^
E   NameError: name 'frozen_holding_cost' is not defined
___ TestResultAdapterHoldingCost.test_total_cost_includes_holding_component ____
tests/test_cost_breakdown_holding.py:243: in test_total_cost_includes_holding_component
    cost_breakdown = _create_cost_breakdown(MockModel(), mock_solution)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:393: in _create_cost_breakdown
    return _create_cost_breakdown_legacy(model, solution)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:518: in _create_cost_breakdown_legacy
    frozen_cost=frozen_holding_cost,
                ^^^^^^^^^^^^^^^^^^^
E   NameError: name 'frozen_holding_cost' is not defined
________ TestDailySnapshotDateRange.test_dates_within_planning_horizon _________
tests/test_daily_snapshot_date_range.py:47: in test_dates_within_planning_horizon
    schedule = ProductionSchedule(
E   TypeError: ProductionSchedule.__init__() missing 3 required positional arguments: 'infeasibilities', 'total_units', and 'total_labor_hours'
______ TestDailySnapshotDateRange.test_dates_beyond_schedule_end_excluded ______
tests/test_daily_snapshot_date_range.py:102: in test_dates_beyond_schedule_end_excluded
    schedule = ProductionSchedule(
E   TypeError: ProductionSchedule.__init__() missing 3 required positional arguments: 'infeasibilities', 'total_units', and 'total_labor_hours'
_____ TestDailySnapshotDateRange.test_dates_before_schedule_start_excluded _____
tests/test_daily_snapshot_date_range.py:134: in test_dates_before_schedule_start_excluded
    schedule = ProductionSchedule(
E   TypeError: ProductionSchedule.__init__() missing 3 required positional arguments: 'infeasibilities', 'total_units', and 'total_labor_hours'
___ TestDailySnapshotDateRange.test_shipment_dates_outside_horizon_excluded ____
tests/test_daily_snapshot_date_range.py:198: in test_shipment_dates_outside_horizon_excluded
    schedule = ProductionSchedule(
E   TypeError: ProductionSchedule.__init__() missing 3 required positional arguments: 'infeasibilities', 'total_units', and 'total_labor_hours'
_ TestDailySnapshotDateRange.test_graceful_handling_when_schedule_end_date_none _
tests/test_daily_snapshot_date_range.py:226: in test_graceful_handling_when_schedule_end_date_none
    schedule = ProductionSchedule(
E   TypeError: ProductionSchedule.__init__() missing 3 required positional arguments: 'infeasibilities', 'total_units', and 'total_labor_hours'
_ TestDailySnapshotDateRange.test_mixed_dates_some_inside_some_outside_horizon _
tests/test_daily_snapshot_date_range.py:267: in test_mixed_dates_some_inside_some_outside_horizon
    schedule = ProductionSchedule(
E   TypeError: ProductionSchedule.__init__() missing 3 required positional arguments: 'infeasibilities', 'total_units', and 'total_labor_hours'
_________ TestDailySnapshotDateRange.test_empty_schedule_returns_none __________
tests/test_daily_snapshot_date_range.py:288: in test_empty_schedule_returns_none
    schedule = ProductionSchedule(
E   TypeError: ProductionSchedule.__init__() missing 3 required positional arguments: 'infeasibilities', 'total_units', and 'total_labor_hours'
______ TestDailySnapshotDateRange.test_all_shipment_date_fields_respected ______
tests/test_daily_snapshot_date_range.py:340: in test_all_shipment_date_fields_respected
    schedule = ProductionSchedule(
E   TypeError: ProductionSchedule.__init__() missing 3 required positional arguments: 'infeasibilities', 'total_units', and 'total_labor_hours'
______________________ test_monday_demand_forces_overtime ______________________
tests/test_force_overtime.py:116: in test_monday_demand_forces_overtime
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
FORCE OVERTIME TEST
================================================================================
Demand date: 2025-05-28 (Wednesday)
Production window: Monday or Tuesday (for Wednesday delivery)
Demand quantity: 18,200 units = 13h production
With overhead: 14h total labor
Weekday capacity: 14h (12h regular + 2h OT)
Expected: Produce on Tuesday with 2h overtime

______________________ test_highs_1_week_binary_variables ______________________
tests/test_highs_solver_integration.py:212: in test_highs_1_week_binary_variables
    assert result.is_optimal() or result.is_feasible()
E   assert (False or False)
E    +  where False = is_optimal()
E    +    where is_optimal = OptimizationResult(success=False, objective_value=888889.93723, solver_status=<SolverStatus.ok: 'ok'>, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=0.9217677116394043, solver_name='highs', gap=0.0, num_variables=18426, num_constraints=14116, num_integer_vars=884, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (888889.94) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (888889.94) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error"}).is_optimal
E    +  and   False = is_feasible()
E    +    where is_feasible = OptimizationResult(success=False, objective_value=888889.93723, solver_status=<SolverStatus.ok: 'ok'>, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=0.9217677116394043, solver_name='highs', gap=0.0, num_variables=18426, num_constraints=14116, num_integer_vars=884, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (888889.94) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (888889.94) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error"}).is_feasible
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: HiGHS 1-WEEK HORIZON
================================================================================
Planning horizon: 2025-10-07 to 2025-10-14 (7 days)

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-14 (8 days)
  Products: 5
  Demand entries: 320
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 8 dates, 10 routes
  Production dates for cohorts: 8 in horizon + 0 from initial inventory
  Cohort indices: 12,600 cohorts
  Shipment cohorts by origin node:
    6104: 280
    6122: 525
    6125: 420
    Lineage: 5
  Shipment cohort indices: 1,230
  Demand cohort indices: 2,880
   Truck pallet tracking enabled: 480 integer pallet variables
  Changeover tracking: 8 production days, 40 product indicators (VARIABLE (binary decision))
  Start tracking: 40 start indicators (binary)
  Labor cost variables: 8 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (128 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (8 node-date pairs, 72 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 15 storage delay constraints
   Added truck pallet ceiling constraints: 480 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 180
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 180
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 12,600 total cohorts (4,200 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 2,880 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully

SOLVE RESULTS:
   Status: optimal
   Solve time: 1.9s (expected <10s)
   Objective: $888,889.94
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
ERROR    src.optimization.base_model:base_model.py:713 CRITICAL: Solution extraction/validation failed (ValidationError): 1 validation error for TotalCostBreakdown
  Value error, total_cost (0.00) does not match sum of components (888889.94) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
______________________ test_highs_2_week_binary_variables ______________________
tests/test_highs_solver_integration.py:282: in test_highs_2_week_binary_variables
    assert result.is_optimal() or result.is_feasible()
E   assert (False or False)
E    +  where False = is_optimal()
E    +    where is_optimal = OptimizationResult(success=False, objective_value=1675103.38552, solver_status=<SolverStatus.ok: 'ok'>, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=5.109451770782471, solver_name='highs', gap=2.7798958042412686e-16, num_variables=87935, num_constraints=74513, num_integer_vars=1920, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error"}).is_optimal
E    +  and   False = is_feasible()
E    +    where is_feasible = OptimizationResult(success=False, objective_value=1675103.38552, solver_status=<SolverStatus.ok: 'ok'>, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=5.109451770782471, solver_name='highs', gap=2.7798958042412686e-16, num_variables=87935, num_constraints=74513, num_integer_vars=1920, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error"}).is_feasible
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: HiGHS 2-WEEK HORIZON
================================================================================
Planning horizon: 2025-10-07 to 2025-10-21 (14 days)

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-21 (15 days)
  Products: 5
  Demand entries: 600
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 15 dates, 10 routes
  Production dates for cohorts: 15 in horizon + 0 from initial inventory
  Cohort indices: 71,400 cohorts
  Shipment cohorts by origin node:
    6104: 770
    6122: 1610
    6125: 1295
    Lineage: 180
  Shipment cohort indices: 3,855
  Demand cohort indices: 9,200
   Truck pallet tracking enabled: 900 integer pallet variables
  Changeover tracking: 15 production days, 75 product indicators (VARIABLE (binary decision))
  Start tracking: 75 start indicators (binary)
  Labor cost variables: 15 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (240 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (15 node-date pairs, 135 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 36 storage delay constraints
   Added truck pallet ceiling constraints: 900 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 600
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 600
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 71,400 total cohorts (23,800 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 9,200 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully

SOLVE RESULTS:
   Status: optimal
   Solve time: 15.5s (expected <30s)
   Objective: $1,675,103.39
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
ERROR    src.optimization.base_model:base_model.py:713 CRITICAL: Solution extraction/validation failed (ValidationError): 1 validation error for TotalCostBreakdown
  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
______________________ test_highs_4_week_binary_variables ______________________
tests/test_highs_solver_integration.py:355: in test_highs_4_week_binary_variables
    assert solution is not None
E   assert None is not None
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: HiGHS 4-WEEK HORIZON (PRIMARY BENCHMARK)
================================================================================
Planning horizon: 2025-10-07 to 2025-11-04 (28 days)
Expected performance: ~96s (vs CBC ~226s)

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-11-04 (29 days)
  Products: 5
  Demand entries: 880
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 29 dates, 10 routes
  Production dates for cohorts: 29 in horizon + 0 from initial inventory
  Cohort indices: 429,675 cohorts
  Shipment cohorts by origin node:
    6104: 1750
    6122: 4515
    6125: 3780
    Lineage: 1265
  Shipment cohort indices: 11,310
  Demand cohort indices: 18,160
   Truck pallet tracking enabled: 1,740 integer pallet variables
  Changeover tracking: 29 production days, 145 product indicators (VARIABLE (binary decision))
  Start tracking: 145 start indicators (binary)
  Labor cost variables: 29 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (464 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (29 node-date pairs, 261 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 78 storage delay constraints
   Added truck pallet ceiling constraints: 1,740 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 2,175
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 2,175
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 429,675 total cohorts (143,225 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 18,160 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully

SOLVE RESULTS:
   Status: optimal
   Solve time: 210.6s (expected <120s)
   Objective: $2,484,030.16
   MIP gap: N/A
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
ERROR    src.optimization.base_model:base_model.py:713 CRITICAL: Solution extraction/validation failed (ValidationError): 1 validation error for TotalCostBreakdown
  Value error, total_cost (0.00) does not match sum of components (2484030.16) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
________________________ test_highs_vs_cbc_performance _________________________
tests/test_highs_solver_integration.py:426: in test_highs_vs_cbc_performance
    model_cbc = create_model()
                ^^^^^^^^^^^^^^
tests/test_highs_solver_integration.py:411: in create_model
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: HiGHS VS CBC PERFORMANCE COMPARISON
================================================================================
Planning horizon: 2025-10-07 to 2025-11-04 (28 days)

Solving with CBC...
___________________________ test_highs_sku_reduction ___________________________
tests/test_highs_solver_integration.py:513: in test_highs_sku_reduction
    ForecastEntry(demand_destination, product_ids[0], demand_date, 2000),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: BaseModel.__init__() takes 1 positional argument but 5 were given
________________________ test_highs_warmstart_no_effect ________________________
tests/test_highs_solver_integration.py:635: in test_highs_warmstart_no_effect
    model_no_warmstart = create_model()
                         ^^^^^^^^^^^^^^
tests/test_highs_solver_integration.py:620: in create_model
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: WARMSTART HAS NO EFFECT ON HIGHS
================================================================================

Solving WITHOUT warmstart...
_________________________ test_highs_solution_quality __________________________
tests/test_highs_solver_integration.py:742: in test_highs_solution_quality
    assert result.is_optimal() or result.is_feasible()
E   assert (False or False)
E    +  where False = is_optimal()
E    +    where is_optimal = OptimizationResult(success=False, objective_value=1675103.38552, solver_status=<SolverStatus.ok: 'ok'>, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=6.812049150466919, solver_name='highs', gap=2.7798958042412686e-16, num_variables=87935, num_constraints=74513, num_integer_vars=1920, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error"}).is_optimal
E    +  and   False = is_feasible()
E    +    where is_feasible = OptimizationResult(success=False, objective_value=1675103.38552, solver_status=<SolverStatus.ok: 'ok'>, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=6.812049150466919, solver_name='highs', gap=2.7798958042412686e-16, num_variables=87935, num_constraints=74513, num_integer_vars=1920, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error"}).is_feasible
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: HIGHS SOLUTION QUALITY VALIDATION
================================================================================

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-21 (15 days)
  Products: 5
  Demand entries: 600
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 15 dates, 10 routes
  Production dates for cohorts: 15 in horizon + 0 from initial inventory
  Cohort indices: 71,400 cohorts
  Shipment cohorts by origin node:
    6104: 770
    6122: 1610
    6125: 1295
    Lineage: 180
  Shipment cohort indices: 3,855
  Demand cohort indices: 9,200
   Truck pallet tracking enabled: 900 integer pallet variables
  Changeover tracking: 15 production days, 75 product indicators (VARIABLE (binary decision))
  Start tracking: 75 start indicators (binary)
  Labor cost variables: 15 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (240 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (15 node-date pairs, 135 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 36 storage delay constraints
   Added truck pallet ceiling constraints: 900 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 600
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 600
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 71,400 total cohorts (23,800 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 9,200 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully

SOLVE RESULTS:
   Status: optimal
   Solve time: 6.8s
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
ERROR    src.optimization.base_model:base_model.py:713 CRITICAL: Solution extraction/validation failed (ValidationError): 1 validation error for TotalCostBreakdown
  Value error, total_cost (0.00) does not match sum of components (1675103.39) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
_______________ test_ui_workflow_4_weeks_with_initial_inventory ________________
tests/test_integration_ui_workflow.py:383: in test_ui_workflow_4_weeks_with_initial_inventory
    assert solution is not None, "Solution should not be None"
E   AssertionError: Solution should not be None
E   assert None is not None
----------------------------- Captured stdout call -----------------------------

 Inventory snapshot date: 2025-11-09

================================================================================
DATA SUMMARY
================================================================================
Forecast entries: 20295
Date range: 2025-10-16 to 2027-01-09
Total demand: 5,569,692 units
Nodes: 11
Routes: 10
Labor days: 585
Truck schedules: 11
Initial inventory: 49,581 units at 2025-11-09

Planning horizon: 2025-11-09 to 2025-12-07 (4 weeks)

================================================================================
OPTIMIZATION SETTINGS
================================================================================
allow_shortages: True
enforce_shelf_life: True
use_batch_tracking: True
mip_gap: 0.01
time_limit_seconds: 120
solver_name: appsi_highs
start_date: 2025-11-09
end_date: 2025-12-07

================================================================================
MODEL CREATION
================================================================================

 Preprocessed initial inventory: 39 items, prod_date=2025-11-08, state_entry_date=2025-11-08

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 9
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-11-09 to 2025-12-07 (29 days)
  Products: 5
  Demand entries: 1305
 Model built in 0.01s
  Nodes: 11
  Routes: 10
  Planning horizon: 29 days (4.1 weeks)
  Date range: 2025-11-09 to 2025-12-07
  Batch tracking: ENABLED

================================================================================
SOLVING OPTIMIZATION
================================================================================
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 29 dates, 10 routes
  Production dates for cohorts: 29 in horizon + 1 from initial inventory
  Cohort indices: 466,800 cohorts
  Shipment cohorts by origin node:
    6104: 1810
    6122: 4740
    6125: 2715
    Lineage: 1375
  Shipment cohort indices: 10,640
  Demand cohort indices: 33,210
   Truck pallet tracking enabled: 1,740 integer pallet variables
  Changeover tracking: 29 production days, 145 product indicators (VARIABLE (binary decision))
  Start tracking: 145 start indicators (binary)
  Labor cost variables: 29 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (464 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (29 node-date pairs, 261 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 78 storage delay constraints
   Added truck pallet ceiling constraints: 1,740 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 2,320
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 2,320
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 466,800 total cohorts (155,600 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 33,210 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully

APPSI Solver Results:
  termination_condition: TerminationCondition.optimal
  best_feasible_objective: 3499854.77475
  best_objective_bound: 3499854.77475
  -> Solver reports OPTIMAL
  -> Solution loaded successfully

Mapping APPSI result to legacy format:
  APPSI termination: TerminationCondition.optimal
  -> Mapped to: optimal, success=True
 Solved in 246.44s

================================================================================
SOLUTION SUMMARY
================================================================================
Status: optimal
Objective value: $3,499,854.77
Solve time: 34.20s
Gap: 0.00%
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
ERROR    src.optimization.base_model:base_model.py:466 CRITICAL: Solution extraction/validation failed (ValidationError): 1 validation error for TotalCostBreakdown
  Value error, total_cost (0.00) does not match sum of components (3499854.77) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
_____________________ test_ui_workflow_4_weeks_with_highs ______________________
tests/test_integration_ui_workflow.py:779: in test_ui_workflow_4_weeks_with_highs
    assert result.is_optimal() or result.is_feasible(), \
E   AssertionError: Expected optimal/feasible, got optimal
E   assert (False or False)
E    +  where False = is_optimal()
E    +    where is_optimal = OptimizationResult(success=False, objective_value=3499854.77475, solver_status=<SolverStatus.ok: 'ok'>, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=32.3904595375061, solver_name='highs', gap=0.0, num_variables=518683, num_constraints=474133, num_integer_vars=4872, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (3499854.77) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (3499854.77) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error"}).is_optimal
E    +  and   False = is_feasible()
E    +    where is_feasible = OptimizationResult(success=False, objective_value=3499854.77475, solver_status=<SolverStatus.ok: 'ok'>, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=32.3904595375061, solver_name='highs', gap=0.0, num_variables=518683, num_constraints=474133, num_integer_vars=4872, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (3499854.77) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (3499854.77) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error"}).is_feasible
----------------------------- Captured stdout call -----------------------------

 Inventory snapshot date: 2025-11-09

================================================================================
TEST: 4-WEEK HORIZON WITH HIGHS SOLVER
================================================================================
Planning horizon: 2025-11-09 to 2025-12-07 (4 weeks)
Solver: HiGHS (expected 2.35x speedup over CBC)

 Preprocessed initial inventory: 39 items, prod_date=2025-11-08, state_entry_date=2025-11-08

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 9
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-11-09 to 2025-12-07 (29 days)
  Products: 5
  Demand entries: 1305
 Model built in 0.02s
  Nodes: 11
  Routes: 10
  Planning horizon: 29 days
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 29 dates, 10 routes
  Production dates for cohorts: 29 in horizon + 1 from initial inventory
  Cohort indices: 466,800 cohorts
  Shipment cohorts by origin node:
    6104: 1810
    6122: 4740
    6125: 2715
    Lineage: 1375
  Shipment cohort indices: 10,640
  Demand cohort indices: 33,210
   Truck pallet tracking enabled: 1,740 integer pallet variables
  Changeover tracking: 29 production days, 145 product indicators (VARIABLE (binary decision))
  Start tracking: 145 start indicators (binary)
  Labor cost variables: 29 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (464 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (29 node-date pairs, 261 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 78 storage delay constraints
   Added truck pallet ceiling constraints: 1,740 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 2,320
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 2,320
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 466,800 total cohorts (155,600 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 33,210 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully

 HIGHS SOLVE COMPLETE:
   Status: optimal
   Solve time: 257.5s (expected <400s with mix-based + pallet tracking)
   Objective: $3,499,854.77
   MIP gap: N/A
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
ERROR    src.optimization.base_model:base_model.py:713 CRITICAL: Solution extraction/validation failed (ValidationError): 1 validation error for TotalCostBreakdown
  Value error, total_cost (0.00) does not match sum of components (3499854.77) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
__________________ test_ui_workflow_without_initial_inventory __________________
tests/test_integration_ui_workflow.py:905: in test_ui_workflow_without_initial_inventory
    assert solve_time < 150, f"Solve time {solve_time:.2f}s exceeds 150s threshold"
E   AssertionError: Solve time 240.96s exceeds 150s threshold
E   assert 240.96066308021545 < 150
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: 4-WEEK HORIZON WITHOUT INITIAL INVENTORY
================================================================================
Planning horizon: 2025-10-16 to 2025-11-13

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 9
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-16 to 2025-11-13 (29 days)
  Products: 5
  Demand entries: 1305
 Model built in 0.01s
  Nodes: 11
  Routes: 10
  Planning horizon: 29 days
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 29 dates, 10 routes
  Production dates for cohorts: 29 in horizon + 0 from initial inventory
  Cohort indices: 429,675 cohorts
  Shipment cohorts by origin node:
    6104: 1750
    6122: 4515
    6125: 2625
    Lineage: 1265
  Shipment cohort indices: 10,155
  Demand cohort indices: 31,455
   Truck pallet tracking enabled: 1,740 integer pallet variables
  Changeover tracking: 29 production days, 145 product indicators (VARIABLE (binary decision))
  Start tracking: 145 start indicators (binary)
  Labor cost variables: 29 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (464 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (29 node-date pairs, 261 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 78 storage delay constraints
   Added truck pallet ceiling constraints: 1,740 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 2,175
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 2,175
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 429,675 total cohorts (143,225 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 31,455 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully

APPSI Solver Results:
  termination_condition: TerminationCondition.optimal
  best_feasible_objective: 3492727.31817
  best_objective_bound: 3492727.318169998
  -> Solver reports OPTIMAL
  -> Solution loaded successfully

Mapping APPSI result to legacy format:
  APPSI termination: TerminationCondition.optimal
  -> Mapped to: optimal, success=True
 Solved in 240.96s
  Status: optimal
  Objective: $3,492,727.32
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
ERROR    src.optimization.base_model:base_model.py:466 CRITICAL: Solution extraction/validation failed (ValidationError): 1 validation error for TotalCostBreakdown
  Value error, total_cost (0.00) does not match sum of components (3492727.32) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
_______________________ test_ui_workflow_with_warmstart ________________________
tests/test_integration_ui_workflow.py:1026: in test_ui_workflow_with_warmstart
    assert result.is_optimal() or result.is_feasible(), \
E   AssertionError: Expected optimal/feasible, got optimal
E   assert (False or False)
E    +  where False = is_optimal()
E    +    where is_optimal = OptimizationResult(success=False, objective_value=3499854.77475, solver_status=None, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=39.76667380332947, solver_name='appsi_highs', gap=0.0, num_variables=518683, num_constraints=474133, num_integer_vars=4872, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (3499854.77) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (3499854.77) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error", 'error_type': 'ValidationError'}).is_optimal
E    +  and   False = is_feasible()
E    +    where is_feasible = OptimizationResult(success=False, objective_value=3499854.77475, solver_status=None, termination_condition=<TerminationCondition.optimal: 'optimal'>, solve_time_seconds=39.76667380332947, solver_name='appsi_highs', gap=0.0, num_variables=518683, num_constraints=474133, num_integer_vars=4872, infeasibility_message="Solution extraction failed - data structure invalid:\n1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (3499854.77) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error\n\nThe solver found a solution, but extracting it failed. This is a BUG in the model code that needs fixing.", solver_output=None, metadata={'solution_extraction_failed': True, 'extraction_error': "1 validation error for TotalCostBreakdown\n  Value error, total_cost (0.00) does not match sum of components (3499854.77) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]\n    For further information visit https://errors.pydantic.dev/2.11/v/value_error", 'error_type': 'ValidationError'}).is_feasible
----------------------------- Captured stdout call -----------------------------

 Inventory snapshot date: 2025-11-09

================================================================================
TEST: 4-WEEK HORIZON WITH WARMSTART
================================================================================
Planning horizon: 2025-11-09 to 2025-12-07 (28 days)
Warmstart: ENABLED (campaign-based production pattern)

 Preprocessed initial inventory: 39 items, prod_date=2025-11-08, state_entry_date=2025-11-08

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 9
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-11-09 to 2025-12-07 (29 days)
  Products: 5
  Demand entries: 1305
 Model built in 0.02s
  Nodes: 11
  Routes: 10
  Planning horizon: 29 days

Solving with warmstart...

 Warmstart Hints Generated (Campaign Pattern):
  Products: 5
  Weekdays: 20
  Hints: 40 (binary production flags)
  Pattern: 2 SKUs/weekday, 9 weekend days

  Demand Distribution:
    HELGAS GFREE WHOLEM 500G: 24.7% demand  3 weekday slots
    HELGAS GFREE TRAD WHITE 470G: 21.7% demand  2 weekday slots
    HELGAS GFREE MIXED GRAIN 500G: 21.3% demand  2 weekday slots
    WONDER GFREE WHITE 470G: 18.5% demand  2 weekday slots
    WONDER GFREE WHOLEM 500G: 13.8% demand  1 weekday slots
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 29 dates, 10 routes
  Production dates for cohorts: 29 in horizon + 1 from initial inventory
  Cohort indices: 466,800 cohorts
  Shipment cohorts by origin node:
    6104: 1810
    6122: 4740
    6125: 2715
    Lineage: 1375
  Shipment cohort indices: 10,640
  Demand cohort indices: 33,210
   Truck pallet tracking enabled: 1,740 integer pallet variables
  Changeover tracking: 29 production days, 145 product indicators (VARIABLE (binary decision))
  Start tracking: 145 start indicators (binary)
  Labor cost variables: 29 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (464 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (29 node-date pairs, 261 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 78 storage delay constraints
   Added truck pallet ceiling constraints: 1,740 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 2,320
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 2,320
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 466,800 total cohorts (155,600 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 33,210 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve

Applying comprehensive warmstart hints...
  Warmstart applied to 40 variables:
    product_produced: 40
  Writing model to workflow_model_debug.lp...
  Model written successfully

APPSI Solver Results:
  termination_condition: TerminationCondition.optimal
  best_feasible_objective: 3499854.77475
  best_objective_bound: 3499854.77475
  -> Solver reports OPTIMAL
  -> Solution loaded successfully

Mapping APPSI result to legacy format:
  APPSI termination: TerminationCondition.optimal
  -> Mapped to: optimal, success=True

 WARMSTART SOLVE COMPLETE:
   Status: optimal
   Solve time: 288.5s
   Objective: $3,499,854.77
   MIP gap: N/A
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
ERROR    src.optimization.base_model:base_model.py:466 CRITICAL: Solution extraction/validation failed (ValidationError): 1 validation error for TotalCostBreakdown
  Value error, total_cost (0.00) does not match sum of components (3499854.77) [type=value_error, input_value={'total_cost': 0.0, 'labo..., expiration_waste=0.0)}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
___________________ test_ui_workflow_4_weeks_sliding_window ____________________
tests/test_integration_ui_workflow.py:1162: in test_ui_workflow_4_weeks_sliding_window
    assert solve_time < 30, \
E   AssertionError: Sliding window took 50.9s (expected <30s for 40 minimum speedup)
E   assert 50.9364230632782 < 30
----------------------------- Captured stdout call -----------------------------

 Inventory snapshot date: 2025-11-09

================================================================================
TEST: 4-WEEK HORIZON WITH SLIDING WINDOW MODEL
================================================================================
Planning horizon: 2025-11-09 to 2025-12-07 (4 weeks)
Model: SlidingWindowModel (state-based with sliding window shelf life)

Preprocessing initial inventory:
  Input keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G'), ('6110', 'HELGAS GFREE TRAD WHITE 470G'), ('6122', 'HELGAS GFREE TRAD WHITE 470G')]
  Input entry count: 39
  Initial inventory: 39 entries
  Converted keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient')]
  Converted entry count: 39
  Total quantity: 49,581 units

Validating initial inventory against node capabilities:
   All 39 entries have compatible states and products
   No intermediate stop nodes added
  Manufacturing nodes: 1
  Demand nodes: 9
  Routes FROM Lineage: 1
    - Lineage  6130 (mode=frozen, days=7.0)
  Routes TO Lineage: 1
    - 6122  Lineage (mode=ambient, days=1.0)

Sliding Window Model Initialized:
  Nodes: 11
  Routes: 10
  Products: 5
  Planning horizon: 29 days
  Demand entries: 1305
  Pallet tracking: True
 Model built in 0.02s
Building Pyomo model in solve()...

================================================================================
BUILDING SLIDING WINDOW MODEL [git:08a4ec6]
================================================================================

Sets defined:
  Nodes: 11
  Products: 5
  Dates: 29
  States: 3

Adding variables...
  Production variables: 145
  DEBUG: Creating thawed inventory var for 6130 (has_frozen_inbound=True)
  Inventory variables: 1740
  Checking inventory variables for initial_inventory entries:
    ('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=3785
    ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=285
    ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=6180
    ('6123', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=609
    ('6125', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=3723
  State transition variables: 0 thaw + 0 freeze
  In-transit variables: 2220 (indexed by DEPARTURE date)
    Skipped 680 invalid route-day combinations (day-of-week enforcement)
  Pallet storage variables: 1595 integers
  Pallet entry variables: 1595 integers (for fixed costs)
  Truck pallet variables: 1595 integers
  Demand consumed variables: 1305  2 states = 2610
  Shortage variables: 1305
  Disposal variables: 408 (only for expired inventory)
  Disposal for 34 inventory items
  Binary product indicators: 290
  Changeover aggregation variables: 58 (overhead optimization)
  Labor variables: 29 (used + paid + overtime)
  Mix count variables: 145 integers

Variables created
  Continuous: 4,105
  Integers: 1,595
  Binaries: 290
  TOTAL: 5,990
  (vs cohort model: ~500,000 total)

Adding constraints...

  Adding sliding window shelf life constraints...
  DAY2 ambient_shelf_life[6122, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 960.0 + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE MIXED GRAIN 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 960
  DAY2 ambient_shelf_life[6122, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 6180.0 + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE TRAD WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 6180
  DAY 18 ambient_shelf_life[6122, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 620.0 + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-09] + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 620
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 3080.0 + production['6122',WONDER GFREE WHITE 470G,2025-11-09] + production['6122',WONDER GFREE WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 3080
  DAY 18 ambient_shelf_life[6122, WONDER GFREE WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 280.0 + production['6122',WONDER GFREE WHOLEM 500G,2025-11-09] + production['6122',WONDER GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 280
  DAY2 ambient_shelf_life[6104, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1682.0
    O: in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6104, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6104, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 3785.0
    O: in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6104, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6104, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 2732.0
    O: in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6104, HELGAS GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 1645.0
    O: in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6104, WONDER GFREE WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1444.0
    O: in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6104, WONDER GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1017.0
    O: in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 3723.0
    O: in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 3710.0
    O: in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, HELGAS GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 5728.0
    O: in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, WONDER GFREE WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1692.0
    O: in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, WONDER GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6123, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 595.0 + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 609.0 + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 704.0 + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 404.0 + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 327.0 + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1.0 + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 46.0 + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 259.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 285.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 291.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 280.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 153.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-10]
    Q_frozen (inflows): 1280.0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 1280.0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 1600.0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 1280.0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 960.0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
  Shelf life window constraints: 3,045
    Ambient (17d): ~1,450
    Frozen (120d): ~145
    Thawed (14d): ~1,450

  Adding state balance constraints...
  DEBUG arrivals for 6104, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG frozen_balance[Lineage, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 1280.0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 1280.0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE TRAD WHITE 470G, 2025-11-09]:
    prev_inv: 1280.0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE TRAD WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 1280.0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 1600.0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 1600.0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHITE 470G, 2025-11-09]:
    prev_inv: 1280.0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 1280.0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 960.0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 960.0 + 0 + 0 + arrivals - departures - 0
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 0
    thaw_inflow: 0
    arrivals: 0
    demand_consumption: demand_consumed_from_thawed['6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09]   FIX: Now included!
    Expected: inventory = 0 + thaw + arrivals - demand
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-11-16]:
    prev_inv: inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-11-15]
    thaw_inflow: 0
    arrivals: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    demand_consumption: demand_consumed_from_thawed['6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-16]   FIX: Now included!
    Expected: inventory = inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-11-15] + thaw + arrivals - demand
  State balance constraints: 3,045

  Adding demand satisfaction...
  Demand balance constraints: 1305
  Demand consumption limit constraints added: ambient and thawed (prevents over-consumption)

  Adding pallet constraints...
    Storage pallet ceiling constraints added
    Pallet entry detection constraints added
    Truck pallet ceiling constraints added: 860

  Adding production constraints...
    Mix-based production constraints added
    Production time linking constraints added
    Production capacity limit constraints added
    Overtime detection constraints added
    Labor payment constraints added (4-hour minimum on weekends)

  Adding changeover detection...
    Product-binary bidirectional linking constraints added
    Changeover aggregation linking constraints added (overhead optimization)
    Changeover detection constraints added

  Adding truck constraints...
    Truck capacity constraints added: 319

Constraints added

================================================================================
MODEL STRUCTURE DIAGNOSTIC
================================================================================

Production variables at 6122: 145
  Sample: ('6122', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9))
Ambient balance constraints at 6122: 145
In-transit variables FROM 6122: 480
  Sample: ('6122', '6104', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 10), 'frozen')

 demand_consumed DOES NOT EXIST!

Sliding window constraints at 6122: 145

Overall model:
  Total variables: 13,793
  Total constraints: 12,194
================================================================================


Building objective...
  Production cost: $1.30/unit
  Frozen pallet fixed cost: $14.2600/pallet (on entry)
  Frozen pallet daily cost: $0.9800/pallet/day
  Shortage penalty: $10.00/unit
  Disposal penalty: $15.00/unit (> shortage $10.00/unit)
  Labor cost: Weekday overtime ($660/h) + Weekend ($1320/h with 4h minimum), fixed hours FREE
  Transport cost: route costs included
  Changeover cost: $38.40 per start
  Changeover waste: 30 units per start  $1.30/unit = $39.00 per start
  DEBUG WASTE COST:
    cost_structure.waste_cost_multiplier = 10.0
    After 'or 0' = 10.0
    Type: <class 'float'>
    Condition (waste_multiplier > 0): True
    hasattr(model, 'inventory'): True
     ENTERED waste cost block
    Last date: 2025-12-07
    Inventory variables at last date: 60
    end_inventory expression created (Pyomo sum)
    In-transit variables departing on last date: 60
    end_in_transit expression created (Pyomo sum)
  Waste cost: $13.00/unit  (end_inventory + end_in_transit)
    Coefficient: $13.00/unit
    Expression type: <class 'pyomo.core.expr.numeric_expr.ProductExpression'>
    If end_inventory=32,751, waste would be $425763.00
     WASTE COST EXPRESSION CREATED - WILL BE IN OBJECTIVE
  Binary indicator penalty: $0.0010 per product_produced binary

Objective built
  Active components: production + labor + transport + holding + shortage + disposal + changeover (cost + waste) + waste
  Staleness: IMPLICIT via holding costs (inventory costs money)

Model built successfully
  Writing model to workflow_model_debug.lp...
  Model written successfully

APPSI Solver Results:
  termination_condition: TerminationCondition.optimal
  best_feasible_objective: 580756.9169858887
  best_objective_bound: 569143.798651651
  -> Solver reports OPTIMAL
  -> Solution loaded successfully

Mapping APPSI result to legacy format:
  APPSI termination: TerminationCondition.optimal
  -> Mapped to: optimal, success=True

DEBUG: Extracting holding cost from 1595 pallet_count variables...
  Frozen cost/pallet/day: $0.98
  Ambient cost/pallet/day: $0.00
  Pallet-days: frozen=140, ambient=88664
  Holding cost extracted: frozen=$137.20, ambient=$0.00, total=$137.20

 SLIDING WINDOW SOLVE COMPLETE:
   Status: optimal
   Solve time: 50.9s (expected <10s; baseline cohort = 400s)
   Speedup: 8 faster than cohort baseline
   Objective: $580,756.92
   MIP gap: 2.00%
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
WARNING  src.optimization.sliding_window_model:sliding_window_model.py:3270 Filtered out 4 post-horizon shipments (delivery > 2025-12-07)
_____________________ test_to_optimization_dict_structure ______________________
tests/test_inventory_unit_conversion.py:688: in test_to_optimization_dict_structure
    assert opt_dict[("6125", "176283")] == 320.0
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: ('6125', '176283')
____________ test_to_optimization_dict_aggregates_storage_locations ____________
tests/test_inventory_unit_conversion.py:706: in test_to_optimization_dict_aggregates_storage_locations
    assert len(opt_dict) == 1
E   AssertionError: assert 2 == 1
E    +  where 2 = len({('6122', '168846'): 50.0, ('Lineage', '168846'): 30.0})
_______________________ test_labor_capacity_enforcement ________________________
tests/test_labor_capacity_enforcement.py:104: in test_labor_capacity_enforcement
    print(f"   Status: {result.solver.termination_condition}")
                        ^^^^^^^^^^^^^
E   AttributeError: 'OptimizationResult' object has no attribute 'solver'
----------------------------- Captured stdout call -----------------------------

================================================================================
LABOR CAPACITY ENFORCEMENT TEST (12-WEEK HORIZON)
================================================================================

Building model (horizon: 2025-01-06 to 2025-03-30)...
   No intermediate stop nodes added

  First-day arrival validation:
      Route 6122  Lineage (1.0d transit): Goods arriving on 2025-01-06 departed 2025-01-05 (before horizon). Should be in initial inventory at Lineage.
      Route Lineage  6130 (7.0d transit): Goods arriving on 2025-01-06 departed 2024-12-30 (before horizon). Should be in initial inventory at 6130.
  Manufacturing nodes: 1
  Demand nodes: 9
  Routes FROM Lineage: 1
    - Lineage  6130 (mode=frozen, days=7.0)
  Routes TO Lineage: 1
    - 6122  Lineage (mode=ambient, days=1.0)

Sliding Window Model Initialized:
  Nodes: 11
  Routes: 10
  Products: 5
  Planning horizon: 84 days
  Demand entries: 0
  Pallet tracking: True

================================================================================
BUILDING SLIDING WINDOW MODEL [git:08a4ec6]
================================================================================

Sets defined:
  Nodes: 11
  Products: 5
  Dates: 84
  States: 3

Adding variables...
  Production variables: 420
  DEBUG: Creating thawed inventory var for 6130 (has_frozen_inbound=True)
  Inventory variables: 5040
  State transition variables: 0 thaw + 0 freeze
  In-transit variables: 6480 (indexed by DEPARTURE date)
    Skipped 1920 invalid route-day combinations (day-of-week enforcement)
  Pallet storage variables: 4620 integers
  Pallet entry variables: 4620 integers (for fixed costs)
  Demand consumed variables: 0  2 states = 0
  Shortage variables: 0
  Binary product indicators: 840
  Changeover aggregation variables: 168 (overhead optimization)
  Labor variables: 84 (used + paid + overtime)
  Mix count variables: 420 integers

Variables created
  Continuous: 11,940
  Integers: 4,620
  Binaries: 840
  TOTAL: 17,400
  (vs cohort model: ~500,000 total)

Adding constraints...

  Adding sliding window shelf life constraints...
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
  Shelf life window constraints: 8,820
    Ambient (17d): ~4,200
    Frozen (120d): ~420
    Thawed (14d): ~4,200

  Adding state balance constraints...
  DEBUG arrivals for 6104, HELGAS GFREE MIXED GRAIN 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE TRAD WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE MIXED GRAIN 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE TRAD WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG frozen_balance[Lineage, HELGAS GFREE MIXED GRAIN 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE TRAD WHITE 470G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE TRAD WHITE 470G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE WHOLEM 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHITE 470G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHITE 470G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHOLEM 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHOLEM 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-01-06]:
    prev_inv: 0
    thaw_inflow: 0
    arrivals: 0
    demand_consumption: 0   FIX: Now included!
    Expected: inventory = 0 + thaw + arrivals - demand
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-01-13]:
    prev_inv: inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-01-12]
    thaw_inflow: 0
    arrivals: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    demand_consumption: 0   FIX: Now included!
    Expected: inventory = inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-01-12] + thaw + arrivals - demand
  State balance constraints: 8,820

  Adding demand satisfaction...
  Demand balance constraints: 0
  Demand consumption limit constraints added: ambient and thawed (prevents over-consumption)

  Adding pallet constraints...
    Storage pallet ceiling constraints added
    Pallet entry detection constraints added

  Adding production constraints...
    Mix-based production constraints added
    Production time linking constraints added
    Production capacity limit constraints added
    Overtime detection constraints added
    Labor payment constraints added (4-hour minimum on weekends)

  Adding changeover detection...
    Product-binary bidirectional linking constraints added
    Changeover aggregation linking constraints added (overhead optimization)
    Changeover detection constraints added

  Adding truck constraints...
    Truck constraints skipped (no schedules or tracking disabled)

Constraints added

================================================================================
MODEL STRUCTURE DIAGNOSTIC
================================================================================

Production variables at 6122: 420
  Sample: ('6122', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6))
Ambient balance constraints at 6122: 420
In-transit variables FROM 6122: 1440
  Sample: ('6122', '6104', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6), 'frozen')

 demand_consumed DOES NOT EXIST!

Sliding window constraints at 6122: 420

Overall model:
  Total variables: 22,860
  Total constraints: 21,093
================================================================================


Building objective...
  Production cost: $1.30/unit
  Frozen pallet fixed cost: $14.2600/pallet (on entry)
  Frozen pallet daily cost: $0.9800/pallet/day
  Shortage penalty: $10.00/unit
  Labor cost: Weekday overtime ($660/h) + Weekend ($1320/h with 4h minimum), fixed hours FREE
  Transport cost: route costs included
  Changeover cost: $38.40 per start
  Changeover waste: 30 units per start  $1.30/unit = $39.00 per start
  DEBUG WASTE COST:
    cost_structure.waste_cost_multiplier = 10.0
    After 'or 0' = 10.0
    Type: <class 'float'>
    Condition (waste_multiplier > 0): True
    hasattr(model, 'inventory'): True
     ENTERED waste cost block
    Last date: 2025-03-30
    Inventory variables at last date: 60
    end_inventory expression created (Pyomo sum)
    In-transit variables departing on last date: 60
    end_in_transit expression created (Pyomo sum)
  Waste cost: $13.00/unit  (end_inventory + end_in_transit)
    Coefficient: $13.00/unit
    Expression type: <class 'pyomo.core.expr.numeric_expr.ProductExpression'>
    If end_inventory=32,751, waste would be $425763.00
     WASTE COST EXPRESSION CREATED - WILL BE IN OBJECTIVE
  Binary indicator penalty: $0.0010 per product_produced binary

Objective built
  Active components: production + labor + transport + holding + shortage + disposal + changeover (cost + waste) + waste
  Staleness: IMPLICIT via holding costs (inventory costs money)

Model built successfully
 Model built successfully

Solving 12-week model...
Building Pyomo model in solve()...

================================================================================
BUILDING SLIDING WINDOW MODEL [git:08a4ec6]
================================================================================

Sets defined:
  Nodes: 11
  Products: 5
  Dates: 84
  States: 3

Adding variables...
  Production variables: 420
  DEBUG: Creating thawed inventory var for 6130 (has_frozen_inbound=True)
  Inventory variables: 5040
  State transition variables: 0 thaw + 0 freeze
  In-transit variables: 6480 (indexed by DEPARTURE date)
    Skipped 1920 invalid route-day combinations (day-of-week enforcement)
  Pallet storage variables: 4620 integers
  Pallet entry variables: 4620 integers (for fixed costs)
  Demand consumed variables: 0  2 states = 0
  Shortage variables: 0
  Binary product indicators: 840
  Changeover aggregation variables: 168 (overhead optimization)
  Labor variables: 84 (used + paid + overtime)
  Mix count variables: 420 integers

Variables created
  Continuous: 11,940
  Integers: 4,620
  Binaries: 840
  TOTAL: 17,400
  (vs cohort model: ~500,000 total)

Adding constraints...

  Adding sliding window shelf life constraints...
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
  Shelf life window constraints: 8,820
    Ambient (17d): ~4,200
    Frozen (120d): ~420
    Thawed (14d): ~4,200

  Adding state balance constraints...
  DEBUG arrivals for 6104, HELGAS GFREE MIXED GRAIN 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE TRAD WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE MIXED GRAIN 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE TRAD WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG frozen_balance[Lineage, HELGAS GFREE MIXED GRAIN 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE TRAD WHITE 470G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE TRAD WHITE 470G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE WHOLEM 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHITE 470G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHITE 470G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHOLEM 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHOLEM 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-01-06]:
    prev_inv: 0
    thaw_inflow: 0
    arrivals: 0
    demand_consumption: 0   FIX: Now included!
    Expected: inventory = 0 + thaw + arrivals - demand
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-01-13]:
    prev_inv: inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-01-12]
    thaw_inflow: 0
    arrivals: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    demand_consumption: 0   FIX: Now included!
    Expected: inventory = inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-01-12] + thaw + arrivals - demand
  State balance constraints: 8,820

  Adding demand satisfaction...
  Demand balance constraints: 0
  Demand consumption limit constraints added: ambient and thawed (prevents over-consumption)

  Adding pallet constraints...
    Storage pallet ceiling constraints added
    Pallet entry detection constraints added

  Adding production constraints...
    Mix-based production constraints added
    Production time linking constraints added
    Production capacity limit constraints added
    Overtime detection constraints added
    Labor payment constraints added (4-hour minimum on weekends)

  Adding changeover detection...
    Product-binary bidirectional linking constraints added
    Changeover aggregation linking constraints added (overhead optimization)
    Changeover detection constraints added

  Adding truck constraints...
    Truck constraints skipped (no schedules or tracking disabled)

Constraints added

================================================================================
MODEL STRUCTURE DIAGNOSTIC
================================================================================

Production variables at 6122: 420
  Sample: ('6122', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6))
Ambient balance constraints at 6122: 420
In-transit variables FROM 6122: 1440
  Sample: ('6122', '6104', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6), 'frozen')

 demand_consumed DOES NOT EXIST!

Sliding window constraints at 6122: 420

Overall model:
  Total variables: 22,860
  Total constraints: 21,093
================================================================================


Building objective...
  Production cost: $1.30/unit
  Frozen pallet fixed cost: $14.2600/pallet (on entry)
  Frozen pallet daily cost: $0.9800/pallet/day
  Shortage penalty: $10.00/unit
  Labor cost: Weekday overtime ($660/h) + Weekend ($1320/h with 4h minimum), fixed hours FREE
  Transport cost: route costs included
  Changeover cost: $38.40 per start
  Changeover waste: 30 units per start  $1.30/unit = $39.00 per start
  DEBUG WASTE COST:
    cost_structure.waste_cost_multiplier = 10.0
    After 'or 0' = 10.0
    Type: <class 'float'>
    Condition (waste_multiplier > 0): True
    hasattr(model, 'inventory'): True
     ENTERED waste cost block
    Last date: 2025-03-30
    Inventory variables at last date: 60
    end_inventory expression created (Pyomo sum)
    In-transit variables departing on last date: 60
    end_in_transit expression created (Pyomo sum)
  Waste cost: $13.00/unit  (end_inventory + end_in_transit)
    Coefficient: $13.00/unit
    Expression type: <class 'pyomo.core.expr.numeric_expr.ProductExpression'>
    If end_inventory=32,751, waste would be $425763.00
     WASTE COST EXPRESSION CREATED - WILL BE IN OBJECTIVE
  Binary indicator penalty: $0.0010 per product_produced binary

Objective built
  Active components: production + labor + transport + holding + shortage + disposal + changeover (cost + waste) + waste
  Staleness: IMPLICIT via holding costs (inventory costs money)

Model built successfully
  Writing model to workflow_model_debug.lp...
  Model written successfully
 Solve completed
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
________________ test_labor_cost_baseline_fixed_day_no_overtime ________________
tests/test_labor_cost_baseline.py:169: in test_labor_cost_baseline_fixed_day_no_overtime
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
_______________ test_labor_cost_baseline_fixed_day_with_overtime _______________
tests/test_labor_cost_baseline.py:285: in test_labor_cost_baseline_fixed_day_with_overtime
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
____________________ test_labor_cost_baseline_non_fixed_day ____________________
tests/test_labor_cost_baseline.py:396: in test_labor_cost_baseline_non_fixed_day
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
_______________________ test_labor_cost_only_no_storage ________________________
tests/test_labor_cost_isolation.py:84: in test_labor_cost_only_no_storage
    result = model.solve(time_limit_seconds=120, mip_gap=0.01)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST A: LABOR COSTS ONLY (No Storage, No Shelf Life)
================================================================================
Purpose: Verify overtime preference works without competing cost factors


Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 0
  Planning horizon: 2025-10-07 to 2025-10-21 (15 days)
  Products: 5
  Demand entries: 600
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 15 dates, 10 routes
  Production dates for cohorts: 15 in horizon + 0 from initial inventory
  Cohort indices: 71,400 cohorts
  Shipment cohorts by origin node:
    6104: 770
    6122: 1610
    6125: 1295
    Lineage: 180
  Shipment cohort indices: 3,855
  Demand cohort indices: 9,200
  Changeover tracking: 15 production days, 75 product indicators (VARIABLE (binary decision))
  Start tracking: 75 start indicators (binary)
  Labor cost variables: 15 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (240 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (15 node-date pairs, 135 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 36 storage delay constraints
  Holding cost skipped (all storage rates are zero)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 9,200 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
_____________________ test_piecewise_fixed_day_no_overtime _____________________
tests/test_labor_cost_piecewise.py:155: in test_piecewise_fixed_day_no_overtime
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
__________________ test_piecewise_non_fixed_day_below_minimum __________________
tests/test_labor_cost_piecewise.py:315: in test_piecewise_non_fixed_day_below_minimum
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
_______________________ test_piecewise_overhead_included _______________________
tests/test_labor_cost_piecewise.py:387: in test_piecewise_overhead_included
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
____________________ test_public_holiday_overhead_included _____________________
tests/test_labor_overhead_holiday.py:156: in test_public_holiday_overhead_included
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
__________________ test_public_holiday_overhead_below_minimum __________________
tests/test_labor_overhead_holiday.py:255: in test_public_holiday_overhead_below_minimum
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
_____________________ test_multi_day_overhead_consistency ______________________
tests/test_labor_overhead_multi_day.py:237: in test_multi_day_overhead_consistency
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
_____________________ test_multi_day_overhead_with_storage _____________________
tests/test_labor_overhead_multi_day.py:372: in test_multi_day_overhead_with_storage
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
_____________________________ test_convert_routes ______________________________
tests/test_legacy_conversion.py:87: in test_convert_routes
    assert frozen_route.transit_days == 3.0, "Transit time should be preserved"
E   AssertionError: Transit time should be preserved
E   assert 7.0 == 3.0
E    +  where 7.0 = UnifiedRoute(id='R10', origin_node_id='Lineage', destination_node_id='6130', transit_days=7.0, transport_mode='frozen', cost_per_unit=0.0).transit_days
_____________ test_minimal_case_single_breadroom_single_day_demand _____________
tests/test_minimal_reproduction.py:140: in test_minimal_case_single_breadroom_single_day_demand
    result = model.solve(solver_name='cbc', time_limit_seconds=60, mip_gap=0.01, tee=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:533: in solve
    self.model = self.build_model()
                 ^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:898: in build_model
    ???
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:3983: in _add_objective
    ???
E   UnboundLocalError: cannot access local variable 'small_pallet_cohorts' where it is not associated with a value
----------------------------- Captured stdout call -----------------------------

Unified Model Data Summary:
  Nodes: 2
    Manufacturing: 1
    Demand: 1
    With truck constraints: 0
  Routes: 1
  Truck schedules: 0
  Planning horizon: 2025-01-01 to 2025-01-07 (7 days)
  Products: 1
  Demand entries: 1

================================================================================
MINIMAL REPRODUCTION TEST
================================================================================
Horizon: 2025-01-01 to 2025-01-07 (7 days)
Nodes: 2 (MFG, BR1)
Routes: 1 (MFG  BR1, 1-day transit)
Demand: 1,000 units on day 7 ONLY
Truck constraints: NONE

Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 2 nodes, 1 products, 7 dates, 1 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 336 cohorts
  Shipment cohorts by origin node:
    MFG: 21
  Shipment cohort indices: 21
  Demand cohort indices: 14
  Changeover tracking: 7 production days, 7 product indicators (VARIABLE (binary decision))
  Start tracking: 7 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (28 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 1 nodes: ['MFG']
    Added 6 storage delay constraints
______________________ test_minimal_with_multi_day_demand ______________________
tests/test_minimal_reproduction.py:239: in test_minimal_with_multi_day_demand
    ForecastEntry('BR1', 'PROD1', day_1 + timedelta(days=0), 500.0),  # Day 1
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: BaseModel.__init__() takes 1 positional argument but 5 were given
________________ TestMultiFileParser.test_parse_labor_calendar _________________
tests/test_multi_file_parser.py:87: in test_parse_labor_calendar
    assert len(labor_calendar.days) == 211  # May 26 - Dec 22, 2025 (extended by 7 days before forecast)
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AssertionError: assert 585 == 211
E    +  where 585 = len([LaborDay(date=datetime.date(2025, 5, 26), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 27), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 28), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 29), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 30), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 31), fixed_hours=0.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=4.0, is_fixed_day=False), ...])
E    +    where [LaborDay(date=datetime.date(2025, 5, 26), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 27), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 28), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 29), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 30), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 31), fixed_hours=0.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=4.0, is_fixed_day=False), ...] = LaborCalendar(name='Labor Calendar from Network_Config.xlsx', days=[LaborDay(date=datetime.date(2025, 5, 26), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 27), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 28), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 29), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 30), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2025, 5, 31), fixed_hours=0.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=4.0, is_fixed_day=False), LaborDay(date=datetime.date(2025, 6, 1), fix...2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=4.0, is_fixed_day=False), LaborDay(date=datetime.date(2026, 12, 26), fixed_hours=0.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=4.0, is_fixed_day=False), LaborDay(date=datetime.date(2026, 12, 27), fixed_hours=0.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=4.0, is_fixed_day=False), LaborDay(date=datetime.date(2026, 12, 28), fixed_hours=0.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=4.0, is_fixed_day=False), LaborDay(date=datetime.date(2026, 12, 29), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2026, 12, 30), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True), LaborDay(date=datetime.date(2026, 12, 31), fixed_hours=12.0, overtime_hours=2.0, regular_rate=0.0, overtime_rate=660.0, non_fixed_rate=1320.0, minimum_hours=0.0, is_fixed_day=True)]).days
________________ TestMultiFileParser.test_parse_cost_structure _________________
tests/test_multi_file_parser.py:116: in test_parse_cost_structure
    assert cost_structure.production_cost_per_unit == 5.0
E   assert 1.3 == 5.0
E    +  where 1.3 = CostStructure(production_cost_per_unit=1.3, setup_cost=0.0, default_regular_rate=20.0, default_overtime_rate=30.0, default_non_fixed_rate=40.0, transport_cost_frozen_per_unit=0.5, transport_cost_ambient_per_unit=0.3, truck_fixed_cost=100.0, storage_cost_frozen_per_unit_day=0.0, storage_cost_ambient_per_unit_day=0.0, storage_cost_fixed_per_pallet=0.0, storage_cost_per_pallet_day_frozen=0.9800000000000001, storage_cost_per_pallet_day_ambient=0.0, storage_cost_fixed_per_pallet_frozen=14.26, storage_cost_fixed_per_pallet_ambient=0.0, waste_cost_multiplier=10.0, shortage_penalty_per_unit=10.0, freshness_incentive_weight=0.13, changeover_cost_per_start=38.4, changeover_waste_units=30.0).production_cost_per_unit
_______________________ test_overtime_forced_by_capacity _______________________
tests/test_overtime_mechanism_validation.py:148: in test_overtime_forced_by_capacity
    result = model.solve(time_limit_seconds=60, mip_gap=0.01)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: OVERTIME MECHANISM - HIGH DEMAND FORCING SPREAD
================================================================================
Demand: 19,600 units = 14h production
With overhead: 15h total
Weekday capacity: 14h max (can't fit in 1 day)
Expected: Spread across 2 weekdays with overtime


Unified Model Data Summary:
  Nodes: 2
    Manufacturing: 1
    Demand: 1
    With truck constraints: 0
  Routes: 1
  Truck schedules: 0
  Planning horizon: 2025-01-06 to 2025-01-12 (7 days)
  Products: 1
  Demand entries: 1
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 2 nodes, 1 products, 7 dates, 1 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 336 cohorts
  Shipment cohorts by origin node:
    6122: 21
  Shipment cohort indices: 21
  Demand cohort indices: 6
  Changeover tracking: 7 production days, 7 product indicators (VARIABLE (binary decision))
  Start tracking: 7 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (28 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 1 nodes: ['6122']
    Added 6 storage delay constraints
  Holding cost skipped (all storage rates are zero)

  Waste cost disabled (waste_cost_multiplier = 1.5)
  Core constraints added
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
_______________________ test_overtime_forced_single_day ________________________
tests/test_overtime_mechanism_validation.py:343: in test_overtime_forced_single_day
    result = model.solve(time_limit_seconds=60, mip_gap=0.01)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: OVERTIME FORCED BY SAME-DAY DELIVERY
================================================================================
Demand: 18,200 units = 13h production on MONDAY
With overhead: 14h total
Transit: 0 days (same-day delivery required)
Expected: MUST produce Monday with 2h overtime


Unified Model Data Summary:
  Nodes: 2
    Manufacturing: 1
    Demand: 1
    With truck constraints: 0
  Routes: 1
  Truck schedules: 0
  Planning horizon: 2025-01-06 to 2025-01-12 (7 days)
  Products: 1
  Demand entries: 1
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 2 nodes, 1 products, 7 dates, 1 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 336 cohorts
  Shipment cohorts by origin node:
    6122: 28
  Shipment cohort indices: 28
  Demand cohort indices: 2
  Changeover tracking: 7 production days, 7 product indicators (VARIABLE (binary decision))
  Start tracking: 7 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (28 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 1 nodes: ['6122']
    Added 7 storage delay constraints
  Holding cost skipped (all storage rates are zero)

  Waste cost disabled (waste_cost_multiplier = 1.5)
  Core constraints added
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
_______________________ test_minimal_overtime_preference _______________________
tests/test_overtime_minimal.py:136: in test_minimal_overtime_preference
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
BUILDING MINIMAL TEST MODEL
================================================================================
____________________ test_overtime_preference_over_weekend _____________________
tests/test_overtime_preference.py:141: in test_overtime_preference_over_weekend
    result = model.solve(time_limit_seconds=60, mip_gap=0.01)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

Unified Model Data Summary:
  Nodes: 2
    Manufacturing: 1
    Demand: 1
    With truck constraints: 0
  Routes: 1
  Truck schedules: 0
  Planning horizon: 2025-01-06 to 2025-01-12 (7 days)
  Products: 1
  Demand entries: 1
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 2 nodes, 1 products, 7 dates, 1 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 336 cohorts
  Shipment cohorts by origin node:
    MFG: 21
  Shipment cohort indices: 21
  Demand cohort indices: 6
  Changeover tracking: 7 production days, 7 product indicators (VARIABLE (binary decision))
  Start tracking: 7 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (28 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 1 nodes: ['MFG']
    Added 6 storage delay constraints
  Holding cost skipped (all storage rates are zero)

  Waste cost disabled (waste_cost_multiplier = 1.5)
  Core constraints added
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
_______________________ test_weekend_only_when_necessary _______________________
tests/test_overtime_preference.py:350: in test_weekend_only_when_necessary
    result = model.solve(time_limit_seconds=60, mip_gap=0.01)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

Unified Model Data Summary:
  Nodes: 2
    Manufacturing: 1
    Demand: 1
    With truck constraints: 0
  Routes: 1
  Truck schedules: 0
  Planning horizon: 2025-01-06 to 2025-01-12 (7 days)
  Products: 1
  Demand entries: 1
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 2 nodes, 1 products, 7 dates, 1 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 336 cohorts
  Shipment cohorts by origin node:
    MFG: 21
  Shipment cohort indices: 21
  Demand cohort indices: 6
  Changeover tracking: 7 production days, 7 product indicators (VARIABLE (binary decision))
  Start tracking: 7 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (28 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 1 nodes: ['MFG']
    Added 6 storage delay constraints
  Holding cost skipped (all storage rates are zero)

  Waste cost disabled (waste_cost_multiplier = 1.5)
  Core constraints added
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
____________________ test_overtime_preference_oct16_4weeks _____________________
tests/test_overtime_preference_oct16.py:65: in test_overtime_preference_oct16_4weeks
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
OVERTIME PREFERENCE INVESTIGATION: Oct 16 4-Week Scenario
================================================================================

Scenario: 2025-10-16 to 2025-11-12 (28 days)
____________ TestHoldingCostCalculation.test_unit_based_costs_work _____________
tests/test_pallet_based_holding_costs.py:201: in test_unit_based_costs_work
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
______ TestHoldingCostCalculation.test_pallet_based_costs_take_precedence ______
tests/test_pallet_based_holding_costs.py:242: in test_pallet_based_costs_take_precedence
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
__ TestHoldingCostCalculation.test_zero_holding_costs_skips_pallet_variables ___
tests/test_pallet_based_holding_costs.py:273: in test_zero_holding_costs_skips_pallet_variables
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
______ TestHoldingCostCalculation.test_frozen_inventory_uses_frozen_rate _______
tests/test_pallet_based_holding_costs.py:324: in test_frozen_inventory_uses_frozen_rate
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
_____ TestHoldingCostCalculation.test_ambient_inventory_uses_ambient_rate ______
tests/test_pallet_based_holding_costs.py:355: in test_ambient_inventory_uses_ambient_rate
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
______ TestHoldingCostIntegration.test_holding_cost_in_objective_function ______
tests/test_pallet_based_holding_costs.py:393: in test_holding_cost_in_objective_function
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
_________ TestHoldingCostIntegration.test_ceiling_constraints_created __________
tests/test_pallet_based_holding_costs.py:429: in test_ceiling_constraints_created
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
__________ TestBackwardCompatibility.test_zero_costs_behave_as_before __________
tests/test_pallet_based_holding_costs.py:573: in test_zero_costs_behave_as_before
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
____ TestHoldingCostOptimization.test_solution_includes_holding_cost_fields ____
tests/test_pallet_based_holding_costs.py:653: in test_solution_includes_holding_cost_fields
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
_______ TestHoldingCostOptimization.test_holding_cost_in_cost_breakdown ________
tests/test_pallet_based_holding_costs.py:693: in test_holding_cost_in_cost_breakdown
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
_____ TestHoldingCostOptimization.test_holding_cost_proportion_reasonable ______
tests/test_pallet_based_holding_costs.py:729: in test_holding_cost_proportion_reasonable
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
____ TestHoldingCostOptimization.test_holding_cost_doesnt_break_feasibility ____
tests/test_pallet_based_holding_costs.py:773: in test_holding_cost_doesnt_break_feasibility
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
__________ TestRealWorldDataFiles.test_parse_real_network_config_file __________
tests/test_parameter_parsing.py:503: in test_parse_real_network_config_file
    nodes = parser.parse_nodes()
            ^^^^^^^^^^^^^^^^^^^^
src/parsers/unified_model_parser.py:44: in parse_nodes
    df = pd.read_excel(self.file_path, sheet_name='Nodes', engine='openpyxl')
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'Nodes' not found

During handling of the above exception, another exception occurred:
tests/test_parameter_parsing.py:522: in test_parse_real_network_config_file
    pytest.fail(f"Failed to parse Network_Config.xlsx: {e}")
E   Failed: Failed to parse Network_Config.xlsx: Worksheet named 'Nodes' not found
____________________ test_exact_user_scenario_oct16_4weeks _____________________
tests/test_production_run_oct16_4weeks.py:86: in test_exact_user_scenario_oct16_4weeks
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
REPRODUCTION TEST: User's Oct 16 4-Week Production Run
================================================================================

Scenario Setup:
  Start: 2025-10-23
  End: 2025-11-19
  Horizon: 28 days
  MIP Gap: 2%
  Allow shortages: True
  Batch tracking: True
_ TestLaborHoursDictExtraction.test_labor_hours_dict_format_with_proportional_allocation _
tests/test_result_adapter_labor_hours.py:103: in test_labor_hours_dict_format_with_proportional_allocation
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
_______ TestLaborHoursDictExtraction.test_labor_hours_dict_missing_date ________
tests/test_result_adapter_labor_hours.py:151: in test_labor_hours_dict_missing_date
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
_____ TestLaborHoursDictExtraction.test_labor_hours_dict_with_zero_values ______
tests/test_result_adapter_labor_hours.py:184: in test_labor_hours_dict_with_zero_values
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
____ TestLaborHoursDictExtraction.test_labor_hours_dict_missing_used_field _____
tests/test_result_adapter_labor_hours.py:215: in test_labor_hours_dict_missing_used_field
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
_ TestBackwardCompatibilityNumericLabor.test_labor_hours_numeric_format_still_works _
tests/test_result_adapter_labor_hours.py:253: in test_labor_hours_numeric_format_still_works
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
_ TestBackwardCompatibilityNumericLabor.test_labor_hours_mixed_format_graceful_handling _
tests/test_result_adapter_labor_hours.py:292: in test_labor_hours_mixed_format_graceful_handling
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
_ TestProductionScheduleDailyLaborHours.test_production_schedule_stores_dict_labor_hours _
tests/test_result_adapter_labor_hours.py:336: in test_production_schedule_stores_dict_labor_hours
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
_ TestProductionScheduleDailyLaborHours.test_production_schedule_total_labor_hours_calculation _
tests/test_result_adapter_labor_hours.py:377: in test_production_schedule_total_labor_hours_calculation
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
_ TestInitialInventoryWithLaborHours.test_initial_inventory_batches_zero_labor_hours _
tests/test_result_adapter_labor_hours.py:418: in test_initial_inventory_batches_zero_labor_hours
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
__________________ TestEdgeCases.test_empty_labor_hours_dict ___________________
tests/test_result_adapter_labor_hours.py:451: in test_empty_labor_hours_dict
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
______________ TestEdgeCases.test_missing_labor_hours_by_date_key ______________
tests/test_result_adapter_labor_hours.py:472: in test_missing_labor_hours_by_date_key
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
__________________ TestEdgeCases.test_none_labor_hours_value ___________________
tests/test_result_adapter_labor_hours.py:496: in test_none_labor_hours_value
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
_____ TestCostBreakdownLabor.test_cost_breakdown_handles_dict_labor_hours ______
tests/test_result_adapter_labor_hours.py:544: in test_cost_breakdown_handles_dict_labor_hours
    cost_breakdown = _create_cost_breakdown(model, solution)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:393: in _create_cost_breakdown
    return _create_cost_breakdown_legacy(model, solution)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:438: in _create_cost_breakdown_legacy
    total_labor_hours = sum(labor_hours_by_date.values())
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: unsupported operand type(s) for +: 'int' and 'dict'
________________ test_full_adapter_integration_with_dict_labor _________________
tests/test_result_adapter_labor_hours.py:616: in test_full_adapter_integration_with_dict_labor
    adapted = adapt_optimization_results(model, result, inventory_snapshot_date=None)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:65: in adapt_optimization_results
    raise ValidationError(
E   TypeError: ValidationError.__new__() missing 1 required positional argument: 'line_errors'
_____________ test_error_detection_dict_multiplication_regression ______________
tests/test_result_adapter_labor_hours.py:675: in test_error_detection_dict_multiplication_regression
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'
______________ test_error_detection_missing_used_field_regression ______________
tests/test_result_adapter_labor_hours.py:725: in test_error_detection_missing_used_field_regression
    schedule = _create_production_schedule(model, solution, inventory_snapshot_date=None)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
ui/utils/result_adapter.py:175: in _create_production_schedule
    logger.info(f"Converting {len(solution.production_batches)} Pydantic production batches to ProductionBatch objects")
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   AttributeError: 'dict' object has no attribute 'production_batches'

During handling of the above exception, another exception occurred:
tests/test_result_adapter_labor_hours.py:734: in test_error_detection_missing_used_field_regression
    pytest.fail(f"ERROR: Missing 'used' field caused exception: {e}")
E   Failed: ERROR: Missing 'used' field caused exception: 'dict' object has no attribute 'production_batches'
__________________ test_cost_extraction_doesnt_fail_silently ___________________
tests/test_result_quality_validation.py:61: in test_cost_extraction_doesnt_fail_silently
    assert len(silent_excepts) < 10, f"Too many silent except clauses at lines: {silent_excepts}"
E   AssertionError: Too many silent except clauses at lines: [1357, 1482, 1569, 3538, 1472, 2329, 3194, 3208, 3217, 3264, 3294, 3341, 3359, 3380, 3161, 3390, 3465, 3138]
E   assert 18 < 10
E    +  where 18 = len([1357, 1482, 1569, 3538, 1472, 2329, ...])
----------------------------- Captured stdout call -----------------------------
Silent except: pass clauses: 18
_______________ TestSapIbpConverter.test_convert_to_long_format ________________
tests/test_sap_ibp_converter.py:104: in test_convert_to_long_format
    assert len(df_forecast) <= 10000  # Allow for some variation
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   assert 17760 <= 10000
E    +  where 17760 = len(      location_id product_id        date    quantity\n0            6103     168846  2025-10-07   96.746606\n1            6103     168846  2025-10-08  106.903947\n2            6103     168846  2025-10-09  109.668602\n3            6103     168846  2025-10-10  112.150378\n4            6103     168846  2025-10-11  149.781545\n...           ...        ...         ...         ...\n17755        6130     179650  2026-12-27   56.727956\n17756        6130     179650  2026-12-28   70.511544\n17757        6130     179650  2026-12-29   70.511540\n17758        6130     179650  2026-12-30   70.511531\n17759        6130     179650  2026-12-31   70.511516\n\n[17760 rows x 4 columns])
____________________ TestSapIbpConverter.test_convert_full _____________________
tests/test_sap_ibp_converter.py:133: in test_convert_full
    assert unique_locations == 9
E   assert 8 == 9
__________________ TestSapIbpConverter.test_convert_locations __________________
tests/test_sap_ibp_converter.py:146: in test_convert_locations
    assert locations == expected_locations
E   AssertionError: assert {'6103', '610..., '6123', ...} == {'6103', '610..., '6123', ...}
E     
E     Extra items in the right set:
E     '6134'
E     
E     Full diff:
E       {
E           '6103',...
E     
E     ...Full output truncated (9 lines hidden), use '-vv' to show
_________________ TestSapIbpConverter.test_convert_date_range __________________
tests/test_sap_ibp_converter.py:169: in test_convert_date_range
    assert min_date == date(2025, 6, 2)
E   assert datetime.date(2025, 10, 7) == datetime.date(2025, 6, 2)
E    +  where datetime.date(2025, 6, 2) = date(2025, 6, 2)
________________ TestSapIbpDetection.test_detect_sap_ibp_format ________________
tests/test_sap_ibp_parser.py:25: in test_detect_sap_ibp_format
    assert sheet_name == "G610 RET"
E   AssertionError: assert 'G610_RET' == 'G610 RET'
E     
E     - G610 RET
E     ?     ^
E     + G610_RET
E     ?     ^
________________ TestSapIbpParsing.test_parse_sap_ibp_forecast _________________
tests/test_sap_ibp_parser.py:50: in test_parse_sap_ibp_forecast
    forecast = SapIbpParser.parse_sap_ibp_forecast(SAP_IBP_FILE, sheet_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/sap_ibp_parser.py:107: in parse_sap_ibp_forecast
    df = pd.read_excel(file_path, sheet_name=sheet_name, header=None, engine="openpyxl")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'G610 RET' not found
_________ TestSapIbpParsing.test_parse_sap_ibp_forecast_data_structure _________
tests/test_sap_ibp_parser.py:71: in test_parse_sap_ibp_forecast_data_structure
    forecast = SapIbpParser.parse_sap_ibp_forecast(SAP_IBP_FILE, sheet_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/sap_ibp_parser.py:107: in parse_sap_ibp_forecast
    df = pd.read_excel(file_path, sheet_name=sheet_name, header=None, engine="openpyxl")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'G610 RET' not found
___________ TestSapIbpParsing.test_parse_sap_ibp_forecast_date_range ___________
tests/test_sap_ibp_parser.py:89: in test_parse_sap_ibp_forecast_date_range
    forecast = SapIbpParser.parse_sap_ibp_forecast(SAP_IBP_FILE, sheet_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/sap_ibp_parser.py:107: in parse_sap_ibp_forecast
    df = pd.read_excel(file_path, sheet_name=sheet_name, header=None, engine="openpyxl")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'G610 RET' not found
___________ TestSapIbpParsing.test_parse_sap_ibp_forecast_locations ____________
tests/test_sap_ibp_parser.py:105: in test_parse_sap_ibp_forecast_locations
    forecast = SapIbpParser.parse_sap_ibp_forecast(SAP_IBP_FILE, sheet_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/sap_ibp_parser.py:107: in parse_sap_ibp_forecast
    df = pd.read_excel(file_path, sheet_name=sheet_name, header=None, engine="openpyxl")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'G610 RET' not found
____________ TestSapIbpParsing.test_parse_sap_ibp_forecast_products ____________
tests/test_sap_ibp_parser.py:121: in test_parse_sap_ibp_forecast_products
    forecast = SapIbpParser.parse_sap_ibp_forecast(SAP_IBP_FILE, sheet_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/sap_ibp_parser.py:107: in parse_sap_ibp_forecast
    df = pd.read_excel(file_path, sheet_name=sheet_name, header=None, engine="openpyxl")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'G610 RET' not found
_________ TestSapIbpParsing.test_parse_sap_ibp_forecast_sample_values __________
tests/test_sap_ibp_parser.py:137: in test_parse_sap_ibp_forecast_sample_values
    forecast = SapIbpParser.parse_sap_ibp_forecast(SAP_IBP_FILE, sheet_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/sap_ibp_parser.py:107: in parse_sap_ibp_forecast
    df = pd.read_excel(file_path, sheet_name=sheet_name, header=None, engine="openpyxl")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'G610 RET' not found
______________ TestSapIbpParsing.test_parse_sap_ibp_date_parsing _______________
tests/test_sap_ibp_parser.py:161: in test_parse_sap_ibp_date_parsing
    forecast = SapIbpParser.parse_sap_ibp_forecast(SAP_IBP_FILE, sheet_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/sap_ibp_parser.py:107: in parse_sap_ibp_forecast
    df = pd.read_excel(file_path, sheet_name=sheet_name, header=None, engine="openpyxl")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'G610 RET' not found
_________ TestSapIbpParserEdgeCases.test_parse_handles_nan_quantities __________
tests/test_sap_ibp_parser.py:213: in test_parse_handles_nan_quantities
    forecast = SapIbpParser.parse_sap_ibp_forecast(SAP_IBP_FILE, sheet_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/sap_ibp_parser.py:107: in parse_sap_ibp_forecast
    df = pd.read_excel(file_path, sheet_name=sheet_name, header=None, engine="openpyxl")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'G610 RET' not found
_________ TestSapIbpParserEdgeCases.test_parse_converts_ids_to_strings _________
tests/test_sap_ibp_parser.py:226: in test_parse_converts_ids_to_strings
    forecast = SapIbpParser.parse_sap_ibp_forecast(SAP_IBP_FILE, sheet_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/sap_ibp_parser.py:107: in parse_sap_ibp_forecast
    df = pd.read_excel(file_path, sheet_name=sheet_name, header=None, engine="openpyxl")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'G610 RET' not found
____ TestSapIbpParserEdgeCases.test_parse_forecast_entry_count_consistency _____
tests/test_sap_ibp_parser.py:238: in test_parse_forecast_entry_count_consistency
    forecast1 = SapIbpParser.parse_sap_ibp_forecast(SAP_IBP_FILE, sheet_name)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/sap_ibp_parser.py:107: in parse_sap_ibp_forecast
    df = pd.read_excel(file_path, sheet_name=sheet_name, header=None, engine="openpyxl")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'G610 RET' not found
__________ TestSapIbpParserEdgeCases.test_parse_no_duplicate_entries ___________
tests/test_sap_ibp_parser.py:248: in test_parse_no_duplicate_entries
    forecast = SapIbpParser.parse_sap_ibp_forecast(SAP_IBP_FILE, sheet_name)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/parsers/sap_ibp_parser.py:107: in parse_sap_ibp_forecast
    df = pd.read_excel(file_path, sheet_name=sheet_name, header=None, engine="openpyxl")
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:508: in read_excel
    data = io.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:1616: in parse
    return self._reader.parse(
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:773: in parse
    sheet = self.get_sheet_by_name(asheetname)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pandas/io/excel/_openpyxl.py:582: in get_sheet_by_name
    self.raise_if_bad_sheet_by_name(name)
venv/lib/python3.11/site-packages/pandas/io/excel/_base.py:624: in raise_if_bad_sheet_by_name
    raise ValueError(f"Worksheet named '{name}' not found")
E   ValueError: Worksheet named 'G610 RET' not found
______________________ test_zero_demand_skus_not_produced ______________________
tests/test_sku_reduction_incentive.py:108: in test_zero_demand_skus_not_produced
    result = model.solve(time_limit_seconds=60, mip_gap=0.01, tee=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:533: in solve
    self.model = self.build_model()
                 ^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:896: in build_model
    ???
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:3031: in _add_truck_constraints
    ???
venv/lib/python3.11/site-packages/pyomo/core/base/block.py:573: in __setattr__
    self.add_component(name, val)
venv/lib/python3.11/site-packages/pyomo/core/base/block.py:1103: in add_component
    val.construct(data)
venv/lib/python3.11/site-packages/pyomo/core/base/constraint.py:739: in construct
    self._setitem_when_not_present(index, rule(block, index))
                                          ^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pyomo/core/base/initializer.py:349: in __call__
    return self._fcn(parent, *idx, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:3009: in truck_route_linking_rule
    ???
E   AttributeError: 'UnifiedNodeModel' object has no attribute 'shipment_cohort_index_set'
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST 1: ZERO DEMAND SKUs NOT PRODUCED
================================================================================
Demand: 3 SKUs  3000 units = 9000 units total
Zero demand: 2 SKUs
Expected: Produce only 3 SKUs (not 5)

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 1
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-20 to 2025-10-20 (1 days)
  Products: 5
  Demand entries: 5
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 1 dates, 10 routes
  Inventory indices: 55 (node, product, date) tuples
   Truck pallet tracking enabled: 60 integer pallet variables
  Changeover tracking: 1 production days, 5 product indicators (VARIABLE (binary decision))
  Start tracking: 5 start indicators (binary)
  Labor cost variables: 1 labor hour variables added
  Variables created successfully
  Adding core constraints...
  Changeover tracking constraints added (16 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (1 node-date pairs, 9 constraints)
------------------------------ Captured log call -------------------------------
ERROR    pyomo.core:constraint.py:742 Rule failed when generating expression for Constraint truck_route_linking_con with index ('6122', '6125', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 10, 20)):
AttributeError: 'UnifiedNodeModel' object has no attribute 'shipment_cohort_index_set'
ERROR    pyomo.core:block.py:1106 Constructing component 'truck_route_linking_con' from data=None failed:
    AttributeError: 'UnifiedNodeModel' object has no attribute 'shipment_cohort_index_set'
_______________________ test_sku_reduction_cost_benefit ________________________
tests/test_sku_reduction_incentive.py:227: in test_sku_reduction_cost_benefit
    result = model.solve(time_limit_seconds=60, mip_gap=0.01, tee=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:533: in solve
    self.model = self.build_model()
                 ^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:896: in build_model
    ???
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:3031: in _add_truck_constraints
    ???
venv/lib/python3.11/site-packages/pyomo/core/base/block.py:573: in __setattr__
    self.add_component(name, val)
venv/lib/python3.11/site-packages/pyomo/core/base/block.py:1103: in add_component
    val.construct(data)
venv/lib/python3.11/site-packages/pyomo/core/base/constraint.py:739: in construct
    self._setitem_when_not_present(index, rule(block, index))
                                          ^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pyomo/core/base/initializer.py:349: in __call__
    return self._fcn(parent, *idx, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:3009: in truck_route_linking_rule
    ???
E   AttributeError: 'UnifiedNodeModel' object has no attribute 'shipment_cohort_index_set'
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST 2: SKU REDUCTION COST BENEFIT
================================================================================
Demand: 3 SKUs  3000 units = 9000 units total
Testing with changeover tracking enabled

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 1
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-20 to 2025-10-20 (1 days)
  Products: 3
  Demand entries: 3
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 3 products, 1 dates, 10 routes
  Inventory indices: 33 (node, product, date) tuples
   Truck pallet tracking enabled: 36 integer pallet variables
  Changeover tracking: 1 production days, 3 product indicators (VARIABLE (binary decision))
  Start tracking: 3 start indicators (binary)
  Labor cost variables: 1 labor hour variables added
  Variables created successfully
  Adding core constraints...
  Changeover tracking constraints added (10 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (1 node-date pairs, 9 constraints)
------------------------------ Captured log call -------------------------------
ERROR    pyomo.core:constraint.py:742 Rule failed when generating expression for Constraint truck_route_linking_con with index ('6122', '6125', 'HELGAS GFREE TRAD WHITE 470G', datetime.date(2025, 10, 20)):
AttributeError: 'UnifiedNodeModel' object has no attribute 'shipment_cohort_index_set'
ERROR    pyomo.core:block.py:1106 Constructing component 'truck_route_linking_con' from data=None failed:
    AttributeError: 'UnifiedNodeModel' object has no attribute 'shipment_cohort_index_set'
_____________________ test_overtime_triggers_sku_reduction _____________________
tests/test_sku_reduction_incentive.py:354: in test_overtime_triggers_sku_reduction
    result = model.solve(time_limit_seconds=60, mip_gap=0.01, tee=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:533: in solve
    self.model = self.build_model()
                 ^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:896: in build_model
    ???
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:3031: in _add_truck_constraints
    ???
venv/lib/python3.11/site-packages/pyomo/core/base/block.py:573: in __setattr__
    self.add_component(name, val)
venv/lib/python3.11/site-packages/pyomo/core/base/block.py:1103: in add_component
    val.construct(data)
venv/lib/python3.11/site-packages/pyomo/core/base/constraint.py:739: in construct
    self._setitem_when_not_present(index, rule(block, index))
                                          ^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pyomo/core/base/initializer.py:349: in __call__
    return self._fcn(parent, *idx, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:3009: in truck_route_linking_rule
    ???
E   AttributeError: 'UnifiedNodeModel' object has no attribute 'shipment_cohort_index_set'
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST 3: OVERTIME AVOIDANCE THROUGH SKU REDUCTION
================================================================================
Demand: 3 SKUs  2500 units = 7500 units
Scenario: High volume could trigger overtime with unnecessary SKUs
Expected: Produce only needed 3 SKUs to stay in regular hours

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 1
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-20 to 2025-10-20 (1 days)
  Products: 5
  Demand entries: 5
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 1 dates, 10 routes
  Inventory indices: 55 (node, product, date) tuples
   Truck pallet tracking enabled: 60 integer pallet variables
  Changeover tracking: 1 production days, 5 product indicators (VARIABLE (binary decision))
  Start tracking: 5 start indicators (binary)
  Labor cost variables: 1 labor hour variables added
  Variables created successfully
  Adding core constraints...
  Changeover tracking constraints added (16 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (1 node-date pairs, 9 constraints)
------------------------------ Captured log call -------------------------------
ERROR    pyomo.core:constraint.py:742 Rule failed when generating expression for Constraint truck_route_linking_con with index ('6122', '6125', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 10, 20)):
AttributeError: 'UnifiedNodeModel' object has no attribute 'shipment_cohort_index_set'
ERROR    pyomo.core:block.py:1106 Constructing component 'truck_route_linking_con' from data=None failed:
    AttributeError: 'UnifiedNodeModel' object has no attribute 'shipment_cohort_index_set'
_________________ test_model_produces_only_demanded_skus[cbc] __________________
tests/test_sku_reduction_simple.py:188: in test_model_produces_only_demanded_skus
    pytest.fail(f"Model did not solve: {result.termination_condition}")
E   Failed: Model did not solve: infeasible
----------------------------- Captured stdout call -----------------------------

================================================================================
SKU REDUCTION TEST: Model Produces Only Demanded SKUs (CBC)
================================================================================

Test Setup:
  Solver: CBC
  Planning horizon: 2025-10-20 to 2025-10-22 (3 days)
  Demand date: 2025-10-22
  Total products: 5
  Products with demand: 3
  Products with ZERO demand: 2
  Demand for HELGAS GFREE MIXED GRAIN 500G: 2000 units
  Demand for HELGAS GFREE TRAD WHITE 470G: 2000 units
  Demand for HELGAS GFREE WHOLEM 500G: 2000 units
  Demand for WONDER GFREE WHITE 470G: 0 units  Should skip
  Demand for WONDER GFREE WHOLEM 500G: 0 units  Should skip

Creating model...

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 1
    With truck constraints: 1
  Routes: 10
  Truck schedules: 0
  Planning horizon: 2025-10-20 to 2025-10-22 (3 days)
  Products: 5
  Demand entries: 5

Solving with CBC...
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 3 dates, 10 routes
  Production dates for cohorts: 3 in horizon + 0 from initial inventory
  Cohort indices: 1,050 cohorts
  Shipment cohorts by origin node:
    6104: 30
    6122: 50
    6125: 45
  Shipment cohort indices: 125
  Demand cohort indices: 30
  Changeover tracking: 3 production days, 15 product indicators (VARIABLE (binary decision))
  Start tracking: 15 start indicators (binary)
  Labor cost variables: 3 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (48 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (3 node-date pairs, 27 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 4 storage delay constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 30
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 30
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 1,050 total cohorts (350 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 30 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully

================================================================================
RESULTS
================================================================================
Solver: CBC
Status: infeasible
Solve time: 0.0s
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
________________ test_model_produces_only_demanded_skus[highs] _________________
tests/test_sku_reduction_simple.py:188: in test_model_produces_only_demanded_skus
    pytest.fail(f"Model did not solve: {result.termination_condition}")
E   Failed: Model did not solve: infeasible
----------------------------- Captured stdout call -----------------------------

================================================================================
SKU REDUCTION TEST: Model Produces Only Demanded SKUs (HIGHS)
================================================================================

Test Setup:
  Solver: HIGHS
  Planning horizon: 2025-10-20 to 2025-10-22 (3 days)
  Demand date: 2025-10-22
  Total products: 5
  Products with demand: 3
  Products with ZERO demand: 2
  Demand for HELGAS GFREE MIXED GRAIN 500G: 2000 units
  Demand for HELGAS GFREE TRAD WHITE 470G: 2000 units
  Demand for HELGAS GFREE WHOLEM 500G: 2000 units
  Demand for WONDER GFREE WHITE 470G: 0 units  Should skip
  Demand for WONDER GFREE WHOLEM 500G: 0 units  Should skip

Creating model...

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 1
    With truck constraints: 1
  Routes: 10
  Truck schedules: 0
  Planning horizon: 2025-10-20 to 2025-10-22 (3 days)
  Products: 5
  Demand entries: 5

Solving with HIGHS...
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 3 dates, 10 routes
  Production dates for cohorts: 3 in horizon + 0 from initial inventory
  Cohort indices: 1,050 cohorts
  Shipment cohorts by origin node:
    6104: 30
    6122: 50
    6125: 45
  Shipment cohort indices: 125
  Demand cohort indices: 30
  Changeover tracking: 3 production days, 15 product indicators (VARIABLE (binary decision))
  Start tracking: 15 start indicators (binary)
  Labor cost variables: 3 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (48 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (3 node-date pairs, 27 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 4 storage delay constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 30
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 30
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 1,050 total cohorts (350 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 30 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully

================================================================================
RESULTS
================================================================================
Solver: HIGHS
Status: infeasible
Solve time: 0.1s
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
________________________ test_4week_solution_integrity _________________________
tests/test_solution_integrity.py:166: in test_4week_solution_integrity
    model = SlidingWindowModel(
src/optimization/sliding_window_model.py:195: in __init__
    ???
src/optimization/sliding_window_model.py:339: in _preprocess_initial_inventory
    ???
E   ValueError: 
E   ================================================================================
E   PRODUCT ID MISMATCH ERROR
E   ================================================================================
E   Found 49 inventory entries with product IDs that don't match model products.
E   
E   This will cause:
E     - Initial inventory to be ignored
E     - Incorrect production planning
E     - Wrong shortage calculations
E   
E   Solution:
E     1. Use validation architecture: load_validated_data() automatically resolves product IDs
E     2. Or ensure inventory file uses same product IDs as forecast
E     3. Or add Alias sheet to Excel file for automatic mapping
E   
E   Inventory uses: ['179649', '179650', '179651', '184227', '168848']
E   Forecast uses: ['HELGAS GFREE MIXED GRAIN 500G', 'HELGAS GFREE TRAD WHITE 470G', 'HELGAS GFREE WHOLEM 500G', 'WONDER GFREE WHITE 470G', 'WONDER GFREE WHOLEM 500G']
E   ================================================================================
----------------------------- Captured stdout call -----------------------------

Preprocessing initial inventory:
  Input keys sample: [('6104', '168846'), ('6110', '168846'), ('6122', '168846')]
  Input entry count: 49
  Initial inventory: 49 entries
  Converted keys sample: [('6104', '168846', 'ambient'), ('6110', '168846', 'ambient'), ('6122', '168846', 'ambient')]
  Converted entry count: 49
  Total quantity: 49,581 units

Validating initial inventory against node capabilities:
  Found 49 product ID mismatches:
   (6104, 168846, ambient): Product not in model.products!
   (6110, 168846, ambient): Product not in model.products!
   (6122, 168846, ambient): Product not in model.products!
   (6123, 168846, ambient): Product not in model.products!
   (6125, 168846, ambient): Product not in model.products!
   (6104, 168847, ambient): Product not in model.products!
   (6110, 168847, ambient): Product not in model.products!
   (6122, 168847, ambient): Product not in model.products!
   (6123, 168847, ambient): Product not in model.products!
   (6125, 168847, ambient): Product not in model.products!
  Available products: ['HELGAS GFREE MIXED GRAIN 500G', 'HELGAS GFREE TRAD WHITE 470G', 'HELGAS GFREE WHOLEM 500G', 'WONDER GFREE WHITE 470G', 'WONDER GFREE WHOLEM 500G']...
___________________ test_initial_inventory_production_dates ____________________
tests/test_solution_integrity.py:215: in test_initial_inventory_production_dates
    from tests.test_integration_ui_workflow import load_test_data
E   ImportError: cannot import name 'load_test_data' from 'tests.test_integration_ui_workflow' (/home/sverzijl/planning_latest/tests/test_integration_ui_workflow.py)
______________________ test_weekend_labor_minimum_payment ______________________
tests/test_solution_integrity.py:315: in test_weekend_labor_minimum_payment
    model = SlidingWindowModel(
src/optimization/sliding_window_model.py:195: in __init__
    ???
src/optimization/sliding_window_model.py:339: in _preprocess_initial_inventory
    ???
E   ValueError: 
E   ================================================================================
E   PRODUCT ID MISMATCH ERROR
E   ================================================================================
E   Found 49 inventory entries with product IDs that don't match model products.
E   
E   This will cause:
E     - Initial inventory to be ignored
E     - Incorrect production planning
E     - Wrong shortage calculations
E   
E   Solution:
E     1. Use validation architecture: load_validated_data() automatically resolves product IDs
E     2. Or ensure inventory file uses same product IDs as forecast
E     3. Or add Alias sheet to Excel file for automatic mapping
E   
E   Inventory uses: ['179649', '179650', '179651', '184227', '168848']
E   Forecast uses: ['HELGAS GFREE MIXED GRAIN 500G', 'HELGAS GFREE TRAD WHITE 470G', 'HELGAS GFREE WHOLEM 500G', 'WONDER GFREE WHITE 470G', 'WONDER GFREE WHOLEM 500G']
E   ================================================================================
----------------------------- Captured stdout call -----------------------------

Preprocessing initial inventory:
  Input keys sample: [('6104', '168846'), ('6110', '168846'), ('6122', '168846')]
  Input entry count: 49
  Initial inventory: 49 entries
  Converted keys sample: [('6104', '168846', 'ambient'), ('6110', '168846', 'ambient'), ('6122', '168846', 'ambient')]
  Converted entry count: 49
  Total quantity: 49,581 units

Validating initial inventory against node capabilities:
  Found 49 product ID mismatches:
   (6104, 168846, ambient): Product not in model.products!
   (6110, 168846, ambient): Product not in model.products!
   (6122, 168846, ambient): Product not in model.products!
   (6123, 168846, ambient): Product not in model.products!
   (6125, 168846, ambient): Product not in model.products!
   (6104, 168847, ambient): Product not in model.products!
   (6110, 168847, ambient): Product not in model.products!
   (6122, 168847, ambient): Product not in model.products!
   (6123, 168847, ambient): Product not in model.products!
   (6125, 168847, ambient): Product not in model.products!
  Available products: ['HELGAS GFREE MIXED GRAIN 500G', 'HELGAS GFREE TRAD WHITE 470G', 'HELGAS GFREE WHOLEM 500G', 'WONDER GFREE WHITE 470G', 'WONDER GFREE WHOLEM 500G']...
________ TestSolutionReasonableness.test_1week_production_meets_demand _________
tests/test_solution_reasonableness.py:132: in test_1week_production_meets_demand
    assert lower_bound < actual_production < upper_bound, (
E   AssertionError: Production unrealistic for 1-week:
E       Total demand: 82,885 units
E       Initial inventory: 30,823 units
E       Expected production: 52,062 units
E       Actual production: 34,058 units
E       Acceptable range: [39,046, 62,474]
E   assert 39046.47754350002 < 34058.0
----------------------------- Captured stdout call -----------------------------

Preprocessing initial inventory:
  Input keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient')]
  Input entry count: 34
  Initial inventory: 34 entries
  Converted keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient')]
  Converted entry count: 34
  Total quantity: 30,823 units

Validating initial inventory against node capabilities:
   All 34 entries have compatible states and products
   No intermediate stop nodes added

  First-day arrival validation:
      Route 6122  Lineage (1.0d transit): Goods arriving on 2025-11-09 departed 2025-11-08 (before horizon). Should be in initial inventory at Lineage.
  Manufacturing nodes: 1
  Demand nodes: 9
  Routes FROM Lineage: 1
    - Lineage  6130 (mode=frozen, days=7.0)
  Routes TO Lineage: 1
    - 6122  Lineage (mode=ambient, days=1.0)

Sliding Window Model Initialized:
  Nodes: 11
  Routes: 10
  Products: 5
  Planning horizon: 7 days
  Demand entries: 315
  Pallet tracking: True
Building Pyomo model in solve()...

================================================================================
BUILDING SLIDING WINDOW MODEL [git:08a4ec6]
================================================================================

Sets defined:
  Nodes: 11
  Products: 5
  Dates: 7
  States: 3

Adding variables...
  Production variables: 35
  DEBUG: Creating thawed inventory var for 6130 (has_frozen_inbound=True)
  Inventory variables: 420
  Checking inventory variables for initial_inventory entries:
    ('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=2397
    ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=285
    ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=1280
    ('6123', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=609
    ('6125', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=3225
  State transition variables: 0 thaw + 0 freeze
  In-transit variables: 540 (indexed by DEPARTURE date)
    Skipped 160 invalid route-day combinations (day-of-week enforcement)
  Pallet storage variables: 385 integers
  Pallet entry variables: 385 integers (for fixed costs)
  Truck pallet variables: 385 integers
  Demand consumed variables: 315  2 states = 630
  Shortage variables: 315
  No disposal variables needed (no initial inventory expires within horizon)
  Binary product indicators: 70
  Changeover aggregation variables: 14 (overhead optimization)
  Labor variables: 7 (used + paid + overtime)
  Mix count variables: 35 integers

Variables created
  Continuous: 995
  Integers: 385
  Binaries: 70
  TOTAL: 1,450
  (vs cohort model: ~500,000 total)

Adding constraints...

  Adding sliding window shelf life constraints...
  DAY2 ambient_shelf_life[6122, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE MIXED GRAIN 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY2 ambient_shelf_life[6122, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE TRAD WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY2 ambient_shelf_life[6122, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1600.0 + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-09] + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1600
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',WONDER GFREE WHITE 470G,2025-11-09] + production['6122',WONDER GFREE WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 960.0 + production['6122',WONDER GFREE WHOLEM 500G,2025-11-09] + production['6122',WONDER GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 960
  DAY2 ambient_shelf_life[6104, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 676.0
    O: in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6104, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 2397.0
    O: in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6104, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 904.0
    O: in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 957.0
    O: in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 549.0
    O: in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 655.0
    O: in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 3225.0
    O: in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 3267.0
    O: in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 5416.0
    O: in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1474.0
    O: in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 595.0 + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 609.0 + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 704.0 + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 404.0 + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 327.0 + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1.0 + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 46.0 + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 259.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 285.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 291.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 280.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 153.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-10]
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
  Shelf life window constraints: 735
    Ambient (17d): ~350
    Frozen (120d): ~35
    Thawed (14d): ~350

  Adding state balance constraints...
  DEBUG arrivals for 6104, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG frozen_balance[Lineage, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE TRAD WHITE 470G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE TRAD WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHITE 470G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 0
    thaw_inflow: 0
    arrivals: 0
    demand_consumption: demand_consumed_from_thawed['6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09]   FIX: Now included!
    Expected: inventory = 0 + thaw + arrivals - demand
  State balance constraints: 735

  Adding demand satisfaction...
  Demand balance constraints: 315
  Demand consumption limit constraints added: ambient and thawed (prevents over-consumption)

  Adding pallet constraints...
    Storage pallet ceiling constraints added
    Pallet entry detection constraints added
    Truck pallet ceiling constraints added: 200

  Adding production constraints...
    Mix-based production constraints added
    Production time linking constraints added
    Production capacity limit constraints added
    Overtime detection constraints added
    Labor payment constraints added (4-hour minimum on weekends)

  Adding changeover detection...
    Product-binary bidirectional linking constraints added
    Changeover aggregation linking constraints added (overhead optimization)
    Changeover detection constraints added

  Adding truck constraints...
    Truck capacity constraints added: 77

Constraints added

================================================================================
MODEL STRUCTURE DIAGNOSTIC
================================================================================

Production variables at 6122: 35
  Sample: ('6122', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9))
Ambient balance constraints at 6122: 35
In-transit variables FROM 6122: 120
  Sample: ('6122', '6104', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 10), 'frozen')

 demand_consumed DOES NOT EXIST!

Sliding window constraints at 6122: 35

Overall model:
  Total variables: 3,235
  Total constraints: 2,935
================================================================================


Building objective...
  Production cost: $1.30/unit
  Frozen pallet fixed cost: $14.2600/pallet (on entry)
  Frozen pallet daily cost: $0.9800/pallet/day
  Shortage penalty: $10.00/unit
  Labor cost: Weekday overtime ($660/h) + Weekend ($1320/h with 4h minimum), fixed hours FREE
  Transport cost: route costs included
  Changeover cost: $38.40 per start
  Changeover waste: 30 units per start  $1.30/unit = $39.00 per start
  DEBUG WASTE COST:
    cost_structure.waste_cost_multiplier = 10.0
    After 'or 0' = 10.0
    Type: <class 'float'>
    Condition (waste_multiplier > 0): True
    hasattr(model, 'inventory'): True
     ENTERED waste cost block
    Last date: 2025-11-15
    Inventory variables at last date: 60
    end_inventory expression created (Pyomo sum)
    In-transit variables departing on last date: 60
    end_in_transit expression created (Pyomo sum)
  Waste cost: $13.00/unit  (end_inventory + end_in_transit)
    Coefficient: $13.00/unit
    Expression type: <class 'pyomo.core.expr.numeric_expr.ProductExpression'>
    If end_inventory=32,751, waste would be $425763.00
     WASTE COST EXPRESSION CREATED - WILL BE IN OBJECTIVE
  Binary indicator penalty: $0.0010 per product_produced binary

Objective built
  Active components: production + labor + transport + holding + shortage + disposal + changeover (cost + waste) + waste
  Staleness: IMPLICIT via holding costs (inventory costs money)

Model built successfully
  Writing model to workflow_model_debug.lp...
  Model written successfully

APPSI Solver Results:
  termination_condition: TerminationCondition.optimal
  best_feasible_objective: 231103.792716
  best_objective_bound: 230453.01755346032
  -> Solver reports OPTIMAL
  -> Solution loaded successfully

Mapping APPSI result to legacy format:
  APPSI termination: TerminationCondition.optimal
  -> Mapped to: optimal, success=True

DEBUG: Extracting holding cost from 385 pallet_count variables...
  Frozen cost/pallet/day: $0.98
  Ambient cost/pallet/day: $0.00
  Pallet-days: frozen=0, ambient=20464
  Holding cost extracted: frozen=$0.00, ambient=$0.00, total=$0.00

DEBUG: Extracting holding cost from 385 pallet_count variables...
  Frozen cost/pallet/day: $0.98
  Ambient cost/pallet/day: $0.00
  Pallet-days: frozen=0, ambient=20464
  Holding cost extracted: frozen=$0.00, ambient=$0.00, total=$0.00
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
WARNING  src.optimization.sliding_window_model:sliding_window_model.py:3270 Filtered out 3 post-horizon shipments (delivery > 2025-11-15)
WARNING  src.optimization.sliding_window_model:sliding_window_model.py:3270 Filtered out 3 post-horizon shipments (delivery > 2025-11-15)
________ TestSolutionReasonableness.test_4week_production_meets_demand _________
tests/test_solution_reasonableness.py:184: in test_4week_production_meets_demand
    producing_days = len([batch for batch in solution.production_batches if batch['quantity'] > 0])
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_solution_reasonableness.py:184: in <listcomp>
    producing_days = len([batch for batch in solution.production_batches if batch['quantity'] > 0])
                                                                            ^^^^^^^^^^^^^^^^^
E   TypeError: 'ProductionBatchResult' object is not subscriptable
----------------------------- Captured stdout call -----------------------------

Preprocessing initial inventory:
  Input keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient')]
  Input entry count: 34
  Initial inventory: 34 entries
  Converted keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient')]
  Converted entry count: 34
  Total quantity: 30,823 units

Validating initial inventory against node capabilities:
   All 34 entries have compatible states and products
   No intermediate stop nodes added

  First-day arrival validation:
      Route 6122  Lineage (1.0d transit): Goods arriving on 2025-11-09 departed 2025-11-08 (before horizon). Should be in initial inventory at Lineage.
  Manufacturing nodes: 1
  Demand nodes: 9
  Routes FROM Lineage: 1
    - Lineage  6130 (mode=frozen, days=7.0)
  Routes TO Lineage: 1
    - 6122  Lineage (mode=ambient, days=1.0)

Sliding Window Model Initialized:
  Nodes: 11
  Routes: 10
  Products: 5
  Planning horizon: 28 days
  Demand entries: 1260
  Pallet tracking: True
Building Pyomo model in solve()...

================================================================================
BUILDING SLIDING WINDOW MODEL [git:08a4ec6]
================================================================================

Sets defined:
  Nodes: 11
  Products: 5
  Dates: 28
  States: 3

Adding variables...
  Production variables: 140
  DEBUG: Creating thawed inventory var for 6130 (has_frozen_inbound=True)
  Inventory variables: 1680
  Checking inventory variables for initial_inventory entries:
    ('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=2397
    ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=285
    ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=1280
    ('6123', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=609
    ('6125', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=3225
  State transition variables: 0 thaw + 0 freeze
  In-transit variables: 2160 (indexed by DEPARTURE date)
    Skipped 640 invalid route-day combinations (day-of-week enforcement)
  Pallet storage variables: 1540 integers
  Pallet entry variables: 1540 integers (for fixed costs)
  Truck pallet variables: 1540 integers
  Demand consumed variables: 1260  2 states = 2520
  Shortage variables: 1260
  Disposal variables: 374 (only for expired inventory)
  Disposal for 34 inventory items
  Binary product indicators: 280
  Changeover aggregation variables: 56 (overhead optimization)
  Labor variables: 28 (used + paid + overtime)
  Mix count variables: 140 integers

Variables created
  Continuous: 3,980
  Integers: 1,540
  Binaries: 280
  TOTAL: 5,800
  (vs cohort model: ~500,000 total)

Adding constraints...

  Adding sliding window shelf life constraints...
  DAY2 ambient_shelf_life[6122, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE MIXED GRAIN 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY 18 ambient_shelf_life[6122, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE TRAD WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY 18 ambient_shelf_life[6122, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1600.0 + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-09] + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1600
  DAY 18 ambient_shelf_life[6122, HELGAS GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',WONDER GFREE WHITE 470G,2025-11-09] + production['6122',WONDER GFREE WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY 18 ambient_shelf_life[6122, WONDER GFREE WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 960.0 + production['6122',WONDER GFREE WHOLEM 500G,2025-11-09] + production['6122',WONDER GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 960
  DAY2 ambient_shelf_life[6104, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 676.0
    O: in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6104, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 2397.0
    O: in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6104, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6104, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 904.0
    O: in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 957.0
    O: in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 549.0
    O: in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 655.0
    O: in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 3225.0
    O: in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 3267.0
    O: in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, HELGAS GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 5416.0
    O: in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, WONDER GFREE WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1474.0
    O: in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, WONDER GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6123, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 595.0 + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 609.0 + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 704.0 + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 404.0 + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 327.0 + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1.0 + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 46.0 + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 259.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 285.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 291.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 280.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 153.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-10]
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
  Shelf life window constraints: 2,940
    Ambient (17d): ~1,400
    Frozen (120d): ~140
    Thawed (14d): ~1,400

  Adding state balance constraints...
  DEBUG arrivals for 6104, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG frozen_balance[Lineage, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE TRAD WHITE 470G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE TRAD WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHITE 470G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 0
    thaw_inflow: 0
    arrivals: 0
    demand_consumption: demand_consumed_from_thawed['6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09]   FIX: Now included!
    Expected: inventory = 0 + thaw + arrivals - demand
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-11-16]:
    prev_inv: inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-11-15]
    thaw_inflow: 0
    arrivals: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    demand_consumption: demand_consumed_from_thawed['6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-16]   FIX: Now included!
    Expected: inventory = inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-11-15] + thaw + arrivals - demand
  State balance constraints: 2,940

  Adding demand satisfaction...
  Demand balance constraints: 1260
  Demand consumption limit constraints added: ambient and thawed (prevents over-consumption)

  Adding pallet constraints...
    Storage pallet ceiling constraints added
    Pallet entry detection constraints added
    Truck pallet ceiling constraints added: 845

  Adding production constraints...
    Mix-based production constraints added
    Production time linking constraints added
    Production capacity limit constraints added
    Overtime detection constraints added
    Labor payment constraints added (4-hour minimum on weekends)

  Adding changeover detection...
    Product-binary bidirectional linking constraints added
    Changeover aggregation linking constraints added (overhead optimization)
    Changeover detection constraints added

  Adding truck constraints...
    Truck capacity constraints added: 308

Constraints added

================================================================================
MODEL STRUCTURE DIAGNOSTIC
================================================================================

Production variables at 6122: 140
  Sample: ('6122', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9))
Ambient balance constraints at 6122: 140
In-transit variables FROM 6122: 480
  Sample: ('6122', '6104', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 10), 'frozen')

 demand_consumed DOES NOT EXIST!

Sliding window constraints at 6122: 140

Overall model:
  Total variables: 13,314
  Total constraints: 11,788
================================================================================


Building objective...
  Production cost: $1.30/unit
  Frozen pallet fixed cost: $14.2600/pallet (on entry)
  Frozen pallet daily cost: $0.9800/pallet/day
  Shortage penalty: $10.00/unit
  Disposal penalty: $15.00/unit (> shortage $10.00/unit)
  Labor cost: Weekday overtime ($660/h) + Weekend ($1320/h with 4h minimum), fixed hours FREE
  Transport cost: route costs included
  Changeover cost: $38.40 per start
  Changeover waste: 30 units per start  $1.30/unit = $39.00 per start
  DEBUG WASTE COST:
    cost_structure.waste_cost_multiplier = 10.0
    After 'or 0' = 10.0
    Type: <class 'float'>
    Condition (waste_multiplier > 0): True
    hasattr(model, 'inventory'): True
     ENTERED waste cost block
    Last date: 2025-12-06
    Inventory variables at last date: 60
    end_inventory expression created (Pyomo sum)
    In-transit variables departing on last date: 60
    end_in_transit expression created (Pyomo sum)
  Waste cost: $13.00/unit  (end_inventory + end_in_transit)
    Coefficient: $13.00/unit
    Expression type: <class 'pyomo.core.expr.numeric_expr.ProductExpression'>
    If end_inventory=32,751, waste would be $425763.00
     WASTE COST EXPRESSION CREATED - WILL BE IN OBJECTIVE
  Binary indicator penalty: $0.0010 per product_produced binary

Objective built
  Active components: production + labor + transport + holding + shortage + disposal + changeover (cost + waste) + waste
  Staleness: IMPLICIT via holding costs (inventory costs money)

Model built successfully
  Writing model to workflow_model_debug.lp...
  Model written successfully

APPSI Solver Results:
  termination_condition: TerminationCondition.optimal
  best_feasible_objective: 620125.3456792798
  best_objective_bound: 613937.0353389787
  -> Solver reports OPTIMAL
  -> Solution loaded successfully

Mapping APPSI result to legacy format:
  APPSI termination: TerminationCondition.optimal
  -> Mapped to: optimal, success=True

DEBUG: Extracting holding cost from 1540 pallet_count variables...
  Frozen cost/pallet/day: $0.98
  Ambient cost/pallet/day: $0.00
  Pallet-days: frozen=69, ambient=85564
  Holding cost extracted: frozen=$67.62, ambient=$0.00, total=$67.62

DEBUG: Extracting holding cost from 1540 pallet_count variables...
  Frozen cost/pallet/day: $0.98
  Ambient cost/pallet/day: $0.00
  Pallet-days: frozen=69, ambient=85564
  Holding cost extracted: frozen=$67.62, ambient=$0.00, total=$67.62
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
WARNING  src.optimization.sliding_window_model:sliding_window_model.py:3270 Filtered out 7 post-horizon shipments (delivery > 2025-12-06)
WARNING  src.optimization.sliding_window_model:sliding_window_model.py:3270 Filtered out 7 post-horizon shipments (delivery > 2025-12-06)
_______ TestSolutionReasonableness.test_4week_cost_components_reasonable _______
venv/lib/python3.11/site-packages/pydantic/main.py:983: in __getattr__
    return pydantic_extra[item]
           ^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'total_production_cost'

The above exception was the direct cause of the following exception:
tests/test_solution_reasonableness.py:321: in test_4week_cost_components_reasonable
    production_cost = solution.total_production_cost
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.11/site-packages/pydantic/main.py:985: in __getattr__
    raise AttributeError(f'{type(self).__name__!r} object has no attribute {item!r}') from exc
E   AttributeError: 'OptimizationSolution' object has no attribute 'total_production_cost'
----------------------------- Captured stdout call -----------------------------

Preprocessing initial inventory:
  Input keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient')]
  Input entry count: 34
  Initial inventory: 34 entries
  Converted keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient')]
  Converted entry count: 34
  Total quantity: 30,823 units

Validating initial inventory against node capabilities:
   All 34 entries have compatible states and products
   No intermediate stop nodes added

  First-day arrival validation:
      Route 6122  Lineage (1.0d transit): Goods arriving on 2025-11-09 departed 2025-11-08 (before horizon). Should be in initial inventory at Lineage.
  Manufacturing nodes: 1
  Demand nodes: 9
  Routes FROM Lineage: 1
    - Lineage  6130 (mode=frozen, days=7.0)
  Routes TO Lineage: 1
    - 6122  Lineage (mode=ambient, days=1.0)

Sliding Window Model Initialized:
  Nodes: 11
  Routes: 10
  Products: 5
  Planning horizon: 28 days
  Demand entries: 1260
  Pallet tracking: True
Building Pyomo model in solve()...

================================================================================
BUILDING SLIDING WINDOW MODEL [git:08a4ec6]
================================================================================

Sets defined:
  Nodes: 11
  Products: 5
  Dates: 28
  States: 3

Adding variables...
  Production variables: 140
  DEBUG: Creating thawed inventory var for 6130 (has_frozen_inbound=True)
  Inventory variables: 1680
  Checking inventory variables for initial_inventory entries:
    ('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=2397
    ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=285
    ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=1280
    ('6123', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=609
    ('6125', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=3225
  State transition variables: 0 thaw + 0 freeze
  In-transit variables: 2160 (indexed by DEPARTURE date)
    Skipped 640 invalid route-day combinations (day-of-week enforcement)
  Pallet storage variables: 1540 integers
  Pallet entry variables: 1540 integers (for fixed costs)
  Truck pallet variables: 1540 integers
  Demand consumed variables: 1260  2 states = 2520
  Shortage variables: 1260
  Disposal variables: 374 (only for expired inventory)
  Disposal for 34 inventory items
  Binary product indicators: 280
  Changeover aggregation variables: 56 (overhead optimization)
  Labor variables: 28 (used + paid + overtime)
  Mix count variables: 140 integers

Variables created
  Continuous: 3,980
  Integers: 1,540
  Binaries: 280
  TOTAL: 5,800
  (vs cohort model: ~500,000 total)

Adding constraints...

  Adding sliding window shelf life constraints...
  DAY2 ambient_shelf_life[6122, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE MIXED GRAIN 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY 18 ambient_shelf_life[6122, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE TRAD WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY 18 ambient_shelf_life[6122, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1600.0 + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-09] + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1600
  DAY 18 ambient_shelf_life[6122, HELGAS GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',WONDER GFREE WHITE 470G,2025-11-09] + production['6122',WONDER GFREE WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY 18 ambient_shelf_life[6122, WONDER GFREE WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 960.0 + production['6122',WONDER GFREE WHOLEM 500G,2025-11-09] + production['6122',WONDER GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 960
  DAY2 ambient_shelf_life[6104, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 676.0
    O: in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6104, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 2397.0
    O: in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6104, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6104, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 904.0
    O: in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 957.0
    O: in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 549.0
    O: in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 655.0
    O: in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 3225.0
    O: in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 3267.0
    O: in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, HELGAS GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 5416.0
    O: in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, WONDER GFREE WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1474.0
    O: in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, WONDER GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6123, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 595.0 + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 609.0 + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 704.0 + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 404.0 + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 327.0 + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1.0 + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 46.0 + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 259.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 285.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 291.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 280.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 153.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-10]
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
  Shelf life window constraints: 2,940
    Ambient (17d): ~1,400
    Frozen (120d): ~140
    Thawed (14d): ~1,400

  Adding state balance constraints...
  DEBUG arrivals for 6104, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG frozen_balance[Lineage, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE TRAD WHITE 470G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE TRAD WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHITE 470G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 0
    thaw_inflow: 0
    arrivals: 0
    demand_consumption: demand_consumed_from_thawed['6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09]   FIX: Now included!
    Expected: inventory = 0 + thaw + arrivals - demand
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-11-16]:
    prev_inv: inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-11-15]
    thaw_inflow: 0
    arrivals: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    demand_consumption: demand_consumed_from_thawed['6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-16]   FIX: Now included!
    Expected: inventory = inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-11-15] + thaw + arrivals - demand
  State balance constraints: 2,940

  Adding demand satisfaction...
  Demand balance constraints: 1260
  Demand consumption limit constraints added: ambient and thawed (prevents over-consumption)

  Adding pallet constraints...
    Storage pallet ceiling constraints added
    Pallet entry detection constraints added
    Truck pallet ceiling constraints added: 845

  Adding production constraints...
    Mix-based production constraints added
    Production time linking constraints added
    Production capacity limit constraints added
    Overtime detection constraints added
    Labor payment constraints added (4-hour minimum on weekends)

  Adding changeover detection...
    Product-binary bidirectional linking constraints added
    Changeover aggregation linking constraints added (overhead optimization)
    Changeover detection constraints added

  Adding truck constraints...
    Truck capacity constraints added: 308

Constraints added

================================================================================
MODEL STRUCTURE DIAGNOSTIC
================================================================================

Production variables at 6122: 140
  Sample: ('6122', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9))
Ambient balance constraints at 6122: 140
In-transit variables FROM 6122: 480
  Sample: ('6122', '6104', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 10), 'frozen')

 demand_consumed DOES NOT EXIST!

Sliding window constraints at 6122: 140

Overall model:
  Total variables: 13,314
  Total constraints: 11,788
================================================================================


Building objective...
  Production cost: $1.30/unit
  Frozen pallet fixed cost: $14.2600/pallet (on entry)
  Frozen pallet daily cost: $0.9800/pallet/day
  Shortage penalty: $10.00/unit
  Disposal penalty: $15.00/unit (> shortage $10.00/unit)
  Labor cost: Weekday overtime ($660/h) + Weekend ($1320/h with 4h minimum), fixed hours FREE
  Transport cost: route costs included
  Changeover cost: $38.40 per start
  Changeover waste: 30 units per start  $1.30/unit = $39.00 per start
  DEBUG WASTE COST:
    cost_structure.waste_cost_multiplier = 10.0
    After 'or 0' = 10.0
    Type: <class 'float'>
    Condition (waste_multiplier > 0): True
    hasattr(model, 'inventory'): True
     ENTERED waste cost block
    Last date: 2025-12-06
    Inventory variables at last date: 60
    end_inventory expression created (Pyomo sum)
    In-transit variables departing on last date: 60
    end_in_transit expression created (Pyomo sum)
  Waste cost: $13.00/unit  (end_inventory + end_in_transit)
    Coefficient: $13.00/unit
    Expression type: <class 'pyomo.core.expr.numeric_expr.ProductExpression'>
    If end_inventory=32,751, waste would be $425763.00
     WASTE COST EXPRESSION CREATED - WILL BE IN OBJECTIVE
  Binary indicator penalty: $0.0010 per product_produced binary

Objective built
  Active components: production + labor + transport + holding + shortage + disposal + changeover (cost + waste) + waste
  Staleness: IMPLICIT via holding costs (inventory costs money)

Model built successfully
  Writing model to workflow_model_debug.lp...
  Model written successfully

APPSI Solver Results:
  termination_condition: TerminationCondition.optimal
  best_feasible_objective: 620125.3456792798
  best_objective_bound: 613937.0353389787
  -> Solver reports OPTIMAL
  -> Solution loaded successfully

Mapping APPSI result to legacy format:
  APPSI termination: TerminationCondition.optimal
  -> Mapped to: optimal, success=True

DEBUG: Extracting holding cost from 1540 pallet_count variables...
  Frozen cost/pallet/day: $0.98
  Ambient cost/pallet/day: $0.00
  Pallet-days: frozen=69, ambient=85564
  Holding cost extracted: frozen=$67.62, ambient=$0.00, total=$67.62

DEBUG: Extracting holding cost from 1540 pallet_count variables...
  Frozen cost/pallet/day: $0.98
  Ambient cost/pallet/day: $0.00
  Pallet-days: frozen=69, ambient=85564
  Holding cost extracted: frozen=$67.62, ambient=$0.00, total=$67.62
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
WARNING  src.optimization.sliding_window_model:sliding_window_model.py:3270 Filtered out 7 post-horizon shipments (delivery > 2025-12-06)
WARNING  src.optimization.sliding_window_model:sliding_window_model.py:3270 Filtered out 7 post-horizon shipments (delivery > 2025-12-06)
____________ TestHorizonScaling.test_production_scales_with_demand _____________
tests/test_solution_reasonableness.py:538: in test_production_scales_with_demand
    assert 0.5 * demand_ratio < production_ratio < 1.5 * demand_ratio, (
E   AssertionError: Production doesn't scale with demand:
E       1-week demand: 82,885, production: 34,058
E       4-week demand: 337,467, production: 283,960
E       Demand ratio: 4.07
E       Production ratio: 8.34
E     
E         This suggests formulation changes behavior across horizons
E   assert 8.337541840389923 < (1.5 * 4.071511188938742)
----------------------------- Captured stdout call -----------------------------

Preprocessing initial inventory:
  Input keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient')]
  Input entry count: 34
  Initial inventory: 34 entries
  Converted keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient')]
  Converted entry count: 34
  Total quantity: 30,823 units

Validating initial inventory against node capabilities:
   All 34 entries have compatible states and products
   No intermediate stop nodes added

  First-day arrival validation:
      Route 6122  Lineage (1.0d transit): Goods arriving on 2025-11-09 departed 2025-11-08 (before horizon). Should be in initial inventory at Lineage.
  Manufacturing nodes: 1
  Demand nodes: 9
  Routes FROM Lineage: 1
    - Lineage  6130 (mode=frozen, days=7.0)
  Routes TO Lineage: 1
    - 6122  Lineage (mode=ambient, days=1.0)

Sliding Window Model Initialized:
  Nodes: 11
  Routes: 10
  Products: 5
  Planning horizon: 7 days
  Demand entries: 315
  Pallet tracking: True
Building Pyomo model in solve()...

================================================================================
BUILDING SLIDING WINDOW MODEL [git:08a4ec6]
================================================================================

Sets defined:
  Nodes: 11
  Products: 5
  Dates: 7
  States: 3

Adding variables...
  Production variables: 35
  DEBUG: Creating thawed inventory var for 6130 (has_frozen_inbound=True)
  Inventory variables: 420
  Checking inventory variables for initial_inventory entries:
    ('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=2397
    ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=285
    ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=1280
    ('6123', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=609
    ('6125', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=3225
  State transition variables: 0 thaw + 0 freeze
  In-transit variables: 540 (indexed by DEPARTURE date)
    Skipped 160 invalid route-day combinations (day-of-week enforcement)
  Pallet storage variables: 385 integers
  Pallet entry variables: 385 integers (for fixed costs)
  Truck pallet variables: 385 integers
  Demand consumed variables: 315  2 states = 630
  Shortage variables: 315
  No disposal variables needed (no initial inventory expires within horizon)
  Binary product indicators: 70
  Changeover aggregation variables: 14 (overhead optimization)
  Labor variables: 7 (used + paid + overtime)
  Mix count variables: 35 integers

Variables created
  Continuous: 995
  Integers: 385
  Binaries: 70
  TOTAL: 1,450
  (vs cohort model: ~500,000 total)

Adding constraints...

  Adding sliding window shelf life constraints...
  DAY2 ambient_shelf_life[6122, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE MIXED GRAIN 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY2 ambient_shelf_life[6122, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE TRAD WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY2 ambient_shelf_life[6122, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1600.0 + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-09] + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1600
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',WONDER GFREE WHITE 470G,2025-11-09] + production['6122',WONDER GFREE WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 960.0 + production['6122',WONDER GFREE WHOLEM 500G,2025-11-09] + production['6122',WONDER GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 960
  DAY2 ambient_shelf_life[6104, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 676.0
    O: in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6104, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 2397.0
    O: in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6104, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 904.0
    O: in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 957.0
    O: in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 549.0
    O: in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 655.0
    O: in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 3225.0
    O: in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 3267.0
    O: in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 5416.0
    O: in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1474.0
    O: in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 595.0 + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 609.0 + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 704.0 + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 404.0 + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 327.0 + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1.0 + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 46.0 + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 259.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 285.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 291.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 280.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 153.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-10]
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
  Shelf life window constraints: 735
    Ambient (17d): ~350
    Frozen (120d): ~35
    Thawed (14d): ~350

  Adding state balance constraints...
  DEBUG arrivals for 6104, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG frozen_balance[Lineage, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE TRAD WHITE 470G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE TRAD WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHITE 470G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 0
    thaw_inflow: 0
    arrivals: 0
    demand_consumption: demand_consumed_from_thawed['6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09]   FIX: Now included!
    Expected: inventory = 0 + thaw + arrivals - demand
  State balance constraints: 735

  Adding demand satisfaction...
  Demand balance constraints: 315
  Demand consumption limit constraints added: ambient and thawed (prevents over-consumption)

  Adding pallet constraints...
    Storage pallet ceiling constraints added
    Pallet entry detection constraints added
    Truck pallet ceiling constraints added: 200

  Adding production constraints...
    Mix-based production constraints added
    Production time linking constraints added
    Production capacity limit constraints added
    Overtime detection constraints added
    Labor payment constraints added (4-hour minimum on weekends)

  Adding changeover detection...
    Product-binary bidirectional linking constraints added
    Changeover aggregation linking constraints added (overhead optimization)
    Changeover detection constraints added

  Adding truck constraints...
    Truck capacity constraints added: 77

Constraints added

================================================================================
MODEL STRUCTURE DIAGNOSTIC
================================================================================

Production variables at 6122: 35
  Sample: ('6122', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9))
Ambient balance constraints at 6122: 35
In-transit variables FROM 6122: 120
  Sample: ('6122', '6104', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 10), 'frozen')

 demand_consumed DOES NOT EXIST!

Sliding window constraints at 6122: 35

Overall model:
  Total variables: 3,235
  Total constraints: 2,935
================================================================================


Building objective...
  Production cost: $1.30/unit
  Frozen pallet fixed cost: $14.2600/pallet (on entry)
  Frozen pallet daily cost: $0.9800/pallet/day
  Shortage penalty: $10.00/unit
  Labor cost: Weekday overtime ($660/h) + Weekend ($1320/h with 4h minimum), fixed hours FREE
  Transport cost: route costs included
  Changeover cost: $38.40 per start
  Changeover waste: 30 units per start  $1.30/unit = $39.00 per start
  DEBUG WASTE COST:
    cost_structure.waste_cost_multiplier = 10.0
    After 'or 0' = 10.0
    Type: <class 'float'>
    Condition (waste_multiplier > 0): True
    hasattr(model, 'inventory'): True
     ENTERED waste cost block
    Last date: 2025-11-15
    Inventory variables at last date: 60
    end_inventory expression created (Pyomo sum)
    In-transit variables departing on last date: 60
    end_in_transit expression created (Pyomo sum)
  Waste cost: $13.00/unit  (end_inventory + end_in_transit)
    Coefficient: $13.00/unit
    Expression type: <class 'pyomo.core.expr.numeric_expr.ProductExpression'>
    If end_inventory=32,751, waste would be $425763.00
     WASTE COST EXPRESSION CREATED - WILL BE IN OBJECTIVE
  Binary indicator penalty: $0.0010 per product_produced binary

Objective built
  Active components: production + labor + transport + holding + shortage + disposal + changeover (cost + waste) + waste
  Staleness: IMPLICIT via holding costs (inventory costs money)

Model built successfully
  Writing model to workflow_model_debug.lp...
  Model written successfully

APPSI Solver Results:
  termination_condition: TerminationCondition.optimal
  best_feasible_objective: 231103.792716
  best_objective_bound: 230453.01755346032
  -> Solver reports OPTIMAL
  -> Solution loaded successfully

Mapping APPSI result to legacy format:
  APPSI termination: TerminationCondition.optimal
  -> Mapped to: optimal, success=True

DEBUG: Extracting holding cost from 385 pallet_count variables...
  Frozen cost/pallet/day: $0.98
  Ambient cost/pallet/day: $0.00
  Pallet-days: frozen=0, ambient=20464
  Holding cost extracted: frozen=$0.00, ambient=$0.00, total=$0.00

DEBUG: Extracting holding cost from 385 pallet_count variables...
  Frozen cost/pallet/day: $0.98
  Ambient cost/pallet/day: $0.00
  Pallet-days: frozen=0, ambient=20464
  Holding cost extracted: frozen=$0.00, ambient=$0.00, total=$0.00

Preprocessing initial inventory:
  Input keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient')]
  Input entry count: 34
  Initial inventory: 34 entries
  Converted keys sample: [('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient'), ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient')]
  Converted entry count: 34
  Total quantity: 30,823 units

Validating initial inventory against node capabilities:
   All 34 entries have compatible states and products
   No intermediate stop nodes added

  First-day arrival validation:
      Route 6122  Lineage (1.0d transit): Goods arriving on 2025-11-09 departed 2025-11-08 (before horizon). Should be in initial inventory at Lineage.
  Manufacturing nodes: 1
  Demand nodes: 9
  Routes FROM Lineage: 1
    - Lineage  6130 (mode=frozen, days=7.0)
  Routes TO Lineage: 1
    - 6122  Lineage (mode=ambient, days=1.0)

Sliding Window Model Initialized:
  Nodes: 11
  Routes: 10
  Products: 5
  Planning horizon: 28 days
  Demand entries: 1260
  Pallet tracking: True
Building Pyomo model in solve()...

================================================================================
BUILDING SLIDING WINDOW MODEL [git:08a4ec6]
================================================================================

Sets defined:
  Nodes: 11
  Products: 5
  Dates: 28
  States: 3

Adding variables...
  Production variables: 140
  DEBUG: Creating thawed inventory var for 6130 (has_frozen_inbound=True)
  Inventory variables: 1680
  Checking inventory variables for initial_inventory entries:
    ('6104', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=2397
    ('6110', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=285
    ('6122', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=1280
    ('6123', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=609
    ('6125', 'HELGAS GFREE TRAD WHITE 470G', 'ambient', datetime.date(2025, 11, 9)): exists=True, qty=3225
  State transition variables: 0 thaw + 0 freeze
  In-transit variables: 2160 (indexed by DEPARTURE date)
    Skipped 640 invalid route-day combinations (day-of-week enforcement)
  Pallet storage variables: 1540 integers
  Pallet entry variables: 1540 integers (for fixed costs)
  Truck pallet variables: 1540 integers
  Demand consumed variables: 1260  2 states = 2520
  Shortage variables: 1260
  Disposal variables: 374 (only for expired inventory)
  Disposal for 34 inventory items
  Binary product indicators: 280
  Changeover aggregation variables: 56 (overhead optimization)
  Labor variables: 28 (used + paid + overtime)
  Mix count variables: 140 integers

Variables created
  Continuous: 3,980
  Integers: 1,540
  Binaries: 280
  TOTAL: 5,800
  (vs cohort model: ~500,000 total)

Adding constraints...

  Adding sliding window shelf life constraints...
  DAY2 ambient_shelf_life[6122, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + production['6122',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE MIXED GRAIN 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY 18 ambient_shelf_life[6122, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + production['6122',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE TRAD WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY 18 ambient_shelf_life[6122, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1600.0 + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-09] + production['6122',HELGAS GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,HELGAS GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1600
  DAY 18 ambient_shelf_life[6122, HELGAS GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 1280.0 + production['6122',WONDER GFREE WHITE 470G,2025-11-09] + production['6122',WONDER GFREE WHITE 470G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHITE 470G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHITE 470G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 1280
  DAY 18 ambient_shelf_life[6122, WONDER GFREE WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6122, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 960.0 + production['6122',WONDER GFREE WHOLEM 500G,2025-11-09] + production['6122',WONDER GFREE WHOLEM 500G,2025-11-10]
    O: in_transit['6122','6104',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6122','6125',WONDER GFREE WHOLEM 500G,2025-11-10,ambient]
  INIT_INV CHECK ambient[6122,WONDER GFREE WHOLEM 500G,day6]:
    window_includes_day1: True
    init_inv_age_on_t: 5
    init_inv added to Q: 960
  DAY2 ambient_shelf_life[6104, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 676.0
    O: in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6104, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 2397.0
    O: in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6104, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6104, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 904.0
    O: in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 957.0
    O: in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6104, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 549.0
    O: in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6104','6105',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6104','6103',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6104',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 655.0
    O: in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6125, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 3225.0
    O: in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 3267.0
    O: in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, HELGAS GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 5416.0
    O: in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHITE 470G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHITE 470G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHITE 470G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, WONDER GFREE WHITE 470G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6125, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1474.0
    O: in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-09] + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6134',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-10,ambient] + demand_consumed_from_ambient['6125',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY 18 ambient_shelf_life[6125, WONDER GFREE WHOLEM 500G]:
    Window: 2025-11-10 to 2025-11-26 (17 days)
    days_from_start: 17
    Condition (<=16): False
    Init_inv in Q: NO
  DAY2 ambient_shelf_life[6123, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 595.0 + in_transit['6125','6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 609.0 + in_transit['6125','6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 704.0 + in_transit['6125','6123',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 404.0 + in_transit['6125','6123',WONDER GFREE WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6123, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 327.0 + in_transit['6125','6123',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6123',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 6.0 + in_transit['6125','6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6120, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 1.0 + in_transit['6125','6120',HELGAS GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6120, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 46.0 + in_transit['6125','6120',WONDER GFREE WHOLEM 500G,2025-11-09,ambient]
    O: demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6120',WONDER GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE MIXED GRAIN 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 259.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE MIXED GRAIN 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE TRAD WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 285.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE TRAD WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, HELGAS GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 291.0
    O: demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',HELGAS GFREE WHOLEM 500G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHITE 470G]:
    Window: 2 days
    Q (should NOT include init_inv): 280.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHITE 470G,2025-11-10]
  DAY2 ambient_shelf_life[6110, WONDER GFREE WHOLEM 500G]:
    Window: 2 days
    Q (should NOT include init_inv): 153.0
    O: demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-09] + demand_consumed_from_ambient['6110',WONDER GFREE WHOLEM 500G,2025-11-10]
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    Shelf life bound: inventory <= Q-O
  Shelf life window constraints: 2,940
    Ambient (17d): ~1,400
    Frozen (120d): ~140
    Thawed (14d): ~1,400

  Adding state balance constraints...
  DEBUG arrivals for 6104, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE MIXED GRAIN 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE TRAD WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHITE 470G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHOLEM 500G, 2025-11-10:
    Route from 6122, transit=1.0
    Departure date: 2025-11-09
    departure_date in model.dates: True
    Key in model.in_transit: False
    Arrival state: ambient
  DEBUG frozen_balance[Lineage, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE TRAD WHITE 470G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE TRAD WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHITE 470G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHITE 470G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHOLEM 500G, 2025-11-09]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-11-08
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-11-09,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHOLEM 500G', datetime.date(2025, 11, 9), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-11-09]:
    prev_inv: 0
    thaw_inflow: 0
    arrivals: 0
    demand_consumption: demand_consumed_from_thawed['6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09]   FIX: Now included!
    Expected: inventory = 0 + thaw + arrivals - demand
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-11-16]:
    prev_inv: inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-11-15]
    thaw_inflow: 0
    arrivals: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-09,frozen]
    demand_consumption: demand_consumed_from_thawed['6130',HELGAS GFREE MIXED GRAIN 500G,2025-11-16]   FIX: Now included!
    Expected: inventory = inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-11-15] + thaw + arrivals - demand
  State balance constraints: 2,940

  Adding demand satisfaction...
  Demand balance constraints: 1260
  Demand consumption limit constraints added: ambient and thawed (prevents over-consumption)

  Adding pallet constraints...
    Storage pallet ceiling constraints added
    Pallet entry detection constraints added
    Truck pallet ceiling constraints added: 845

  Adding production constraints...
    Mix-based production constraints added
    Production time linking constraints added
    Production capacity limit constraints added
    Overtime detection constraints added
    Labor payment constraints added (4-hour minimum on weekends)

  Adding changeover detection...
    Product-binary bidirectional linking constraints added
    Changeover aggregation linking constraints added (overhead optimization)
    Changeover detection constraints added

  Adding truck constraints...
    Truck capacity constraints added: 308

Constraints added

================================================================================
MODEL STRUCTURE DIAGNOSTIC
================================================================================

Production variables at 6122: 140
  Sample: ('6122', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 9))
Ambient balance constraints at 6122: 140
In-transit variables FROM 6122: 480
  Sample: ('6122', '6104', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 11, 10), 'frozen')

 demand_consumed DOES NOT EXIST!

Sliding window constraints at 6122: 140

Overall model:
  Total variables: 13,314
  Total constraints: 11,788
================================================================================


Building objective...
  Production cost: $1.30/unit
  Frozen pallet fixed cost: $14.2600/pallet (on entry)
  Frozen pallet daily cost: $0.9800/pallet/day
  Shortage penalty: $10.00/unit
  Disposal penalty: $15.00/unit (> shortage $10.00/unit)
  Labor cost: Weekday overtime ($660/h) + Weekend ($1320/h with 4h minimum), fixed hours FREE
  Transport cost: route costs included
  Changeover cost: $38.40 per start
  Changeover waste: 30 units per start  $1.30/unit = $39.00 per start
  DEBUG WASTE COST:
    cost_structure.waste_cost_multiplier = 10.0
    After 'or 0' = 10.0
    Type: <class 'float'>
    Condition (waste_multiplier > 0): True
    hasattr(model, 'inventory'): True
     ENTERED waste cost block
    Last date: 2025-12-06
    Inventory variables at last date: 60
    end_inventory expression created (Pyomo sum)
    In-transit variables departing on last date: 60
    end_in_transit expression created (Pyomo sum)
  Waste cost: $13.00/unit  (end_inventory + end_in_transit)
    Coefficient: $13.00/unit
    Expression type: <class 'pyomo.core.expr.numeric_expr.ProductExpression'>
    If end_inventory=32,751, waste would be $425763.00
     WASTE COST EXPRESSION CREATED - WILL BE IN OBJECTIVE
  Binary indicator penalty: $0.0010 per product_produced binary

Objective built
  Active components: production + labor + transport + holding + shortage + disposal + changeover (cost + waste) + waste
  Staleness: IMPLICIT via holding costs (inventory costs money)

Model built successfully
  Writing model to workflow_model_debug.lp...
  Model written successfully

APPSI Solver Results:
  termination_condition: TerminationCondition.optimal
  best_feasible_objective: 620125.3456792798
  best_objective_bound: 613937.0353389787
  -> Solver reports OPTIMAL
  -> Solution loaded successfully

Mapping APPSI result to legacy format:
  APPSI termination: TerminationCondition.optimal
  -> Mapped to: optimal, success=True

DEBUG: Extracting holding cost from 1540 pallet_count variables...
  Frozen cost/pallet/day: $0.98
  Ambient cost/pallet/day: $0.00
  Pallet-days: frozen=69, ambient=85564
  Holding cost extracted: frozen=$67.62, ambient=$0.00, total=$67.62

DEBUG: Extracting holding cost from 1540 pallet_count variables...
  Frozen cost/pallet/day: $0.98
  Ambient cost/pallet/day: $0.00
  Pallet-days: frozen=69, ambient=85564
  Holding cost extracted: frozen=$67.62, ambient=$0.00, total=$67.62
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
WARNING  src.optimization.sliding_window_model:sliding_window_model.py:3270 Filtered out 3 post-horizon shipments (delivery > 2025-11-15)
WARNING  src.optimization.sliding_window_model:sliding_window_model.py:3270 Filtered out 3 post-horizon shipments (delivery > 2025-11-15)
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
WARNING  src.optimization.sliding_window_model:sliding_window_model.py:3270 Filtered out 7 post-horizon shipments (delivery > 2025-12-06)
WARNING  src.optimization.sliding_window_model:sliding_window_model.py:3270 Filtered out 7 post-horizon shipments (delivery > 2025-12-06)
__________ TestSolverConfig.test_get_available_solvers_none_available __________
tests/test_solver_config.py:88: in test_get_available_solvers_none_available
    assert available == []
E   AssertionError: assert ['appsi_highs'] == []
E     
E     Left contains one more item: 'appsi_highs'
E     
E     Full diff:
E     - []
E     + [
E     +     'appsi_highs',
E     + ]
________ TestSolverConfig.test_get_best_available_solver_none_available ________
tests/test_solver_config.py:133: in test_get_best_available_solver_none_available
    with pytest.raises(RuntimeError, match="No optimization solver available"):
E   Failed: DID NOT RAISE <class 'RuntimeError'>
______ TestSolverConfig.test_get_best_available_solver_falls_back_to_cbc _______
tests/test_solver_config.py:169: in test_get_best_available_solver_falls_back_to_cbc
    assert best == 'cbc'
E   AssertionError: assert 'appsi_highs' == 'cbc'
E     
E     - cbc
E     + appsi_highs
______________ TestSolverPreference.test_solver_preference_order _______________
tests/test_solver_config.py:386: in test_solver_preference_order
    assert SolverConfig.SOLVER_PREFERENCE[2] == SolverType.ASL_CBC
E   AssertionError: assert <SolverType.A...'appsi_highs'> == <SolverType.A...BC: 'asl:cbc'>
E     
E     - asl:cbc
E     + appsi_highs
________________________ test_solver_performance_1_week ________________________
tests/test_solver_performance_comparison.py:179: in test_solver_performance_1_week
    model_cbc = create_model()
                ^^^^^^^^^^^^^^
tests/test_solver_performance_comparison.py:164: in create_model
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
PERFORMANCE BENCHMARK: 1-WEEK HORIZON (SMALL PROBLEM)
================================================================================
Planning horizon: 2025-10-07 to 2025-10-14 (7 days)

Solving with CBC...
________________________ test_solver_performance_2_week ________________________
tests/test_solver_performance_comparison.py:278: in test_solver_performance_2_week
    model_cbc = create_model()
                ^^^^^^^^^^^^^^
tests/test_solver_performance_comparison.py:263: in create_model
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
PERFORMANCE BENCHMARK: 2-WEEK HORIZON (MEDIUM PROBLEM)
================================================================================
Planning horizon: 2025-10-07 to 2025-10-21 (14 days)

Solving with CBC...
________________________ test_solver_performance_4_week ________________________
tests/test_solver_performance_comparison.py:379: in test_solver_performance_4_week
    model_cbc = create_model()
                ^^^^^^^^^^^^^^
tests/test_solver_performance_comparison.py:364: in create_model
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
PRIMARY PERFORMANCE BENCHMARK: 4-WEEK HORIZON (LARGE PROBLEM)
================================================================================
Planning horizon: 2025-10-07 to 2025-11-04 (28 days)
Expected: CBC ~226s, HiGHS ~96s (2.35x speedup)

Solving with CBC...
_______________ test_solution_extraction_with_zero_holding_costs _______________
tests/test_solver_timeout_handling.py:122: in test_solution_extraction_with_zero_holding_costs
    assert cost_structure.storage_cost_per_pallet_day_frozen == 0.0, \
E   AssertionError: Test requires zero frozen pallet costs
E   assert 0.9800000000000001 == 0.0
E    +  where 0.9800000000000001 = CostStructure(production_cost_per_unit=1.3, setup_cost=0.0, default_regular_rate=20.0, default_overtime_rate=30.0, default_non_fixed_rate=40.0, transport_cost_frozen_per_unit=0.5, transport_cost_ambient_per_unit=0.3, truck_fixed_cost=100.0, storage_cost_frozen_per_unit_day=0.0, storage_cost_ambient_per_unit_day=0.0, storage_cost_fixed_per_pallet=0.0, storage_cost_per_pallet_day_frozen=0.9800000000000001, storage_cost_per_pallet_day_ambient=0.0, storage_cost_fixed_per_pallet_frozen=14.26, storage_cost_fixed_per_pallet_ambient=0.0, waste_cost_multiplier=10.0, shortage_penalty_per_unit=10.0, freshness_incentive_weight=0.13, changeover_cost_per_start=38.4, changeover_waste_units=30.0).storage_cost_per_pallet_day_frozen
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: Solution Extraction with Zero Holding Costs
================================================================================
Planning horizon: 2025-10-07 to 2025-10-14 (7 days)
_______________________ test_intermediate_stop_expansion _______________________
tests/test_truck_routing_fixes.py:92: in test_intermediate_stop_expansion
    assert lineage_to_6125, "Lineage  6125 route should be created from intermediate stop expansion"
E   AssertionError: Lineage  6125 route should be created from intermediate stop expansion
E   assert False
----------------------------- Captured stdout call -----------------------------
   No intermediate stop nodes added

  First-day arrival validation:
      Route 6122  Lineage (1.0d transit): Goods arriving on 2025-01-06 departed 2025-01-05 (before horizon). Should be in initial inventory at Lineage.
      Route Lineage  6130 (7.0d transit): Goods arriving on 2025-01-06 departed 2024-12-30 (before horizon). Should be in initial inventory at 6130.
  Manufacturing nodes: 1
  Demand nodes: 9
  Routes FROM Lineage: 1
    - Lineage  6130 (mode=frozen, days=7.0)
  Routes TO Lineage: 1
    - 6122  Lineage (mode=ambient, days=1.0)

Sliding Window Model Initialized:
  Nodes: 11
  Routes: 10
  Products: 5
  Planning horizon: 7 days
  Demand entries: 0
  Pallet tracking: False

Routes before expansion: 10
Routes after expansion: 10
Routes added: 0
_________________________ test_lineage_receives_goods __________________________
tests/test_truck_routing_fixes.py:310: in test_lineage_receives_goods
    assert result.is_optimal() or result.is_feasible(), f"Expected feasible solution, got {result.termination_condition}"
E   AssertionError: Expected feasible solution, got None
E   assert (False or False)
E    +  where False = is_optimal()
E    +    where is_optimal = OptimizationResult(success=False, objective_value=None, solver_status=None, termination_condition=None, solve_time_seconds=None, solver_name=None, gap=None, num_variables=2270, num_constraints=1913, num_integer_vars=0, infeasibility_message='Unknown solver: unknown', solver_output=None, metadata={}).is_optimal
E    +  and   False = is_feasible()
E    +    where is_feasible = OptimizationResult(success=False, objective_value=None, solver_status=None, termination_condition=None, solve_time_seconds=None, solver_name=None, gap=None, num_variables=2270, num_constraints=1913, num_integer_vars=0, infeasibility_message='Unknown solver: unknown', solver_output=None, metadata={}).is_feasible
----------------------------- Captured stdout call -----------------------------
   No intermediate stop nodes added

  First-day arrival validation:
      Route 6122  Lineage (1.0d transit): Goods arriving on 2025-01-06 departed 2025-01-05 (before horizon). Should be in initial inventory at Lineage.
      Route Lineage  6130 (7.0d transit): Goods arriving on 2025-01-06 departed 2024-12-30 (before horizon). Should be in initial inventory at 6130.
  Manufacturing nodes: 1
  Demand nodes: 9
  Routes FROM Lineage: 1
    - Lineage  6130 (mode=frozen, days=7.0)
  Routes TO Lineage: 1
    - 6122  Lineage (mode=ambient, days=1.0)

Sliding Window Model Initialized:
  Nodes: 11
  Routes: 10
  Products: 5
  Planning horizon: 14 days
  Demand entries: 0
  Pallet tracking: False

Lineage routing:
  Route TO Lineage (6122  Lineage): True
  Routes FROM Lineage: True

================================================================================
BUILDING SLIDING WINDOW MODEL [git:08a4ec6]
================================================================================

Sets defined:
  Nodes: 11
  Products: 5
  Dates: 14
  States: 3

Adding variables...
  Production variables: 70
  DEBUG: Creating thawed inventory var for 6130 (has_frozen_inbound=True)
  Inventory variables: 840
  State transition variables: 0 thaw + 0 freeze
  In-transit variables: 1080 (indexed by DEPARTURE date)
    Skipped 320 invalid route-day combinations (day-of-week enforcement)
  Demand consumed variables: 0  2 states = 0
  Shortage variables: 0
  Binary product indicators: 140
  Changeover aggregation variables: 28 (overhead optimization)
  Labor variables: 14 (used + paid + overtime)
  Mix count variables: 70 integers

Variables created
  Continuous: 1,990
  Integers: 0
  Binaries: 140
  TOTAL: 2,130
  (vs cohort model: ~500,000 total)

Adding constraints...

  Adding sliding window shelf life constraints...
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
  Shelf life window constraints: 1,470
    Ambient (17d): ~700
    Frozen (120d): ~70
    Thawed (14d): ~700

  Adding state balance constraints...
  DEBUG arrivals for 6104, HELGAS GFREE MIXED GRAIN 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE TRAD WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE MIXED GRAIN 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE TRAD WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG frozen_balance[Lineage, HELGAS GFREE MIXED GRAIN 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE TRAD WHITE 470G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE TRAD WHITE 470G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE WHOLEM 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHITE 470G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHITE 470G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHOLEM 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHOLEM 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-01-06]:
    prev_inv: 0
    thaw_inflow: 0
    arrivals: 0
    demand_consumption: 0   FIX: Now included!
    Expected: inventory = 0 + thaw + arrivals - demand
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-01-13]:
    prev_inv: inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-01-12]
    thaw_inflow: 0
    arrivals: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    demand_consumption: 0   FIX: Now included!
    Expected: inventory = inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-01-12] + thaw + arrivals - demand
  State balance constraints: 1,470

  Adding demand satisfaction...
  Demand balance constraints: 0
  Demand consumption limit constraints added: ambient and thawed (prevents over-consumption)

  Adding pallet constraints...

  Adding production constraints...
    Mix-based production constraints added
    Production time linking constraints added
    Production capacity limit constraints added
    Overtime detection constraints added
    Labor payment constraints added (4-hour minimum on weekends)

  Adding changeover detection...
    Product-binary bidirectional linking constraints added
    Changeover aggregation linking constraints added (overhead optimization)
    Changeover detection constraints added

  Adding truck constraints...
    Truck constraints skipped (no schedules or tracking disabled)

Constraints added

================================================================================
MODEL STRUCTURE DIAGNOSTIC
================================================================================

Production variables at 6122: 70
  Sample: ('6122', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6))
Ambient balance constraints at 6122: 70
In-transit variables FROM 6122: 240
  Sample: ('6122', '6104', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6), 'frozen')

 demand_consumed DOES NOT EXIST!

Sliding window constraints at 6122: 70

Overall model:
  Total variables: 2,270
  Total constraints: 1,913
================================================================================


Building objective...
  Production cost: $1.30/unit
  Shortage penalty: $10.00/unit
  Labor cost: Weekday overtime ($660/h) + Weekend ($1320/h with 4h minimum), fixed hours FREE
  Transport cost: route costs included
  Changeover cost: $38.40 per start
  Changeover waste: 30 units per start  $1.30/unit = $39.00 per start
  DEBUG WASTE COST:
    cost_structure.waste_cost_multiplier = 10.0
    After 'or 0' = 10.0
    Type: <class 'float'>
    Condition (waste_multiplier > 0): True
    hasattr(model, 'inventory'): True
     ENTERED waste cost block
    Last date: 2025-01-19
    Inventory variables at last date: 60
    end_inventory expression created (Pyomo sum)
    In-transit variables departing on last date: 60
    end_in_transit expression created (Pyomo sum)
  Waste cost: $13.00/unit  (end_inventory + end_in_transit)
    Coefficient: $13.00/unit
    Expression type: <class 'pyomo.core.expr.numeric_expr.ProductExpression'>
    If end_inventory=32,751, waste would be $425763.00
     WASTE COST EXPRESSION CREATED - WILL BE IN OBJECTIVE
  Binary indicator penalty: $0.0010 per product_produced binary

Objective built
  Active components: production + labor + transport + holding + shortage + disposal + changeover (cost + waste) + waste
  Staleness: IMPLICIT via holding costs (inventory costs money)

Model built successfully
Building Pyomo model in solve()...

================================================================================
BUILDING SLIDING WINDOW MODEL [git:08a4ec6]
================================================================================

Sets defined:
  Nodes: 11
  Products: 5
  Dates: 14
  States: 3

Adding variables...
  Production variables: 70
  DEBUG: Creating thawed inventory var for 6130 (has_frozen_inbound=True)
  Inventory variables: 840
  State transition variables: 0 thaw + 0 freeze
  In-transit variables: 1080 (indexed by DEPARTURE date)
    Skipped 320 invalid route-day combinations (day-of-week enforcement)
  Demand consumed variables: 0  2 states = 0
  Shortage variables: 0
  Binary product indicators: 140
  Changeover aggregation variables: 28 (overhead optimization)
  Labor variables: 14 (used + paid + overtime)
  Mix count variables: 70 integers

Variables created
  Continuous: 1,990
  Integers: 0
  Binaries: 140
  TOTAL: 2,130
  (vs cohort model: ~500,000 total)

Adding constraints...

  Adding sliding window shelf life constraints...
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
    Q_frozen (inflows): 0
    O_frozen (outflows): in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-01-06,frozen]
    Shelf life bound: inventory <= Q-O
  Shelf life window constraints: 1,470
    Ambient (17d): ~700
    Frozen (120d): ~70
    Thawed (14d): ~700

  Adding state balance constraints...
  DEBUG arrivals for 6104, HELGAS GFREE MIXED GRAIN 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE TRAD WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, HELGAS GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6104, WONDER GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE MIXED GRAIN 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE TRAD WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, HELGAS GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHITE 470G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG arrivals for 6125, WONDER GFREE WHOLEM 500G, 2025-01-07:
    Route from 6122, transit=1.0
    Departure date: 2025-01-06
    departure_date in model.dates: True
    Key in model.in_transit: True
    Arrival state: ambient
  DEBUG frozen_balance[Lineage, HELGAS GFREE MIXED GRAIN 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE TRAD WHITE 470G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE TRAD WHITE 470G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE TRAD WHITE 470G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, HELGAS GFREE WHOLEM 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',HELGAS GFREE WHOLEM 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHITE 470G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHITE 470G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHITE 470G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG frozen_balance[Lineage, WONDER GFREE WHOLEM 500G, 2025-01-06]:
    prev_inv: 0
    production_inflow: 0
    freeze_inflow: 0
    arrivals: 0
    Routes TO Lineage: 1
      Route: 6122  Lineage
        Transport mode: ambient
        Ship state: ambient
        Arrival state: frozen
        Departure date: 2025-01-05
        Dep in horizon: False
        Key in model: False
    thaw_outflow: 0
    departures: in_transit[Lineage,'6130',WONDER GFREE WHOLEM 500G,2025-01-06,frozen]
    in_transit[('Lineage', '6130', 'WONDER GFREE WHOLEM 500G', datetime.date(2025, 1, 6), 'frozen')] exists: True
    Expected: inventory = 0 + 0 + 0 + arrivals - departures - 0
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-01-06]:
    prev_inv: 0
    thaw_inflow: 0
    arrivals: 0
    demand_consumption: 0   FIX: Now included!
    Expected: inventory = 0 + thaw + arrivals - demand
  DEBUG thawed_balance[6130, HELGAS GFREE MIXED GRAIN 500G, 2025-01-13]:
    prev_inv: inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-01-12]
    thaw_inflow: 0
    arrivals: in_transit[Lineage,'6130',HELGAS GFREE MIXED GRAIN 500G,2025-01-06,frozen]
    demand_consumption: 0   FIX: Now included!
    Expected: inventory = inventory['6130',HELGAS GFREE MIXED GRAIN 500G,thawed,2025-01-12] + thaw + arrivals - demand
  State balance constraints: 1,470

  Adding demand satisfaction...
  Demand balance constraints: 0
  Demand consumption limit constraints added: ambient and thawed (prevents over-consumption)

  Adding pallet constraints...

  Adding production constraints...
    Mix-based production constraints added
    Production time linking constraints added
    Production capacity limit constraints added
    Overtime detection constraints added
    Labor payment constraints added (4-hour minimum on weekends)

  Adding changeover detection...
    Product-binary bidirectional linking constraints added
    Changeover aggregation linking constraints added (overhead optimization)
    Changeover detection constraints added

  Adding truck constraints...
    Truck constraints skipped (no schedules or tracking disabled)

Constraints added

================================================================================
MODEL STRUCTURE DIAGNOSTIC
================================================================================

Production variables at 6122: 70
  Sample: ('6122', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6))
Ambient balance constraints at 6122: 70
In-transit variables FROM 6122: 240
  Sample: ('6122', '6104', 'HELGAS GFREE MIXED GRAIN 500G', datetime.date(2025, 1, 6), 'frozen')

 demand_consumed DOES NOT EXIST!

Sliding window constraints at 6122: 70

Overall model:
  Total variables: 2,270
  Total constraints: 1,913
================================================================================


Building objective...
  Production cost: $1.30/unit
  Shortage penalty: $10.00/unit
  Labor cost: Weekday overtime ($660/h) + Weekend ($1320/h with 4h minimum), fixed hours FREE
  Transport cost: route costs included
  Changeover cost: $38.40 per start
  Changeover waste: 30 units per start  $1.30/unit = $39.00 per start
  DEBUG WASTE COST:
    cost_structure.waste_cost_multiplier = 10.0
    After 'or 0' = 10.0
    Type: <class 'float'>
    Condition (waste_multiplier > 0): True
    hasattr(model, 'inventory'): True
     ENTERED waste cost block
    Last date: 2025-01-19
    Inventory variables at last date: 60
    end_inventory expression created (Pyomo sum)
    In-transit variables departing on last date: 60
    end_in_transit expression created (Pyomo sum)
  Waste cost: $13.00/unit  (end_inventory + end_in_transit)
    Coefficient: $13.00/unit
    Expression type: <class 'pyomo.core.expr.numeric_expr.ProductExpression'>
    If end_inventory=32,751, waste would be $425763.00
     WASTE COST EXPRESSION CREATED - WILL BE IN OBJECTIVE
  Binary indicator penalty: $0.0010 per product_produced binary

Objective built
  Active components: production + labor + transport + holding + shortage + disposal + changeover (cost + waste) + waste
  Staleness: IMPLICIT via holding costs (inventory costs money)

Model built successfully
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
_______________________ test_unified_model_1week_solves ________________________
tests/test_unified_1week_solve.py:76: in test_unified_model_1week_solves
    result = model.solve(time_limit_seconds=90, mip_gap=0.05, tee=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

================================================================================
TESTING UNIFIED MODEL 1-WEEK SOLVE
================================================================================

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-13 (7 days)
  Products: 5
  Demand entries: 280

Solving unified model...
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 7 dates, 10 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 8,820 cohorts
  Shipment cohorts by origin node:
    6104: 210
    6122: 390
    6125: 315
  Shipment cohort indices: 915
  Demand cohort indices: 2,240
   Truck pallet tracking enabled: 420 integer pallet variables
  Changeover tracking: 7 production days, 35 product indicators (VARIABLE (binary decision))
  Start tracking: 35 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (112 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 12 storage delay constraints
   Added truck pallet ceiling constraints: 420 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 140
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 140
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 8,820 total cohorts (2,940 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 2,240 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
_ TestUnifiedNodeModelConditionalPalletTracking.test_pallet_tracking_neither_state _
tests/test_unified_conditional_pallet_tracking.py:465: in test_pallet_tracking_neither_state
    pyomo_model = model.build_model()
                  ^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:898: in build_model
    ???
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:3983: in _add_objective
    ???
E   UnboundLocalError: cannot access local variable 'small_pallet_cohorts' where it is not associated with a value
----------------------------- Captured stdout call -----------------------------

Unified Model Data Summary:
  Nodes: 2
    Manufacturing: 1
    Demand: 1
    With truck constraints: 1
  Routes: 1
  Truck schedules: 1
  Planning horizon: 2025-10-20 to 2025-10-26 (7 days)
  Products: 1
  Demand entries: 7

Building Unified Node Model...
  Sets defined: 2 nodes, 1 products, 7 dates, 1 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 336 cohorts
  Shipment cohorts by origin node:
    6122: 21
  Shipment cohort indices: 21
  Demand cohort indices: 56
   Truck pallet tracking enabled: 7 integer pallet variables
  Changeover tracking: 7 production days, 7 product indicators (VARIABLE (binary decision))
  Start tracking: 7 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (28 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
   Added truck pallet ceiling constraints: 7 constraints
_ TestUnifiedNodeModelConditionalPalletTracking.test_state_specific_fixed_costs_in_objective _
tests/test_unified_conditional_pallet_tracking.py:556: in test_state_specific_fixed_costs_in_objective
    result = model.solve(time_limit_seconds=60, mip_gap=0.05, tee=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

Unified Model Data Summary:
  Nodes: 3
    Manufacturing: 1
    Demand: 1
    With truck constraints: 1
  Routes: 2
  Truck schedules: 1
  Planning horizon: 2025-10-20 to 2025-10-26 (7 days)
  Products: 1
  Demand entries: 7

Building Unified Node Model...
  Sets defined: 3 nodes, 1 products, 7 dates, 2 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 420 cohorts
  Shipment cohorts by origin node:
    6122: 28
    Lineage: 10
  Shipment cohort indices: 38
  Demand cohort indices: 56
   Truck pallet tracking enabled: 7 integer pallet variables
  Changeover tracking: 7 production days, 7 product indicators (VARIABLE (binary decision))
  Start tracking: 7 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (28 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 1 nodes: ['Lineage']
    Added 4 storage delay constraints
   Added truck pallet ceiling constraints: 7 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 140
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['ambient', 'frozen', 'thawed']
    - Pallet integer variables: 140
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: []
  Holding cost enabled: 420 total cohorts (420 pallet-tracked)
  End-of-horizon waste: 1.50 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve

State-specific fixed costs verification:
  Frozen fixed cost: $5.0/pallet
  Ambient fixed cost: $2.0/pallet
  Frozen pallet cohorts: 28
  Ambient pallet cohorts: 56
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 3 nodes, 1 products, 7 dates, 2 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 420 cohorts
  Shipment cohorts by origin node:
    6122: 28
    Lineage: 10
  Shipment cohort indices: 38
  Demand cohort indices: 56
   Truck pallet tracking enabled: 7 integer pallet variables
  Changeover tracking: 7 production days, 7 product indicators (VARIABLE (binary decision))
  Start tracking: 7 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (28 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 1 nodes: ['Lineage']
    Added 4 storage delay constraints
   Added truck pallet ceiling constraints: 7 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 140
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['ambient', 'frozen', 'thawed']
    - Pallet integer variables: 140
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: []
  Holding cost enabled: 420 total cohorts (420 pallet-tracked)
  End-of-horizon waste: 1.50 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
__________________________ test_unified_node_creation __________________________
tests/test_unified_models.py:75: in test_unified_node_creation
    storage_mode=StorageMode.BOTH,  # Can handle both frozen and ambient
                 ^^^^^^^^^^^^^^^^
/usr/lib/python3.11/enum.py:789: in __getattr__
    raise AttributeError(name) from None
E   AttributeError: BOTH
________________ test_unified_model_produces_without_shortages _________________
tests/test_unified_produces.py:67: in test_unified_model_produces_without_shortages
    result = model.solve(time_limit_seconds=120, mip_gap=0.05)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

================================================================================
TESTING UNIFIED MODEL PRODUCTION (NO SHORTAGES ALLOWED)
================================================================================

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-13 (7 days)
  Products: 5
  Demand entries: 280
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 7 dates, 10 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 8,820 cohorts
  Shipment cohorts by origin node:
    6104: 210
    6122: 390
    6125: 315
  Shipment cohort indices: 915
  Demand cohort indices: 2,240
   Truck pallet tracking enabled: 420 integer pallet variables
  Changeover tracking: 7 production days, 35 product indicators (VARIABLE (binary decision))
  Start tracking: 35 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (112 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 12 storage delay constraints
   Added truck pallet ceiling constraints: 420 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 140
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 140
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 8,820 total cohorts (2,940 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 2,240 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
_______________________ test_unified_solution_extraction _______________________
tests/test_unified_solution_extraction.py:67: in test_unified_solution_extraction
    result = model.solve(time_limit_seconds=90, mip_gap=0.05)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

================================================================================
TESTING SOLUTION EXTRACTION
================================================================================

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-13 (7 days)
  Products: 5
  Demand entries: 280
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 7 dates, 10 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 8,820 cohorts
  Shipment cohorts by origin node:
    6104: 210
    6122: 390
    6125: 315
  Shipment cohort indices: 915
  Demand cohort indices: 2,240
   Truck pallet tracking enabled: 420 integer pallet variables
  Changeover tracking: 7 production days, 35 product indicators (VARIABLE (binary decision))
  Start tracking: 35 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (112 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 12 storage delay constraints
   Added truck pallet ceiling constraints: 420 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 140
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 140
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 8,820 total cohorts (2,940 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 2,240 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
_________________ test_freeze_transition_and_shelf_life_reset __________________
tests/test_unified_state_transitions_full.py:113: in test_freeze_transition_and_shelf_life_reset
    result = model.solve(time_limit_seconds=30)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:533: in solve
    self.model = self.build_model()
                 ^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:898: in build_model
    ???
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:3983: in _add_objective
    ???
E   UnboundLocalError: cannot access local variable 'small_pallet_cohorts' where it is not associated with a value
----------------------------- Captured stdout call -----------------------------

Unified Model Data Summary:
  Nodes: 3
    Manufacturing: 1
    Demand: 1
    With truck constraints: 0
  Routes: 2
  Truck schedules: 0
  Planning horizon: 2025-10-01 to 2025-10-03 (3 days)
  Products: 1
  Demand entries: 1
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 3 nodes, 1 products, 3 dates, 2 routes
  Production dates for cohorts: 3 in horizon + 0 from initial inventory
  Cohort indices: 50 cohorts
  Shipment cohorts by origin node:
    FROZEN: 3
    MFG: 3
  Shipment cohort indices: 6
  Demand cohort indices: 6
  Changeover tracking: 3 production days, 3 product indicators (VARIABLE (binary decision))
  Start tracking: 3 start indicators (binary)
  Labor cost variables: 3 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (12 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (3 node-date pairs, 27 constraints)
  Adding storage shipment delay constraint for 2 nodes: ['MFG', 'FROZEN']
    Added 4 storage delay constraints
_________ TestWarmstartPerformance.test_warmstart_speedup_measurement __________
tests/test_unified_warmstart_integration.py:566: in test_warmstart_speedup_measurement
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
_________________ test_unified_model_weekend_truck_enforcement _________________
tests/test_unified_weekend_enforcement.py:71: in test_unified_model_weekend_truck_enforcement
    result = model.solve(time_limit_seconds=90, mip_gap=0.05)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:1609: in solve
    ???
src/optimization/base_model.py:674: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
----------------------------- Captured stdout call -----------------------------

================================================================================
TESTING WEEKEND TRUCK ENFORCEMENT
================================================================================

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-10-13 (7 days)
  Products: 5
  Demand entries: 280
Building Pyomo model in solve()...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 7 dates, 10 routes
  Production dates for cohorts: 7 in horizon + 0 from initial inventory
  Cohort indices: 8,820 cohorts
  Shipment cohorts by origin node:
    6104: 210
    6122: 390
    6125: 315
  Shipment cohort indices: 915
  Demand cohort indices: 2,240
   Truck pallet tracking enabled: 420 integer pallet variables
  Changeover tracking: 7 production days, 35 product indicators (VARIABLE (binary decision))
  Start tracking: 35 start indicators (binary)
  Labor cost variables: 7 labor hour variables added
  Variables created successfully
  Adding core constraints...
  demand_inventory_linking_con: REMOVED (redundant with inventory_balance)
  Changeover tracking constraints added (112 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (7 node-date pairs, 63 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 12 storage delay constraints
   Added truck pallet ceiling constraints: 420 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 140
    Domain reduced: 62  10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 140
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 8,820 total cohorts (2,940 pallet-tracked)

  Staleness penalty enabled: $0.1300 per unit per age ratio
  State-aware normalization: frozen=120d, thawed=14d, ambient=17d shelf lives
  Staleness penalty calculation: 2,240 demand cohorts
  Formula: (calendar_age / state_shelf_life)  $0.1300  demand_satisfied
  Result: Frozen inventory has minimal staleness cost (age/120)
  Changeover cost enabled: $38.40 per start

  Changeover waste enabled: 30.0 units per SKU start
  Cost: $390.00 per changeover
  End-of-horizon waste: 10.00 production cost per unit
  Combined waste cost prevents stockpiling and penalizes small batches
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
  Writing model to workflow_model_debug.lp...
  Model written successfully
------------------------------ Captured log call -------------------------------
WARNING  pyomo.core:block.py:1992 Filename 'workflow_model_debug.lp' likely does not match specified file format (lp)
________________ test_zero_transport_costs_solution_extraction _________________
tests/test_unified_zero_cost_scenarios.py:76: in test_zero_transport_costs_solution_extraction
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
TESTING ZERO TRANSPORT COSTS
================================================================================
_________________ test_zero_storage_costs_solution_extraction __________________
tests/test_unified_zero_cost_scenarios.py:134: in test_zero_storage_costs_solution_extraction
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
TESTING ZERO STORAGE COSTS
================================================================================
________________________ test_mixed_zero_nonzero_costs _________________________
tests/test_unified_zero_cost_scenarios.py:191: in test_mixed_zero_nonzero_costs
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
TESTING MIXED ZERO/NON-ZERO COSTS
================================================================================
__________________________ test_zero_production_cost ___________________________
tests/test_unified_zero_cost_scenarios.py:240: in test_zero_production_cost
    product_ids = sorted(set(entry.product_id for entry in forecast.entries))
                                                           ^^^^^^^^
E   NameError: name 'forecast' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
TESTING ZERO PRODUCTION COST
================================================================================
____________________ test_user_data_infeasibility_diagnosis ____________________
tests/test_user_data_infeasibility.py:58: in test_user_data_infeasibility_diagnosis
    manufacturing_site = ManufacturingSite(
src/models/manufacturing.py:82: in __init__
    super().__init__(**data)
E   pydantic_core._pydantic_core.ValidationError: 3 validation errors for ManufacturingSite
E   name
E     Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
E   storage_mode
E     Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
E   production_rate
E     Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing

During handling of the above exception, another exception occurred:
tests/test_user_data_infeasibility.py:138: in test_user_data_infeasibility_diagnosis
    pytest.fail(f"Data parsing failed: {e}")
E   Failed: Data parsing failed: 3 validation errors for ManufacturingSite
E   name
E     Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
E   storage_mode
E     Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
E   production_rate
E     Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
E       For further information visit https://errors.pydantic.dev/2.11/v/missing
----------------------------- Captured stdout call -----------------------------

================================================================================
USER DATA INFEASIBILITY DIAGNOSTIC TEST
================================================================================
Forecast: data/examples/Gfree Forecast.xlsm
Network Config: data/examples/Network_Config.xlsx
Inventory: data/examples/inventory_latest.XLSX

================================================================================
PARSING DATA FILES
================================================================================

 Data parsing failed: 3 validation errors for ManufacturingSite
name
  Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
storage_mode
  Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
production_rate
  Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
----------------------------- Captured stderr call -----------------------------
Traceback (most recent call last):
  File "/home/sverzijl/planning_latest/tests/test_user_data_infeasibility.py", line 58, in test_user_data_infeasibility_diagnosis
    manufacturing_site = ManufacturingSite(
                         ^^^^^^^^^^^^^^^^^^
  File "/home/sverzijl/planning_latest/src/models/manufacturing.py", line 82, in __init__
    super().__init__(**data)
  File "/home/sverzijl/planning_latest/venv/lib/python3.11/site-packages/pydantic/main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 3 validation errors for ManufacturingSite
name
  Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
storage_mode
  Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
production_rate
  Field required [type=missing, input_value={'id': '6122', 'location_...URING: 'manufacturing'>}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
________________________ test_6week_warmstart_baseline _________________________
tests/test_warmstart_baseline.py:107: in test_6week_warmstart_baseline
    result = solve_weekly_pattern_warmstart(
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:5666: in solve_weekly_pattern_warmstart
    ???
E   TypeError: UnifiedNodeModel.__init__() missing 1 required positional argument: 'products'
----------------------------- Captured stdout call -----------------------------

================================================================================
BASELINE TEST - Current Warmstart Performance
================================================================================

Capturing metrics BEFORE implementing enhancements...

Configuration:
  Horizon: 2025-10-20 to 2025-11-30 (42 days)
  Solver: APPSI_HIGHS
  Phase 1 timeout: 120s
  Phase 2 timeout: 600s
  MIP gap: 3%
================================================================================
WEEKLY PATTERN WARMSTART SOLVER
Two-Phase: Weekly Cycle (no pallets)  Full Binary (with pallets)
================================================================================

Horizon: 42 days (29 weekdays, 13 weekends)
Binary variable reduction:
  Individual approach: 210 vars
  Weekly pattern: 90 vars (25 pattern + 65 weekends)
  Reduction: 57.1% fewer

================================================================================
PHASE 1: Weekly Production Cycle (No Pallet Tracking)
================================================================================

  Phase 1 Cost Conversion (Frozen Storage):
    Pallet variable cost: $0.9800/pallet-day
    Pallet fixed cost:    $14.26/pallet (amortized over 7 days)
     Unit equivalent:    $0.009429/unit-day
     No pallet_count variables in Phase 1 (fast solve)
_________________________ test_pallet_hints_extracted __________________________
tests/test_warmstart_enhancements.py:94: in test_pallet_hints_extracted
    result = solve_weekly_pattern_warmstart(
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:5666: in solve_weekly_pattern_warmstart
    ???
E   TypeError: UnifiedNodeModel.__init__() missing 1 required positional argument: 'products'
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: Pallet Hints Extraction
================================================================================
================================================================================
WEEKLY PATTERN WARMSTART SOLVER
Two-Phase: Weekly Cycle (no pallets)  Full Binary (with pallets)
================================================================================

Horizon: 42 days (29 weekdays, 13 weekends)
Binary variable reduction:
  Individual approach: 210 vars
  Weekly pattern: 90 vars (25 pattern + 65 weekends)
  Reduction: 57.1% fewer

================================================================================
PHASE 1: Weekly Production Cycle (No Pallet Tracking)
================================================================================

  Phase 1 Cost Conversion (Frozen Storage):
    Pallet variable cost: $0.9800/pallet-day
    Pallet fixed cost:    $14.26/pallet (amortized over 7 days)
     Unit equivalent:    $0.009429/unit-day
     No pallet_count variables in Phase 1 (fast solve)
________________________ test_bound_tightening_applied _________________________
tests/test_warmstart_enhancements.py:138: in test_bound_tightening_applied
    result = solve_weekly_pattern_warmstart(
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:5666: in solve_weekly_pattern_warmstart
    ???
E   TypeError: UnifiedNodeModel.__init__() missing 1 required positional argument: 'products'
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: Bound Tightening Application
================================================================================
================================================================================
WEEKLY PATTERN WARMSTART SOLVER
Two-Phase: Weekly Cycle (no pallets)  Full Binary (with pallets)
================================================================================

Horizon: 42 days (29 weekdays, 13 weekends)
Binary variable reduction:
  Individual approach: 210 vars
  Weekly pattern: 90 vars (25 pattern + 65 weekends)
  Reduction: 57.1% fewer

================================================================================
PHASE 1: Weekly Production Cycle (No Pallet Tracking)
================================================================================

  Phase 1 Cost Conversion (Frozen Storage):
    Pallet variable cost: $0.9800/pallet-day
    Pallet fixed cost:    $14.26/pallet (amortized over 7 days)
     Unit equivalent:    $0.009429/unit-day
     No pallet_count variables in Phase 1 (fast solve)
_________________________ test_enhancement_diagnostics _________________________
tests/test_warmstart_enhancements.py:307: in test_enhancement_diagnostics
    result = solve_weekly_pattern_warmstart(
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:5666: in solve_weekly_pattern_warmstart
    ???
E   TypeError: UnifiedNodeModel.__init__() missing 1 required positional argument: 'products'
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: Enhancement Diagnostics
================================================================================
================================================================================
WEEKLY PATTERN WARMSTART SOLVER
Two-Phase: Weekly Cycle (no pallets)  Full Binary (with pallets)
================================================================================

Horizon: 42 days (29 weekdays, 13 weekends)
Binary variable reduction:
  Individual approach: 210 vars
  Weekly pattern: 90 vars (25 pattern + 65 weekends)
  Reduction: 57.1% fewer

================================================================================
PHASE 1: Weekly Production Cycle (No Pallet Tracking)
================================================================================

  Phase 1 Cost Conversion (Frozen Storage):
    Pallet variable cost: $0.9800/pallet-day
    Pallet fixed cost:    $14.26/pallet (amortized over 7 days)
     Unit equivalent:    $0.009429/unit-day
     No pallet_count variables in Phase 1 (fast solve)
_________________________ test_6week_under_time_limit __________________________
tests/test_warmstart_enhancements.py:366: in test_6week_under_time_limit
    result = solve_weekly_pattern_warmstart(
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:5666: in solve_weekly_pattern_warmstart
    ???
E   TypeError: UnifiedNodeModel.__init__() missing 1 required positional argument: 'products'
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: 6-Week Solve Under Time Limit (PRIMARY GOAL)
================================================================================
================================================================================
WEEKLY PATTERN WARMSTART SOLVER
Two-Phase: Weekly Cycle (no pallets)  Full Binary (with pallets)
================================================================================

Horizon: 42 days (29 weekdays, 13 weekends)
Binary variable reduction:
  Individual approach: 210 vars
  Weekly pattern: 90 vars (25 pattern + 65 weekends)
  Reduction: 57.1% fewer

================================================================================
PHASE 1: Weekly Production Cycle (No Pallet Tracking)
================================================================================

  Phase 1 Cost Conversion (Frozen Storage):
    Pallet variable cost: $0.9800/pallet-day
    Pallet fixed cost:    $14.26/pallet (amortized over 7 days)
     Unit equivalent:    $0.009429/unit-day
     No pallet_count variables in Phase 1 (fast solve)
____________________ test_warmstart_performance_improvement ____________________
tests/test_warmstart_performance_comparison.py:156: in test_warmstart_performance_improvement
    products=products,
             ^^^^^^^^
E   NameError: name 'products' is not defined
----------------------------- Captured stdout call -----------------------------

================================================================================
WARMSTART PERFORMANCE BENCHMARK
================================================================================
Planning horizon: 2025-10-07 to 2025-11-03 (28 days)
Solver: CBC
Binary product_produced variables: YES

--------------------------------------------------------------------------------
TEST 1: BASELINE (Binary WITHOUT warmstart)
--------------------------------------------------------------------------------
__________________ test_warmstart_campaign_pattern_validation __________________
tests/test_warmstart_performance_comparison.py:395: in test_warmstart_campaign_pattern_validation
    products_with_hints = set(prod for (_, prod, _) in hints.keys() if hints[(_, prod, _)] == 1)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests/test_warmstart_performance_comparison.py:395: in <genexpr>
    products_with_hints = set(prod for (_, prod, _) in hints.keys() if hints[(_, prod, _)] == 1)
                                                                       ^^^^^^^^^^^^^^^^^^^
E   KeyError: (datetime.date(2025, 10, 7), 'HELGAS GFREE WHOLEM 500G', datetime.date(2025, 10, 7))
----------------------------- Captured stdout call -----------------------------

================================================================================
WARMSTART CAMPAIGN PATTERN VALIDATION
================================================================================

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 8
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-07 to 2025-11-03 (28 days)
  Products: 5
  Demand entries: 840

 Warmstart Hints Generated (Campaign Pattern):
  Products: 5
  Weekdays: 20
  Hints: 40 (binary production flags)
  Pattern: 2 SKUs/weekday, 8 weekend days

  Demand Distribution:
    HELGAS GFREE WHOLEM 500G: 24.7% demand  3 weekday slots
    HELGAS GFREE TRAD WHITE 470G: 21.8% demand  2 weekday slots
    HELGAS GFREE MIXED GRAIN 500G: 21.6% demand  2 weekday slots
    WONDER GFREE WHITE 470G: 18.6% demand  2 weekday slots
    WONDER GFREE WHOLEM 500G: 13.4% demand  1 weekday slots
 Generated 40 warmstart hints
 All hint values are binary (0 or 1)
 All hint dates within planning horizon
_____________________ test_weekly_pattern_warmstart_6week ______________________
tests/test_weekly_pattern_warmstart.py:71: in test_weekly_pattern_warmstart_6week
    result = solve_weekly_pattern_warmstart(
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:5666: in solve_weekly_pattern_warmstart
    ???
E   TypeError: UnifiedNodeModel.__init__() missing 1 required positional argument: 'products'
----------------------------- Captured stdout call -----------------------------

================================================================================
TEST: Weekly Pattern Warmstart (6-week horizon)
================================================================================
Planning horizon: 2025-10-07 to 2025-11-17 (42 days)
================================================================================
WEEKLY PATTERN WARMSTART SOLVER
Two-Phase: Weekly Cycle (no pallets)  Full Binary (with pallets)
================================================================================

Horizon: 42 days (29 weekdays, 13 weekends)
Binary variable reduction:
  Individual approach: 210 vars
  Weekly pattern: 90 vars (25 pattern + 65 weekends)
  Reduction: 57.1% fewer

================================================================================
PHASE 1: Weekly Production Cycle (No Pallet Tracking)
================================================================================

  Phase 1 Cost Conversion (Frozen Storage):
    Pallet variable cost: $0.9800/pallet-day
    Pallet fixed cost:    $14.26/pallet (amortized over 7 days)
     Unit equivalent:    $0.009429/unit-day
     No pallet_count variables in Phase 1 (fast solve)
=============================== warnings summary ===============================
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
  /home/sverzijl/planning_latest/venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

tests/test_daily_rolling_solver.py:373
  /home/sverzijl/planning_latest/tests/test_daily_rolling_solver.py:373: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_daily_rolling_solver.py:406
  /home/sverzijl/planning_latest/tests/test_daily_rolling_solver.py:406: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_daily_rolling_solver.py:449
  /home/sverzijl/planning_latest/tests/test_daily_rolling_solver.py:449: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_highs_solver_integration.py:381
  /home/sverzijl/planning_latest/tests/test_highs_solver_integration.py:381: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_holding_cost_integration.py:25
  /home/sverzijl/planning_latest/tests/test_holding_cost_integration.py:25: PytestUnknownMarkWarning: Unknown pytest.mark.integration - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.integration

tests/test_holding_cost_integration.py:141
  /home/sverzijl/planning_latest/tests/test_holding_cost_integration.py:141: PytestUnknownMarkWarning: Unknown pytest.mark.solver_required - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.solver_required

tests/test_holding_cost_integration.py:231
  /home/sverzijl/planning_latest/tests/test_holding_cost_integration.py:231: PytestUnknownMarkWarning: Unknown pytest.mark.solver_required - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.solver_required

tests/test_holding_cost_integration.py:279
  /home/sverzijl/planning_latest/tests/test_holding_cost_integration.py:279: PytestUnknownMarkWarning: Unknown pytest.mark.solver_required - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.solver_required

tests/test_holding_cost_integration.py:367
  /home/sverzijl/planning_latest/tests/test_holding_cost_integration.py:367: PytestUnknownMarkWarning: Unknown pytest.mark.solver_required - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.solver_required

tests/test_labor_cost_baseline.py:140
  /home/sverzijl/planning_latest/tests/test_labor_cost_baseline.py:140: PytestUnknownMarkWarning: Unknown pytest.mark.baseline - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.baseline

tests/test_labor_cost_baseline.py:254
  /home/sverzijl/planning_latest/tests/test_labor_cost_baseline.py:254: PytestUnknownMarkWarning: Unknown pytest.mark.baseline - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.baseline

tests/test_labor_cost_baseline.py:363
  /home/sverzijl/planning_latest/tests/test_labor_cost_baseline.py:363: PytestUnknownMarkWarning: Unknown pytest.mark.baseline - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.baseline

tests/test_pallet_based_holding_costs.py:640
  /home/sverzijl/planning_latest/tests/test_pallet_based_holding_costs.py:640: PytestUnknownMarkWarning: Unknown pytest.mark.solver_required - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.solver_required

tests/test_solution_reasonableness.py:524
  /home/sverzijl/planning_latest/tests/test_solution_reasonableness.py:524: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_solver_performance_comparison.py:135
  /home/sverzijl/planning_latest/tests/test_solver_performance_comparison.py:135: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_solver_performance_comparison.py:234
  /home/sverzijl/planning_latest/tests/test_solver_performance_comparison.py:234: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_solver_performance_comparison.py:333
  /home/sverzijl/planning_latest/tests/test_solver_performance_comparison.py:333: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_solver_performance_comparison.py:441
  /home/sverzijl/planning_latest/tests/test_solver_performance_comparison.py:441: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_unified_warmstart_integration.py:503
  /home/sverzijl/planning_latest/tests/test_unified_warmstart_integration.py:503: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_warmstart_generator_full.py:620
  /home/sverzijl/planning_latest/tests/test_warmstart_generator_full.py:620: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_warmstart_performance_comparison.py:105
  /home/sverzijl/planning_latest/tests/test_warmstart_performance_comparison.py:105: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow  # Mark as slow test (skipped in fast test runs)

tests/test_warmstart_performance_comparison.py:319
  /home/sverzijl/planning_latest/tests/test_warmstart_performance_comparison.py:319: PytestUnknownMarkWarning: Unknown pytest.mark.slow - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.slow

tests/test_alias_backward_compatibility.py::TestMultiFileParserBackwardCompatibility::test_parse_without_alias_sheet
tests/test_alias_backward_compatibility.py::TestMultiFileParserBackwardCompatibility::test_validate_consistency_still_works
  /home/sverzijl/planning_latest/src/parsers/excel_parser.py:120: UserWarning: Forecast contains 2 unmapped product codes: ['BREAD_MULTIGRAIN', 'BREAD_WHITE']. These will be used as-is. Consider adding them to the Alias sheet.
    warnings.warn(

tests/test_alias_e2e.py::TestRealWorldScenarios::test_migration_scenario_add_aliases_to_existing_system
  /home/sverzijl/planning_latest/src/parsers/excel_parser.py:120: UserWarning: Forecast contains 1 unmapped product codes: ['OLD_CODE']. These will be used as-is. Consider adding them to the Alias sheet.
    warnings.warn(

tests/test_appsi_highs_solver.py: 2 warnings
tests/test_baseline_1week.py: 1 warning
tests/test_baseline_2week.py: 1 warning
tests/test_baseline_4week.py: 1 warning
tests/test_baseline_initial_inventory.py: 1 warning
tests/test_baseline_state_transitions.py: 1 warning
tests/test_baseline_weekend_trucks.py: 1 warning
tests/test_highs_solver_integration.py: 4 warnings
tests/test_integration_ui_workflow.py: 4 warnings
  /home/sverzijl/planning_latest/src/optimization/unified_node_model.py:322: UserWarning: Zero cost parameters detected: All route transport costs are 0, ambient storage costs are 0. This may cause solver to leave some variables uninitialized (valid behavior). Consider using small non-zero costs (e.g., 0.0001) if you encounter solution extraction issues.
    warnings.warn(warning_msg, UserWarning)

tests/test_baseline_initial_inventory.py::test_baseline_with_initial_inventory
  /home/sverzijl/planning_latest/src/parsers/inventory_parser.py:167: UserWarning: Found 5 negative quantity values. These were set to 0.
    warnings.warn(

tests/test_daily_rolling_solver.py::TestWarmstartQuality::test_validate_poor_quality
  /home/sverzijl/planning_latest/src/optimization/warmstart_utils.py:440: UserWarning: Warmstart quality may be poor: only 50.0% of variables remain after shifting (50 / 100). Consider increasing horizon length or shift_days is too large.
    warnings.warn(msg)

tests/test_integration_ui_workflow.py: 5 warnings
tests/test_inventory_unit_conversion.py: 1 warning
tests/test_overtime_preference_oct16.py: 1 warning
tests/test_production_run_oct16_4weeks.py: 1 warning
tests/test_solution_integrity.py: 2 warnings
tests/test_solution_reasonableness.py: 10 warnings
  /home/sverzijl/planning_latest/src/parsers/inventory_parser.py:167: UserWarning: Found 8 negative quantity values. These were set to 0.
    warnings.warn(

tests/test_integration_ui_workflow.py: 5 warnings
tests/test_inventory_unit_conversion.py: 1 warning
tests/test_overtime_preference_oct16.py: 1 warning
tests/test_production_run_oct16_4weeks.py: 1 warning
tests/test_solution_integrity.py: 2 warnings
tests/test_solution_reasonableness.py: 10 warnings
  /home/sverzijl/planning_latest/src/parsers/inventory_parser.py:173: UserWarning: Skipped 39 entries with Storage Location 5000 (excluded from inventory).
    warnings.warn(

tests/test_labor_cost_isolation.py::test_labor_cost_only_no_storage
  /home/sverzijl/planning_latest/src/optimization/unified_node_model.py:322: UserWarning: Zero cost parameters detected: All route transport costs are 0, frozen/ambient storage costs are 0. This may cause solver to leave some variables uninitialized (valid behavior). Consider using small non-zero costs (e.g., 0.0001) if you encounter solution extraction issues.

tests/test_overtime_mechanism_validation.py::test_overtime_forced_by_capacity
tests/test_overtime_mechanism_validation.py::test_overtime_forced_single_day
  /home/sverzijl/planning_latest/src/optimization/unified_node_model.py:322: UserWarning: Zero cost parameters detected: Production cost is 0, All route transport costs are 0. This may cause solver to leave some variables uninitialized (valid behavior). Consider using small non-zero costs (e.g., 0.0001) if you encounter solution extraction issues.

tests/test_overtime_preference.py::test_overtime_preference_over_weekend
tests/test_overtime_preference.py::test_weekend_only_when_necessary
  /home/sverzijl/planning_latest/src/optimization/unified_node_model.py:322: UserWarning: Zero cost parameters detected: Production cost is 0. This may cause solver to leave some variables uninitialized (valid behavior). Consider using small non-zero costs (e.g., 0.0001) if you encounter solution extraction issues.

tests/test_parser_alias_integration.py::TestMultiFileParserWithAliases::test_with_network_file_no_alias_sheet
  /home/sverzijl/planning_latest/src/parsers/excel_parser.py:120: UserWarning: Forecast contains 3 unmapped product codes: ['168846', '176283', '184222']. These will be used as-is. Consider adding them to the Alias sheet.
    warnings.warn(

tests/test_product_alias_resolver.py::TestProductAliasResolverParsing::test_parse_without_headers
  /home/sverzijl/planning_latest/src/parsers/product_alias_resolver.py:76: UserWarning: Alias sheet header format has changed. Expected: ['Alias1', 'Alias2', 'Alias3']... Found: ['PRODUCT_X', 'XCODE1', 'XCODE2']... Parsing will proceed using position-based column access. Consider updating headers to: Alias1, Alias2, Alias3, etc.
    warnings.warn(

tests/test_sku_reduction_incentive.py::test_zero_demand_skus_not_produced
tests/test_sku_reduction_incentive.py::test_sku_reduction_cost_benefit
tests/test_sku_reduction_incentive.py::test_overtime_triggers_sku_reduction
tests/test_sku_reduction_simple.py::test_model_produces_only_demanded_skus[cbc]
tests/test_sku_reduction_simple.py::test_model_produces_only_demanded_skus[highs]
tests/test_solver_timeout_handling.py::test_timeout_with_partial_solution
tests/test_solver_timeout_handling.py::test_objective_extraction_priority
  /home/sverzijl/planning_latest/src/optimization/unified_node_model.py:322: UserWarning: Zero cost parameters detected: All route transport costs are 0, ambient storage costs are 0. This may cause solver to leave some variables uninitialized (valid behavior). Consider using small non-zero costs (e.g., 0.0001) if you encounter solution extraction issues.

tests/test_ui_integration_complete.py::test_complete_ui_workflow_with_validation
tests/test_ui_tabs_rendering.py::test_production_tab_labor_hours
tests/test_validation_integration.py::test_data_coordinator_loads_successfully
tests/test_validation_integration.py::test_sliding_window_with_validated_data
  /home/sverzijl/planning_latest/src/parsers/inventory_parser.py:167: UserWarning:
  
  Found 8 negative quantity values. These were set to 0.

tests/test_ui_integration_complete.py::test_complete_ui_workflow_with_validation
tests/test_ui_tabs_rendering.py::test_production_tab_labor_hours
tests/test_validation_integration.py::test_data_coordinator_loads_successfully
tests/test_validation_integration.py::test_sliding_window_with_validated_data
  /home/sverzijl/planning_latest/src/parsers/inventory_parser.py:173: UserWarning:
  
  Skipped 39 entries with Storage Location 5000 (excluded from inventory).

tests/test_unified_1week_solve.py::test_unified_model_1week_solves
tests/test_unified_core_constraints.py::test_unified_model_builds_with_constraints
tests/test_unified_model_skeleton.py::test_unified_model_builds
tests/test_unified_produces.py::test_unified_model_produces_without_shortages
tests/test_unified_solution_extraction.py::test_unified_solution_extraction
tests/test_unified_warmstart_integration.py::TestWarmstartPerformance::test_warmstart_generation_overhead
tests/test_unified_warmstart_integration.py::TestWarmstartPerformance::test_warmstart_application_overhead
tests/test_unified_weekend_enforcement.py::test_unified_model_weekend_truck_enforcement
tests/test_warmstart_performance_comparison.py::test_warmstart_campaign_pattern_validation
  /home/sverzijl/planning_latest/src/optimization/unified_node_model.py:322: UserWarning:
  
  Zero cost parameters detected: All route transport costs are 0, ambient storage costs are 0. This may cause solver to leave some variables uninitialized (valid behavior). Consider using small non-zero costs (e.g., 0.0001) if you encounter solution extraction issues.

tests/test_warmstart_baseline.py::test_6week_warmstart_baseline
tests/test_warmstart_enhancements.py::test_pallet_hints_extracted
tests/test_warmstart_enhancements.py::test_bound_tightening_applied
tests/test_warmstart_enhancements.py::test_performance_improvement_vs_baseline
tests/test_warmstart_enhancements.py::test_solution_quality_maintained
tests/test_warmstart_enhancements.py::test_enhancement_diagnostics
tests/test_warmstart_enhancements.py::test_6week_under_time_limit
  /home/sverzijl/planning_latest/src/parsers/inventory_parser.py:167: UserWarning:
  
  Found 5 negative quantity values. These were set to 0.

tests/test_warmstart_generator_full.py::TestWarmstartConstraints::test_max_skus_per_weekday_enforced
  /home/sverzijl/planning_latest/src/optimization/warmstart_generator.py:299: UserWarning:
  
  Total demand (350,000) exceeds weekday capacity (98,000). Consider weekend production.

tests/test_warmstart_generator_full.py::TestWarmstartConstraints::test_max_skus_per_weekday_enforced
  /home/sverzijl/planning_latest/src/optimization/warmstart_generator.py:386: UserWarning:
  
  Some products have no warmstart hints (zero demand?): {'SKU_09', 'SKU_08'}

tests/test_warmstart_generator_full.py::TestWarmstartEdgeCases::test_edge_case_zero_demand
  /home/sverzijl/planning_latest/src/optimization/warmstart_generator.py:188: UserWarning:
  
  No products have demand > 0 in forecast. Cannot generate hints.

tests/test_warmstart_generator_full.py::TestValidationFunctions::test_validate_freshness_constraint
  /home/sverzijl/planning_latest/src/optimization/warmstart_generator.py:421: UserWarning:
  
  Product SKU_A has 10-day gap between production runs (exceeds 7-day freshness). Dates: 2025-10-20  2025-10-30

tests/test_warmstart_generator_full.py::TestValidationFunctions::test_validate_daily_sku_limit
  /home/sverzijl/planning_latest/src/optimization/warmstart_generator.py:455: UserWarning:
  
  Date 2025-10-20 has 5 SKUs (exceeds limit of 3)

tests/test_warmstart_generator_full.py::TestWarmstartPerformance::test_generation_time_under_1_second
  /home/sverzijl/planning_latest/src/optimization/warmstart_generator.py:299: UserWarning:
  
  Total demand (2,800,000) exceeds weekday capacity (392,000). Consider weekend production.

tests/test_warmstart_generator_full.py::TestWarmstartPerformance::test_generation_time_under_1_second
  /home/sverzijl/planning_latest/src/optimization/warmstart_generator.py:386: UserWarning:
  
  Some products have no warmstart hints (zero demand?): {'SKU_015', 'SKU_016', 'SKU_019', 'SKU_017', 'SKU_018'}

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_alias_e2e.py::TestEndToEndWorkflow::test_forecast_inventory_product_alignment
FAILED tests/test_alias_e2e.py::TestEndToEndWorkflow::test_product_consistency_validation
FAILED tests/test_alias_e2e.py::TestInventoryAliasResolution::test_inventory_parser_with_resolver
FAILED tests/test_alias_e2e.py::TestInventoryAliasResolution::test_inventory_quantities_converted_and_resolved
FAILED tests/test_alias_e2e.py::TestRealWorldScenarios::test_sap_export_with_mixed_codes
FAILED tests/test_appsi_highs_solver.py::test_appsi_highs_availability - asse...
FAILED tests/test_appsi_highs_solver.py::test_appsi_highs_basic_solve - Asser...
FAILED tests/test_appsi_highs_solver.py::test_appsi_highs_with_warmstart - As...
FAILED tests/test_appsi_highs_solver.py::test_appsi_highs_performance_vs_legacy
FAILED tests/test_baseline_1week.py::test_baseline_1week_no_initial_inventory
FAILED tests/test_baseline_2week.py::test_baseline_2week_no_initial_inventory
FAILED tests/test_baseline_4week.py::test_baseline_4week_no_initial_inventory
FAILED tests/test_baseline_initial_inventory.py::test_baseline_with_initial_inventory
FAILED tests/test_baseline_state_transitions.py::test_baseline_state_transitions
FAILED tests/test_baseline_weekend_trucks.py::test_baseline_weekend_truck_constraints
FAILED tests/test_cost_breakdown_holding.py::TestHoldingCostBreakdown::test_holding_cost_breakdown_string_representation
FAILED tests/test_cost_breakdown_holding.py::TestResultAdapterHoldingCost::test_holding_breakdown_created_in_adapter
FAILED tests/test_cost_breakdown_holding.py::TestResultAdapterHoldingCost::test_holding_breakdown_with_zero_holding_cost
FAILED tests/test_cost_breakdown_holding.py::TestResultAdapterHoldingCost::test_holding_breakdown_missing_from_solution
FAILED tests/test_cost_breakdown_holding.py::TestResultAdapterHoldingCost::test_total_cost_includes_holding_component
FAILED tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_dates_within_planning_horizon
FAILED tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_dates_beyond_schedule_end_excluded
FAILED tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_dates_before_schedule_start_excluded
FAILED tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_shipment_dates_outside_horizon_excluded
FAILED tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_graceful_handling_when_schedule_end_date_none
FAILED tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_mixed_dates_some_inside_some_outside_horizon
FAILED tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_empty_schedule_returns_none
FAILED tests/test_daily_snapshot_date_range.py::TestDailySnapshotDateRange::test_all_shipment_date_fields_respected
FAILED tests/test_force_overtime.py::test_monday_demand_forces_overtime - Nam...
FAILED tests/test_highs_solver_integration.py::test_highs_1_week_binary_variables
FAILED tests/test_highs_solver_integration.py::test_highs_2_week_binary_variables
FAILED tests/test_highs_solver_integration.py::test_highs_4_week_binary_variables
FAILED tests/test_highs_solver_integration.py::test_highs_vs_cbc_performance
FAILED tests/test_highs_solver_integration.py::test_highs_sku_reduction - Typ...
FAILED tests/test_highs_solver_integration.py::test_highs_warmstart_no_effect
FAILED tests/test_highs_solver_integration.py::test_highs_solution_quality - ...
FAILED tests/test_integration_ui_workflow.py::test_ui_workflow_4_weeks_with_initial_inventory
FAILED tests/test_integration_ui_workflow.py::test_ui_workflow_4_weeks_with_highs
FAILED tests/test_integration_ui_workflow.py::test_ui_workflow_without_initial_inventory
FAILED tests/test_integration_ui_workflow.py::test_ui_workflow_with_warmstart
FAILED tests/test_integration_ui_workflow.py::test_ui_workflow_4_weeks_sliding_window
FAILED tests/test_inventory_unit_conversion.py::test_to_optimization_dict_structure
FAILED tests/test_inventory_unit_conversion.py::test_to_optimization_dict_aggregates_storage_locations
FAILED tests/test_labor_capacity_enforcement.py::test_labor_capacity_enforcement
FAILED tests/test_labor_cost_baseline.py::test_labor_cost_baseline_fixed_day_no_overtime
FAILED tests/test_labor_cost_baseline.py::test_labor_cost_baseline_fixed_day_with_overtime
FAILED tests/test_labor_cost_baseline.py::test_labor_cost_baseline_non_fixed_day
FAILED tests/test_labor_cost_isolation.py::test_labor_cost_only_no_storage - ...
FAILED tests/test_labor_cost_piecewise.py::test_piecewise_fixed_day_no_overtime
FAILED tests/test_labor_cost_piecewise.py::test_piecewise_non_fixed_day_below_minimum
FAILED tests/test_labor_cost_piecewise.py::test_piecewise_overhead_included
FAILED tests/test_labor_overhead_holiday.py::test_public_holiday_overhead_included
FAILED tests/test_labor_overhead_holiday.py::test_public_holiday_overhead_below_minimum
FAILED tests/test_labor_overhead_multi_day.py::test_multi_day_overhead_consistency
FAILED tests/test_labor_overhead_multi_day.py::test_multi_day_overhead_with_storage
FAILED tests/test_legacy_conversion.py::test_convert_routes - AssertionError:...
FAILED tests/test_minimal_reproduction.py::test_minimal_case_single_breadroom_single_day_demand
FAILED tests/test_minimal_reproduction.py::test_minimal_with_multi_day_demand
FAILED tests/test_multi_file_parser.py::TestMultiFileParser::test_parse_labor_calendar
FAILED tests/test_multi_file_parser.py::TestMultiFileParser::test_parse_cost_structure
FAILED tests/test_overtime_mechanism_validation.py::test_overtime_forced_by_capacity
FAILED tests/test_overtime_mechanism_validation.py::test_overtime_forced_single_day
FAILED tests/test_overtime_minimal.py::test_minimal_overtime_preference - Nam...
FAILED tests/test_overtime_preference.py::test_overtime_preference_over_weekend
FAILED tests/test_overtime_preference.py::test_weekend_only_when_necessary - ...
FAILED tests/test_overtime_preference_oct16.py::test_overtime_preference_oct16_4weeks
FAILED tests/test_pallet_based_holding_costs.py::TestHoldingCostCalculation::test_unit_based_costs_work
FAILED tests/test_pallet_based_holding_costs.py::TestHoldingCostCalculation::test_pallet_based_costs_take_precedence
FAILED tests/test_pallet_based_holding_costs.py::TestHoldingCostCalculation::test_zero_holding_costs_skips_pallet_variables
FAILED tests/test_pallet_based_holding_costs.py::TestHoldingCostCalculation::test_frozen_inventory_uses_frozen_rate
FAILED tests/test_pallet_based_holding_costs.py::TestHoldingCostCalculation::test_ambient_inventory_uses_ambient_rate
FAILED tests/test_pallet_based_holding_costs.py::TestHoldingCostIntegration::test_holding_cost_in_objective_function
FAILED tests/test_pallet_based_holding_costs.py::TestHoldingCostIntegration::test_ceiling_constraints_created
FAILED tests/test_pallet_based_holding_costs.py::TestBackwardCompatibility::test_zero_costs_behave_as_before
FAILED tests/test_pallet_based_holding_costs.py::TestHoldingCostOptimization::test_solution_includes_holding_cost_fields
FAILED tests/test_pallet_based_holding_costs.py::TestHoldingCostOptimization::test_holding_cost_in_cost_breakdown
FAILED tests/test_pallet_based_holding_costs.py::TestHoldingCostOptimization::test_holding_cost_proportion_reasonable
FAILED tests/test_pallet_based_holding_costs.py::TestHoldingCostOptimization::test_holding_cost_doesnt_break_feasibility
FAILED tests/test_parameter_parsing.py::TestRealWorldDataFiles::test_parse_real_network_config_file
FAILED tests/test_production_run_oct16_4weeks.py::test_exact_user_scenario_oct16_4weeks
FAILED tests/test_result_adapter_labor_hours.py::TestLaborHoursDictExtraction::test_labor_hours_dict_format_with_proportional_allocation
FAILED tests/test_result_adapter_labor_hours.py::TestLaborHoursDictExtraction::test_labor_hours_dict_missing_date
FAILED tests/test_result_adapter_labor_hours.py::TestLaborHoursDictExtraction::test_labor_hours_dict_with_zero_values
FAILED tests/test_result_adapter_labor_hours.py::TestLaborHoursDictExtraction::test_labor_hours_dict_missing_used_field
FAILED tests/test_result_adapter_labor_hours.py::TestBackwardCompatibilityNumericLabor::test_labor_hours_numeric_format_still_works
FAILED tests/test_result_adapter_labor_hours.py::TestBackwardCompatibilityNumericLabor::test_labor_hours_mixed_format_graceful_handling
FAILED tests/test_result_adapter_labor_hours.py::TestProductionScheduleDailyLaborHours::test_production_schedule_stores_dict_labor_hours
FAILED tests/test_result_adapter_labor_hours.py::TestProductionScheduleDailyLaborHours::test_production_schedule_total_labor_hours_calculation
FAILED tests/test_result_adapter_labor_hours.py::TestInitialInventoryWithLaborHours::test_initial_inventory_batches_zero_labor_hours
FAILED tests/test_result_adapter_labor_hours.py::TestEdgeCases::test_empty_labor_hours_dict
FAILED tests/test_result_adapter_labor_hours.py::TestEdgeCases::test_missing_labor_hours_by_date_key
FAILED tests/test_result_adapter_labor_hours.py::TestEdgeCases::test_none_labor_hours_value
FAILED tests/test_result_adapter_labor_hours.py::TestCostBreakdownLabor::test_cost_breakdown_handles_dict_labor_hours
FAILED tests/test_result_adapter_labor_hours.py::test_full_adapter_integration_with_dict_labor
FAILED tests/test_result_adapter_labor_hours.py::test_error_detection_dict_multiplication_regression
FAILED tests/test_result_adapter_labor_hours.py::test_error_detection_missing_used_field_regression
FAILED tests/test_result_quality_validation.py::test_cost_extraction_doesnt_fail_silently
FAILED tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_convert_to_long_format
FAILED tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_convert_full
FAILED tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_convert_locations
FAILED tests/test_sap_ibp_converter.py::TestSapIbpConverter::test_convert_date_range
FAILED tests/test_sap_ibp_parser.py::TestSapIbpDetection::test_detect_sap_ibp_format
FAILED tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast
FAILED tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast_data_structure
FAILED tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast_date_range
FAILED tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast_locations
FAILED tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast_products
FAILED tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_forecast_sample_values
FAILED tests/test_sap_ibp_parser.py::TestSapIbpParsing::test_parse_sap_ibp_date_parsing
FAILED tests/test_sap_ibp_parser.py::TestSapIbpParserEdgeCases::test_parse_handles_nan_quantities
FAILED tests/test_sap_ibp_parser.py::TestSapIbpParserEdgeCases::test_parse_converts_ids_to_strings
FAILED tests/test_sap_ibp_parser.py::TestSapIbpParserEdgeCases::test_parse_forecast_entry_count_consistency
FAILED tests/test_sap_ibp_parser.py::TestSapIbpParserEdgeCases::test_parse_no_duplicate_entries
FAILED tests/test_sku_reduction_incentive.py::test_zero_demand_skus_not_produced
FAILED tests/test_sku_reduction_incentive.py::test_sku_reduction_cost_benefit
FAILED tests/test_sku_reduction_incentive.py::test_overtime_triggers_sku_reduction
FAILED tests/test_sku_reduction_simple.py::test_model_produces_only_demanded_skus[cbc]
FAILED tests/test_sku_reduction_simple.py::test_model_produces_only_demanded_skus[highs]
FAILED tests/test_solution_integrity.py::test_4week_solution_integrity - Valu...
FAILED tests/test_solution_integrity.py::test_initial_inventory_production_dates
FAILED tests/test_solution_integrity.py::test_weekend_labor_minimum_payment
FAILED tests/test_solution_reasonableness.py::TestSolutionReasonableness::test_1week_production_meets_demand
FAILED tests/test_solution_reasonableness.py::TestSolutionReasonableness::test_4week_production_meets_demand
FAILED tests/test_solution_reasonableness.py::TestSolutionReasonableness::test_4week_cost_components_reasonable
FAILED tests/test_solution_reasonableness.py::TestHorizonScaling::test_production_scales_with_demand
FAILED tests/test_solver_config.py::TestSolverConfig::test_get_available_solvers_none_available
FAILED tests/test_solver_config.py::TestSolverConfig::test_get_best_available_solver_none_available
FAILED tests/test_solver_config.py::TestSolverConfig::test_get_best_available_solver_falls_back_to_cbc
FAILED tests/test_solver_config.py::TestSolverPreference::test_solver_preference_order
FAILED tests/test_solver_performance_comparison.py::test_solver_performance_1_week
FAILED tests/test_solver_performance_comparison.py::test_solver_performance_2_week
FAILED tests/test_solver_performance_comparison.py::test_solver_performance_4_week
FAILED tests/test_solver_timeout_handling.py::test_solution_extraction_with_zero_holding_costs
FAILED tests/test_truck_routing_fixes.py::test_intermediate_stop_expansion - ...
FAILED tests/test_truck_routing_fixes.py::test_lineage_receives_goods - Asser...
FAILED tests/test_unified_1week_solve.py::test_unified_model_1week_solves - T...
FAILED tests/test_unified_conditional_pallet_tracking.py::TestUnifiedNodeModelConditionalPalletTracking::test_pallet_tracking_neither_state
FAILED tests/test_unified_conditional_pallet_tracking.py::TestUnifiedNodeModelConditionalPalletTracking::test_state_specific_fixed_costs_in_objective
FAILED tests/test_unified_models.py::test_unified_node_creation - AttributeEr...
FAILED tests/test_unified_produces.py::test_unified_model_produces_without_shortages
FAILED tests/test_unified_solution_extraction.py::test_unified_solution_extraction
FAILED tests/test_unified_state_transitions_full.py::test_freeze_transition_and_shelf_life_reset
FAILED tests/test_unified_warmstart_integration.py::TestWarmstartPerformance::test_warmstart_speedup_measurement
FAILED tests/test_unified_weekend_enforcement.py::test_unified_model_weekend_truck_enforcement
FAILED tests/test_unified_zero_cost_scenarios.py::test_zero_transport_costs_solution_extraction
FAILED tests/test_unified_zero_cost_scenarios.py::test_zero_storage_costs_solution_extraction
FAILED tests/test_unified_zero_cost_scenarios.py::test_mixed_zero_nonzero_costs
FAILED tests/test_unified_zero_cost_scenarios.py::test_zero_production_cost
FAILED tests/test_user_data_infeasibility.py::test_user_data_infeasibility_diagnosis
FAILED tests/test_warmstart_baseline.py::test_6week_warmstart_baseline - Type...
FAILED tests/test_warmstart_enhancements.py::test_pallet_hints_extracted - Ty...
FAILED tests/test_warmstart_enhancements.py::test_bound_tightening_applied - ...
FAILED tests/test_warmstart_enhancements.py::test_enhancement_diagnostics - T...
FAILED tests/test_warmstart_enhancements.py::test_6week_under_time_limit - Ty...
FAILED tests/test_warmstart_performance_comparison.py::test_warmstart_performance_improvement
FAILED tests/test_warmstart_performance_comparison.py::test_warmstart_campaign_pattern_validation
FAILED tests/test_weekly_pattern_warmstart.py::test_weekly_pattern_warmstart_6week
ERROR tests/test_daily_rolling_solver.py::TestSolutionExtraction::test_extract_solution_basic
ERROR tests/test_daily_rolling_solver.py::TestSolutionExtraction::test_extract_includes_all_variable_types
ERROR tests/test_daily_rolling_solver.py::TestDailyRollingSolver::test_solve_single_day
ERROR tests/test_daily_rolling_solver.py::TestDailyRollingSolver::test_solve_two_day_sequence
ERROR tests/test_daily_rolling_solver.py::TestDailyRollingSolver::test_solve_sequence
ERROR tests/test_daily_rolling_solver.py::TestDailyRollingSolver::test_reset_clears_warmstart
ERROR tests/test_daily_rolling_solver.py::TestForecastUpdates::test_forecast_updates_applied
ERROR tests/test_holding_cost_integration.py::TestHoldingCostIntegration::test_full_optimization_with_holding_costs
ERROR tests/test_holding_cost_integration.py::TestHoldingCostIntegration::test_daily_snapshot_respects_planning_horizon
ERROR tests/test_holding_cost_integration.py::TestHoldingCostIntegration::test_holding_cost_breakdown_proportions
ERROR tests/test_holding_cost_integration.py::TestHoldingCostIntegration::test_zero_holding_costs_no_impact
ERROR tests/test_holding_cost_integration.py::TestHoldingCostIntegration::test_holding_cost_with_initial_inventory
ERROR tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_holding_cost_included_in_objective
ERROR tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_frozen_inventory_uses_frozen_storage_rate
ERROR tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_ambient_inventory_uses_ambient_storage_rate
ERROR tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_total_holding_cost_in_solution
ERROR tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_zero_holding_cost_when_no_inventory
ERROR tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_holding_cost_calculation_from_cohort_inventory
ERROR tests/test_inventory_holding_costs.py::TestInventoryHoldingCosts::test_holding_cost_aggregated_mode_uses_ambient_rate
ERROR tests/test_sliding_window_ui_integration.py::test_sliding_window_solution_has_shipments
ERROR tests/test_sliding_window_ui_integration.py::test_extract_shipments_uses_pydantic_solution
ERROR tests/test_sliding_window_ui_integration.py::test_init_batches_not_in_production_activity
ERROR tests/test_sliding_window_ui_integration.py::test_solution_validation_catches_missing_shipments
ERROR tests/test_sliding_window_ui_integration.py::test_daily_snapshot_shows_flows
ERROR tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_start_tracking_variables_exist
ERROR tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_old_variables_removed
ERROR tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_new_constraints_exist
ERROR tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_start_tracking_solve_1week
ERROR tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_changeover_statistics_extraction
ERROR tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_start_detection_logic
ERROR tests/test_start_tracking_integration.py::TestStartTrackingIntegration::test_cost_improvement_vs_baseline
ERROR tests/test_unified_warmstart_integration.py::TestWarmstartGeneration::test_generate_warmstart_method
ERROR tests/test_unified_warmstart_integration.py::TestWarmstartGeneration::test_apply_warmstart_method
ERROR tests/test_unified_warmstart_integration.py::TestWarmstartSolveIntegration::test_solve_with_warmstart_parameter
ERROR tests/test_unified_warmstart_integration.py::TestWarmstartSolveIntegration::test_solve_without_warmstart_still_works
ERROR tests/test_unified_warmstart_integration.py::TestWarmstartSolveIntegration::test_warmstart_custom_hints
ERROR tests/test_unified_warmstart_integration.py::TestWarmstartSolveIntegration::test_warmstart_invalid_hints_graceful
ERROR tests/test_unified_warmstart_integration.py::TestWarmstartSolveIntegration::test_warmstart_partial_hints
= 157 failed, 751 passed, 15 skipped, 136 warnings, 38 errors in 2551.84s (0:42:31) =
