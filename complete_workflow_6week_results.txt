/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:303: UserWarning: Zero cost parameters detected: All route transport costs are 0, ambient storage costs are 0. This may cause solver to leave some variables uninitialized (valid behavior). Consider using small non-zero costs (e.g., 0.0001) if you encounter solution extraction issues.
  warnings.warn(warning_msg, UserWarning)
================================================================================
COMPLETE ROLLING WINDOW WORKFLOW (6-WEEK)
WITH DAY 1 ACTUALS
================================================================================

üìÇ Loading data...
   ‚úì 11 nodes, 10 routes, 5 products
   ‚úì Forecast starts: 2025-10-16

================================================================================
DAY 1: SOLVE (Days 1-42)
================================================================================
Planning horizon: 2025-10-16 to 2025-11-26 (42 days)

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 9
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-16 to 2025-11-26 (42 days)
  Products: 5
  Demand entries: 1890

üöÄ Solving Day 1 (cold start)...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 42 dates, 10 routes
  Production dates for cohorts: 42 in horizon + 0 from initial inventory
  Cohort indices: 30,765 cohorts
  Shipment cohorts by origin node:
    6104: 2660
    6122: 8090
    6125: 3990
    Lineage: 3150
  Shipment cohort indices: 17,890
  Demand cohort indices: 13,860
  üöõ Truck pallet tracking enabled: 2,520 integer pallet variables
  Changeover tracking: 42 production days, 210 product indicators (VARIABLE (binary decision))
  Start tracking: 210 start indicators (binary)
  Labor cost variables: 42 labor hour variables added
  Variables created successfully
  Adding core constraints...
  Changeover tracking constraints added (672 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (42 node-date pairs, 378 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 117 storage delay constraints
  ‚úì Added truck pallet ceiling constraints: 2,520 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 4,515
    Domain reduced: 62 ‚Üí 10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 4,515
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 30,765 total cohorts (10,255 pallet-tracked)

  Staleness penalty enabled: $5.0000 per unit per age ratio
  Staleness penalty calculation: 13,860 demand cohorts
  Formula: (age_days / 17) √ó $5.0000 √ó demand_satisfied
  Changeover cost enabled: $38.40 per start
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
WARNING: Loading a feasible but suboptimal solution. Please set
load_solution=False and check results.termination_condition and
results.found_feasible_solution() before loading a solution.
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:303: UserWarning: Zero cost parameters detected: All route transport costs are 0, ambient storage costs are 0. This may cause solver to leave some variables uninitialized (valid behavior). Consider using small non-zero costs (e.g., 0.0001) if you encounter solution extraction issues.
  warnings.warn(warning_msg, UserWarning)

‚úÖ Day 1 solved successfully!
   Time: 609.5s
   Cost: $1,673,676
   Gap: 2.33%

================================================================================
PLANNER EXECUTES DAY 1 PLAN
================================================================================
Extracting Day 1 ending inventory as 'actuals' for Day 2...
   ‚úì Extracted 0 inventory cohorts from Day 1 ending

üì¶ Extracting warmstart from Day 1 solution...

‚úì Warmstart extraction complete:
  Total variables: 3,688
  Production: 151
  Product binaries: 210
  Changeover starts: 210
  Inventory cohorts: 1,533
  Shipment cohorts: 1,349
  Production days: 42
  Overtime flags: 42
  Labor hours: 0
  Pallet counts: 0
  Other: 151

================================================================================
DAY 2: SOLVE (Days 2-43) WITH ACTUALS + WARMSTART
================================================================================
Planning horizon: 2025-10-17 to 2025-11-27 (42 days)

üîÑ Filtering warmstart for rolling window...
   Day 1 solved: 2025-10-16 to 2025-11-26
   Day 2 solving: 2025-10-17 to 2025-11-27
   Overlap: 2025-10-17 to 2025-11-26 (41 days EXACT)
   New: 2025-11-27 (1 day)

‚úì Warmstart extraction for rolling window:
  Original variables: 3,285
  Kept in new window: 3,205
  Dropped (before window): 80
  Dropped (after window): 0
  Non-date variables: 0
  Total warmstart: 3,205 (97.6% coverage)

üî® Building Day 2 model with Day 1 actuals...
   Initial inventory: 0 cohorts (from Day 1 ending)
   Inventory snapshot date: 2025-10-16 (end of Day 1)

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 9
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-17 to 2025-11-27 (42 days)
  Products: 5
  Demand entries: 1890

üöÄ Solving Day 2 (with actuals + warmstart)...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 42 dates, 10 routes
  Production dates for cohorts: 42 in horizon + 0 from initial inventory
  Cohort indices: 30,765 cohorts
  Shipment cohorts by origin node:
    6104: 2660
    6122: 8090
    6125: 3990
    Lineage: 3150
  Shipment cohort indices: 17,890
  Demand cohort indices: 13,860
  üöõ Truck pallet tracking enabled: 2,520 integer pallet variables
  Changeover tracking: 42 production days, 210 product indicators (VARIABLE (binary decision))
  Start tracking: 210 start indicators (binary)
  Labor cost variables: 42 labor hour variables added
  Variables created successfully
  Adding core constraints...
  Changeover tracking constraints added (672 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (42 node-date pairs, 378 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 117 storage delay constraints
  ‚úì Added truck pallet ceiling constraints: 2,520 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 4,515
    Domain reduced: 62 ‚Üí 10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 4,515
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 30,765 total cohorts (10,255 pallet-tracked)

  Staleness penalty enabled: $5.0000 per unit per age ratio
  Staleness penalty calculation: 13,860 demand cohorts
  Formula: (age_days / 17) √ó $5.0000 √ó demand_satisfied
  Changeover cost enabled: $38.40 per start
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve

Applying comprehensive warmstart hints...
  Warmstart applied to 3,058 variables:
    inventory_cohort: 1,476
    other_binary: 41
    product_produced: 205
    shipment_cohort: 1,336
  Skipped: 147 (no matching variable)
WARNING: Loading a feasible but suboptimal solution. Please set
load_solution=False and check results.termination_condition and
results.found_feasible_solution() before loading a solution.

‚úÖ Day 2 solved successfully!
   Time: 607.8s
   Cost: $1,715,922
   Gap: 2.01%

================================================================================
COMPLETE WORKFLOW VALIDATION (6-WEEK)
================================================================================

Day 1 (cold start):          609.5s - $1,673,676 (2.33% gap)
Day 2 (actuals+warmstart):   607.8s - $1,715,922 (2.01% gap)
Speedup:                      0.3% faster

‚ö†Ô∏è  NOTE: Both solves hit time limit (600s)
   Time speedup not measurable at this limit
   However, warmstart improved solution quality:
     Day 1 gap: 2.33%
     Day 2 gap: 2.01% (+0.32% improvement)

‚úÖ Warmstart IS WORKING: Better solution quality in same time

üí∞ Cost Comparison:
   Day 1: $1,673,676
   Day 2: $1,715,922
   Difference: $42,246 (2.52%)
   Note: Different windows have different optimal costs

üìä Warmstart Quality:
   Horizon: 42 days
   Overlap: 41 days (Days 2-42)
   New dates: 1 day (Day 43)
   Variable coverage: 97.6%
   Initial inventory: 0 cohorts from Day 1 actuals

================================================================================
‚ú® Complete workflow validated!
================================================================================

üìã WORKFLOW SUMMARY:
   1. Day 1 solve: 609.5s (cold start)
   2. Record Day 1 actuals: 0 inventory cohorts
   3. Day 2 solve: 607.8s (with actuals + warmstart)

   ‚úì Day 1 actuals incorporated into Day 2
   ‚úì Warmstart applied for Days 2-42
   ‚úì Solver optimizes Day 43 freely

   üí° INSIGHT: 6-week problems hit time limit
      Warmstart helps solution quality, not just speed
      For faster solves: increase time_limit or reduce horizon
