/home/sverzijl/planning_latest/src/parsers/inventory_parser.py:167: UserWarning: Found 5 negative quantity values. These were set to 0.
  warnings.warn(
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:287: UserWarning: Zero cost parameters detected: All route transport costs are 0, ambient storage costs are 0. This may cause solver to leave some variables uninitialized (valid behavior). Consider using small non-zero costs (e.g., 0.0001) if you encounter solution extraction issues.
  warnings.warn(warning_msg, UserWarning)
================================================================================
COMPREHENSIVE ANALYSIS: Pattern vs Flexible
================================================================================

Questions to answer:
  1. Does pattern produce 5 SKUs every day?
  2. Do pattern and flexible give same solution?
  3. Do we need warmstart or can we solve flexible directly?
  4. Is flexible leveraging the increased flexibility?


================================================================================
SOLVING PATTERN MODEL
================================================================================

ðŸ“¦ Preprocessed initial inventory: 23 items, prod_date=2025-10-21 (one day before snapshot)

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 9
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-20 to 2025-11-16 (28 days)
  Products: 5
  Demand entries: 1260

Building pattern model...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 28 dates, 10 routes
  Production dates for cohorts: 28 in horizon + 0 from initial inventory
  Cohort indices: 17,780 cohorts
  Shipment cohorts by origin node:
    6104: 3780
    6122: 7425
    6125: 5670
    Lineage: 1155
  Shipment cohort indices: 18,030
  Demand cohort indices: 14,175
  Changeover tracking: 28 production days, 140 product indicators (VARIABLE (binary decision))
  Labor cost variables: 28 labor hour variables added
  Variables created successfully
  Adding core constraints...
  Changeover tracking constraints added (224 constraints)
  Big-M value for product_produced linking: 19,600 units/day
  Labor cost constraints added (28 node-date pairs, 252 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 75 storage delay constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 2,030
    Domain reduced: 62 â†’ 10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 2,030
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 17,780 total cohorts (5,926 pallet-tracked)

  Staleness penalty enabled: $0.0500 per unit per day of age
  Staleness penalty calculation: 14,175 demand cohorts
  Formula: min(age_days, 17) Ã— $0.0500 Ã— demand_satisfied
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
Solving...
/home/sverzijl/planning_latest/src/optimization/unified_node_model.py:287: UserWarning: Zero cost parameters detected: All route transport costs are 0, ambient storage costs are 0. This may cause solver to leave some variables uninitialized (valid behavior). Consider using small non-zero costs (e.g., 0.0001) if you encounter solution extraction issues.
  warnings.warn(warning_msg, UserWarning)

Pattern Results:
  Cost: $763,705.97
  Time: 9.8s

================================================================================
PATTERN PRODUCTION SCHEDULE ANALYSIS
================================================================================

Products per day distribution:
  0 SKUs: 2 days (7.1%)
  5 SKUs: 26 days (92.9%)

âœ“  Variable SKU count per day (optimized)

Weekly pattern check:
  âœ“  Weekly pattern detected:
    Monday: 5 SKUs - HELGAS, HELGAS, HELGAS, WONDER, WONDER
    Tuesday: 5 SKUs - HELGAS, HELGAS, HELGAS, WONDER, WONDER
    Wednesday: 5 SKUs - HELGAS, HELGAS, HELGAS, WONDER, WONDER
    Thursday: 5 SKUs - HELGAS, HELGAS, HELGAS, WONDER, WONDER
    Friday: 5 SKUs - HELGAS, HELGAS, HELGAS, WONDER, WONDER

Changeover statistics:
  Total changeovers: 95
  Avg per day: 3.4

================================================================================
SOLVING FLEXIBLE MODEL (DIRECT - NO WARMSTART)
================================================================================

ðŸ“¦ Preprocessed initial inventory: 23 items, prod_date=2025-10-21 (one day before snapshot)

Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 9
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-20 to 2025-11-16 (28 days)
  Products: 5
  Demand entries: 1260

Building flexible model...

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 28 dates, 10 routes
  Production dates for cohorts: 28 in horizon + 0 from initial inventory
  Cohort indices: 17,780 cohorts
  Shipment cohorts by origin node:
    6104: 3780
    6122: 7425
    6125: 5670
    Lineage: 1155
  Shipment cohort indices: 18,030
  Demand cohort indices: 14,175
  Changeover tracking: 28 production days, 140 product indicators (VARIABLE (binary decision))
  Labor cost variables: 28 labor hour variables added
  Variables created successfully
  Adding core constraints...
  Changeover tracking constraints added (224 constraints)
  Big-M value for product_produced linking: 19,600 units/day
  Labor cost constraints added (28 node-date pairs, 252 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 75 storage delay constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 2,030
    Domain reduced: 62 â†’ 10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 2,030
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 17,780 total cohorts (5,926 pallet-tracked)

  Staleness penalty enabled: $0.0500 per unit per day of age
  Staleness penalty calculation: 14,175 demand cohorts
  Formula: min(age_days, 17) Ã— $0.0500 Ã— demand_satisfied
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
Solving (cold start)...

Flexible Results:
  Cost: $763,827.89
  Time: 9.3s

================================================================================
FLEXIBLE PRODUCTION SCHEDULE ANALYSIS
================================================================================

Products per day distribution:
  0 SKUs: 2 days (7.1%)
  5 SKUs: 26 days (92.9%)

âœ“  Variable SKU count per day (optimized)

Weekly pattern check:
  âœ“  Weekly pattern detected:
    Monday: 5 SKUs - HELGAS, HELGAS, HELGAS, WONDER, WONDER
    Tuesday: 5 SKUs - HELGAS, HELGAS, HELGAS, WONDER, WONDER
    Wednesday: 5 SKUs - HELGAS, HELGAS, HELGAS, WONDER, WONDER
    Thursday: 5 SKUs - HELGAS, HELGAS, HELGAS, WONDER, WONDER
    Friday: 5 SKUs - HELGAS, HELGAS, HELGAS, WONDER, WONDER

Changeover statistics:
  Total changeovers: 95
  Avg per day: 3.4

================================================================================
SCHEDULE COMPARISON
================================================================================

Identical days: 28/28 (100.0%)
Different days: 0/28 (0.0%)

âœ… SCHEDULES ARE IDENTICAL
   Pattern and flexible produce exact same solution!
   â†’ Pattern warmstart adds NO value (already optimal)

================================================================================
FINAL ANALYSIS
================================================================================

1. DOES PATTERN PRODUCE 5 SKUs EVERY DAY?
   NO - Variable SKU count

2. ARE PATTERN AND FLEXIBLE SOLUTIONS IDENTICAL?
   YES - 100% identical schedules

3. DO WE NEED WARMSTART?
   YES - Warmstart provides good starting point
   â†’ Total time: 13.1s vs 9.3s direct

4. IS FLEXIBLE LEVERAGING INCREASED FLEXIBILITY?
   NO - Produces identical schedule to pattern
   â†’ Pattern constraint was not restrictive
   â†’ Optimal solution happens to be a weekly pattern

================================================================================
RECOMMENDATION
================================================================================

âœ… SOLVE FLEXIBLE DIRECTLY (NO WARMSTART NEEDED)

Reason:
  - Pattern and flexible give identical solutions
  - Flexible cold start: $763,828 in 9.3s
  - Pattern warmstart: $763,706 + $763,828 in 13.1s
  - Cold start is simpler and similar performance

================================================================================
ANALYSIS COMPLETE
================================================================================
