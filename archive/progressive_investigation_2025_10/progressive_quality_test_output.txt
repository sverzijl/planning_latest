============================= test session starts ==============================
platform linux -- Python 3.11.2, pytest-8.4.2, pluggy-1.6.0 -- /home/sverzijl/planning_latest/venv/bin/python
cachedir: .pytest_cache
rootdir: /home/sverzijl/planning_latest
plugins: cov-7.0.0, mock-3.15.1
collecting ... collected 1 item

tests/test_progressive_optimizer.py::TestProgressiveOptimizer::test_progressive_quality_vs_direct_solve 
Unified Model Data Summary:
  Nodes: 11
    Manufacturing: 1
    Demand: 9
    With truck constraints: 1
  Routes: 10
  Truck schedules: 11
  Planning horizon: 2025-10-16 to 2026-01-07 (84 days)
  Products: 5
  Demand entries: 3780

======================================================================
BASELINE: Direct solve (1% gap)
======================================================================

Building Unified Node Model...
  Sets defined: 11 nodes, 5 products, 84 dates, 10 routes
  Production dates for cohorts: 84 in horizon + 0 from initial inventory
  Cohort indices: 75,600 cohorts
  Shipment cohorts by origin node:
    6104: 34860
    6122: 69305
    6125: 52290
    Lineage: 15015
  Shipment cohort indices: 171,470
  Demand cohort indices: 51,975
  ðŸš› Truck pallet tracking enabled: 5,040 integer pallet variables
  Changeover tracking: 84 production days, 420 product indicators (VARIABLE (binary decision))
  Start tracking: 420 start indicators (binary)
  Labor cost variables: 84 labor hour variables added
  Variables created successfully
  Adding core constraints...
  Changeover tracking constraints added (1,344 constraints)
  Big-M: Using max_mixes per product (tighter than max_production)
  Labor cost constraints added (84 node-date pairs, 756 constraints)
  Adding storage shipment delay constraint for 3 nodes: ['6104', '6125', 'Lineage']
    Added 243 storage delay constraints
  âœ“ Added truck pallet ceiling constraints: 5,040 constraints
  Hybrid pallet formulation (MIP optimization):
    Small cohorts (integer 0-10): 17,850
    Domain reduced: 62 â†’ 10 (84% reduction)
  Pallet tracking enabled for states: ['frozen']
    - Pallet integer variables: 17,850
    - Domain per variable: 0-10 (vs 0-62 full formulation)
    - Unit-tracked states: ['ambient', 'thawed']
  Holding cost enabled: 75,600 total cohorts (25,200 pallet-tracked)

  Staleness penalty enabled: $5.0000 per unit per age ratio
  Staleness penalty calculation: 51,975 demand cohorts
  Formula: (age_days / 17) Ã— $5.0000 Ã— demand_satisfied
  Changeover cost enabled: $38.40 per start
  Core constraints added
  Truck constraints added (generalized for any node)
  Model complete and ready to solve
FAILED

=================================== FAILURES ===================================
______ TestProgressiveOptimizer.test_progressive_quality_vs_direct_solve _______
tests/test_progressive_optimizer.py:155: in test_progressive_quality_vs_direct_solve
    result_direct = model.solve(mip_gap=0.01, time_limit_seconds=600, tee=False)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/optimization/unified_node_model.py:1482: in solve
    return super().solve(
src/optimization/base_model.py:509: in solve
    results = solver.solve(self.model, **solve_kwargs)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Highs.solve() got an unexpected keyword argument 'tee'
=============================== warnings summary ===============================
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323
  /home/sverzijl/planning_latest/venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:323: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.11/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

tests/test_progressive_optimizer.py::TestProgressiveOptimizer::test_progressive_quality_vs_direct_solve
  /home/sverzijl/planning_latest/src/optimization/unified_node_model.py:300: UserWarning: Zero cost parameters detected: All route transport costs are 0, ambient storage costs are 0. This may cause solver to leave some variables uninitialized (valid behavior). Consider using small non-zero costs (e.g., 0.0001) if you encounter solution extraction issues.
    warnings.warn(warning_msg, UserWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_progressive_optimizer.py::TestProgressiveOptimizer::test_progressive_quality_vs_direct_solve
=================== 1 failed, 9 warnings in 80.11s (0:01:20) ===================
